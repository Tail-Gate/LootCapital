STARTED JOB AT: Fri Jul 18 14:37:09 EDT 2025
--- Environment Check within SLURM job (after Conda activation) ---
Current directory: /home/obondo/stgnn_model/LootCapital
Which Python: /home/obondo/.conda/envs/stgnn_train/bin/python
Conda environment list (should show 'stgnn_train' as active):

# conda environments:
#
stgnn_train          * /home/obondo/.conda/envs/stgnn_train
base                   /usr/local/Dist/anaconda3-2024.02
ve-test                /usr/local/Dist/anaconda3-2024.02/envs/ve-test

LD_LIBRARY_PATH: /usr/local/cuda-12.2/lib64:/lib:/usr/lib:/usr/local/lib:/usr/local/lib/X11:/usr/local/global/lib:/usr/lib64:/home/obondo/lib:/home/obondo/lib64
PATH: /home/obondo/.conda/envs/stgnn_train/bin:/usr/local/cuda-12.2/bin:/usr/local/Dist/anaconda3-2024.02/condabin:/usr/share/Modules/bin:/sbin:/bin:/usr/local/bin:/usr/bin:/usr/sbin:/usr/X11R6/bin:/usr/local/sbin:/usr/bin/X11:/usr/local/global/bin:/usr/local/global/sbin:/usr/kerberos/bin:/home/obondo/bin
CUDA_VISIBLE_DEVICES: 0,1
PyTorch CUDA available: True
PyTorch CUDA device count: 2
PyTorch CUDA version: 11.8
CUDA_HOME: /usr/local/cuda-12.2
NVCC_PATH: N/A
Ensured output directories exist.
Starting memory-optimized walk_forward_optimization script...
Memory optimization settings:
  PYTORCH_CUDA_ALLOC_CONF: max_split_size_mb:128
  CUDA_LAUNCH_BLOCKING: 1
  OMP_NUM_THREADS: 32
  MKL_NUM_THREADS: 32
  NUMEXPR_NUM_THREADS: 32
  OPENBLAS_NUM_THREADS: 32

Starting memory-optimized walk_forward_optimization script...
Resource utilization strategy:
  - Using GPU training for maximum speed
  - Using all 32 cores for parallel processing
  - Using 2 GPUs
  - Using 120GB memory (maximum available)
2025-07-18 14:37:35,280 - __main__ - INFO - ================================================================================
2025-07-18 14:37:35,281 - __main__ - INFO - STARTING WALK-FORWARD OPTIMIZATION
2025-07-18 14:37:35,281 - __main__ - INFO - ================================================================================
2025-07-18 14:37:35,281 - __main__ - INFO - Arguments: {'start_date': None, 'end_date': None, 'output_dir': 'models', 'reports_dir': 'reports', 'plots_dir': 'plots', 'logs_dir': 'logs', 'train_window_days': 365, 'test_window_days': 60, 'step_size_days': 30, 'price_threshold': 0.005, 'scaler_type': 'minmax', 'log_level': 'INFO', 'quiet': False}
2025-07-18 14:37:35,281 - __main__ - INFO - Creating configuration...
2025-07-18 14:37:35,281 - __main__ - INFO - Configuration created successfully
2025-07-18 14:37:35,281 - __main__ - INFO - Assets: ['ETH/USD']
2025-07-18 14:37:35,281 - __main__ - INFO - Features: 25 features
2025-07-18 14:37:35,281 - __main__ - INFO - Model parameters: hidden_dim=96, layers=2
2025-07-18 14:37:35,281 - __main__ - INFO - Creating walk-forward optimizer...
2025-07-18 14:37:35,281 - __main__ - INFO - Walk-forward optimizer created successfully
2025-07-18 14:37:35,282 - __main__ - INFO - Checking data availability...
2025-07-18 14:37:35,542 - __main__ - INFO - Data available from 2020-07-19 to 2025-05-29
2025-07-18 14:37:35,542 - __main__ - INFO - Data coverage: 1774 days
2025-07-18 14:37:35,542 - __main__ - INFO - Total data points: 170366
2025-07-18 14:37:35,542 - __main__ - INFO - Configuration Summary:
2025-07-18 14:37:35,542 - __main__ - INFO -   Data range: 2020-07-19 to 2025-07-18
2025-07-18 14:37:35,542 - __main__ - INFO -   Total data span: 1825 days
2025-07-18 14:37:35,542 - __main__ - INFO -   Training window: 365 days
2025-07-18 14:37:35,542 - __main__ - INFO -   Testing window: 60 days
2025-07-18 14:37:35,542 - __main__ - INFO -   Step size: 30 days
2025-07-18 14:37:35,542 - __main__ - INFO -   Expected walk-forward periods: 47
2025-07-18 14:37:35,542 - __main__ - INFO -   Price threshold: 0.005
2025-07-18 14:37:35,542 - __main__ - INFO -   Features: 25 comprehensive features
2025-07-18 14:37:35,542 - __main__ - INFO -   Feature scaling: minmax
2025-07-18 14:37:35,542 - __main__ - INFO -   Output directories:
2025-07-18 14:37:35,542 - __main__ - INFO -     Models: models
2025-07-18 14:37:35,542 - __main__ - INFO -     Reports: reports
2025-07-18 14:37:35,542 - __main__ - INFO -     Plots: plots
2025-07-18 14:37:35,542 - __main__ - INFO -     Logs: logs
2025-07-18 14:37:35,542 - __main__ - INFO - Estimated runtime: 470 minutes (7.8 hours)
2025-07-18 14:37:35,542 - __main__ - INFO - Walk-forward optimizer scaler set to: minmax
2025-07-18 14:37:35,542 - __main__ - INFO - Feature scaling enabled: minmax
2025-07-18 14:37:35,542 - __main__ - INFO - 
Starting walk-forward optimization...
2025-07-18 14:37:35,542 - __main__ - INFO - Starting walk-forward optimization from 2020-07-19 14:37:35.282119 to 2025-07-18 14:37:35.282119
2025-07-18 14:37:35,542 - __main__ - INFO - Generating walk-forward data splits...
2025-07-18 14:37:35,543 - __main__ - INFO - Generated 47 walk-forward periods
2025-07-18 14:37:35,543 - __main__ - INFO - Split 1: 2020-07_to_2021-09 (Train: 2020-07-19 to 2021-07-19, Test: 2021-07-19 to 2021-09-17)
2025-07-18 14:37:35,543 - __main__ - INFO - Split 2: 2020-08_to_2021-10 (Train: 2020-08-18 to 2021-08-18, Test: 2021-08-18 to 2021-10-17)
2025-07-18 14:37:35,543 - __main__ - INFO - Split 3: 2020-09_to_2021-11 (Train: 2020-09-17 to 2021-09-17, Test: 2021-09-17 to 2021-11-16)
2025-07-18 14:37:35,543 - __main__ - INFO - ... and 44 more splits
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 170366 rows of real data for ETH/USD
Processing periods:   0%|          | 0/47 [00:00<?, ?period/s]2025-07-18 14:37:35,547 - __main__ - INFO - 
============================================================
2025-07-18 14:37:35,548 - __main__ - INFO - Processing period 1/47: 2020-07_to_2021-09
2025-07-18 14:37:35,548 - __main__ - INFO - Progress: 1/47 (2.1%)
2025-07-18 14:37:35,548 - __main__ - INFO - ============================================================
2025-07-18 14:37:35,549 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:37:35,549 - __main__ - INFO - Using default hyperparameters for period 0
2025-07-18 14:37:35,549 - __main__ - INFO - Processing period: 2020-07_to_2021-09
2025-07-18 14:37:35,549 - __main__ - INFO - Preparing training data...
2025-07-18 14:37:35,549 - __main__ - INFO - Preparing data for period: 2020-07-19 to 2021-07-19
2025-07-18 14:37:35,550 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:35,550 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:35,671 - __main__ - INFO - Memory usage: 518.2 MB
2025-07-18 14:37:35,754 - __main__ - INFO - Loading data for ['ETH/USD'] from 2020-07-19 14:37:35.282119 to 2021-07-19 14:37:35.282119
2025-07-18 14:37:35,754 - __main__ - INFO - Loading data for ETH/USD from 2020-07-19 14:37:35.282119 to 2021-07-19 14:37:35.282119
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 518.2 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:37,774 - __main__ - INFO - Enhanced data preparation completed in 2.10 seconds
2025-07-18 14:37:37,775 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:37,850 - __main__ - INFO - Memory usage: 539.1 MB
2025-07-18 14:37:37,850 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:37:37,862 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(466), np.int64(1): np.int64(51), np.int64(2): np.int64(483)}
2025-07-18 14:37:37,863 - __main__ - INFO - Preparing test data...
2025-07-18 14:37:37,863 - __main__ - INFO - Preparing data for period: 2021-07-19 to 2021-09-17
2025-07-18 14:37:37,863 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:37,863 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:37,939 - __main__ - INFO - Memory usage: 539.9 MB
2025-07-18 14:37:38,014 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-07-19 14:37:35.282119 to 2021-09-17 14:37:35.282119
2025-07-18 14:37:38,015 - __main__ - INFO - Loading data for ETH/USD from 2021-07-19 14:37:35.282119 to 2021-09-17 14:37:35.282119
2025-07-18 14:37:39,276 - __main__ - INFO - Enhanced data preparation completed in 1.34 seconds
2025-07-18 14:37:39,277 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:39,352 - __main__ - INFO - Memory usage: 555.0 MB
2025-07-18 14:37:39,352 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:37:39,353 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(459), np.int64(1): np.int64(34), np.int64(2): np.int64(507)}
2025-07-18 14:37:39,353 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:37:39,353 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:37:39,353 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(466), np.int64(1): np.int64(51), np.int64(2): np.int64(483)}
2025-07-18 14:37:39,353 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:37:39,353 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:37:39,354 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2890
2025-07-18 14:37:39,354 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 13.0719
2025-07-18 14:37:39,354 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.2084
2025-07-18 14:37:39,354 - __main__ - INFO - Class distribution: {np.int64(2): 483, np.int64(0): 466, np.int64(1): 51}
2025-07-18 14:37:39,354 - __main__ - INFO - Original class weights: [0.7153075822603719, 6.5359477124183005, 0.6901311249137336]
2025-07-18 14:37:39,413 - __main__ - INFO - Adjusted class weights: tensor([ 2.2890, 13.0719,  2.2084])
2025-07-18 14:37:39,413 - __main__ - INFO - Creating trainer...
2025-07-18 14:37:39,413 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:37:39,413 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:37:39,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:37:39,460 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:37:39,575 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:37:39,575 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:37:42,069 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:37:42,070 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.2890, 13.0719,  2.2084])
2025-07-18 14:37:42,070 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:37:42,070 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:37:42,070 - __main__ - INFO - Starting training for period 2020-07_to_2021-09...
2025-07-18 14:37:42,070 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:37:42,070 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2020-07-19 14:37:35.282119 to 2021-07-19 14:37:35.282119
2025-07-18 14:37:42,070 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 555.4 MB
Memory usage: 536.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 539.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 539.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 581.9 MB
Memory usage: 567.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 555.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.2890, 13.0719,  2.2084])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2020-07-19 14:37:35.282119 to 2021-07-19 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 790.6 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:44,412 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:44,437 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(482), np.int64(1): np.int64(40), np.int64(2): np.int64(478)}
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:37:44,438 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:37:44,447 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:37:44,464 - __main__ - ERROR - Error in train_and_evaluate_period for 2020-07_to_2021-09: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:37:44,465 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:37:44,468 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:37:44,468 - __main__ - ERROR - ✗ Period 2020-07_to_2021-09 failed
2025-07-18 14:37:44,468 - __main__ - INFO - Progress Summary:
2025-07-18 14:37:44,468 - __main__ - INFO -   Completed: 1/47 periods
2025-07-18 14:37:44,468 - __main__ - INFO -   Successful: 0, Failed: 1
2025-07-18 14:37:44,468 - __main__ - INFO -   Elapsed time: 0.1 minutes
2025-07-18 14:37:44,468 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:37:44,468 - __main__ - INFO -   Estimated remaining time: 6.8 minutes
Processing periods:   2%|▏         | 1/47 [00:08<06:50,  8.92s/period]2025-07-18 14:37:44,469 - __main__ - INFO - 
============================================================
2025-07-18 14:37:44,469 - __main__ - INFO - Processing period 2/47: 2020-08_to_2021-10
2025-07-18 14:37:44,469 - __main__ - INFO - Progress: 2/47 (4.3%)
2025-07-18 14:37:44,469 - __main__ - INFO - ============================================================
2025-07-18 14:37:44,469 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:37:44,469 - __main__ - INFO - Using default hyperparameters for period 1
2025-07-18 14:37:44,469 - __main__ - INFO - Processing period: 2020-08_to_2021-10
2025-07-18 14:37:44,469 - __main__ - INFO - Preparing training data...
2025-07-18 14:37:44,469 - __main__ - INFO - Preparing data for period: 2020-08-18 to 2021-08-18
2025-07-18 14:37:44,470 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:44,470 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:44,590 - __main__ - INFO - Memory usage: 823.7 MB
2025-07-18 14:37:44,704 - __main__ - INFO - Loading data for ['ETH/USD'] from 2020-08-18 14:37:35.282119 to 2021-08-18 14:37:35.282119
2025-07-18 14:37:44,704 - __main__ - INFO - Loading data for ETH/USD from 2020-08-18 14:37:35.282119 to 2021-08-18 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 850.2 MB
Memory usage: 850.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 850.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(482), np.int64(1): np.int64(40), np.int64(2): np.int64(478)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 823.7 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:46,860 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:37:46,860 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:46,973 - __main__ - INFO - Memory usage: 839.3 MB
2025-07-18 14:37:46,973 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:37:46,973 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(450), np.int64(1): np.int64(49), np.int64(2): np.int64(501)}
2025-07-18 14:37:46,973 - __main__ - INFO - Preparing test data...
2025-07-18 14:37:46,973 - __main__ - INFO - Preparing data for period: 2021-08-18 to 2021-10-17
2025-07-18 14:37:46,974 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:46,974 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:47,087 - __main__ - INFO - Memory usage: 839.3 MB
2025-07-18 14:37:47,199 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-08-18 14:37:35.282119 to 2021-10-17 14:37:35.282119
2025-07-18 14:37:47,199 - __main__ - INFO - Loading data for ETH/USD from 2021-08-18 14:37:35.282119 to 2021-10-17 14:37:35.282119
2025-07-18 14:37:48,519 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:37:48,519 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:48,631 - __main__ - INFO - Memory usage: 854.5 MB
2025-07-18 14:37:48,631 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:37:48,632 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(477), np.int64(1): np.int64(43), np.int64(2): np.int64(480)}
2025-07-18 14:37:48,632 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:37:48,632 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:37:48,632 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(450), np.int64(1): np.int64(49), np.int64(2): np.int64(501)}
2025-07-18 14:37:48,632 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:37:48,632 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:37:48,633 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.3704
2025-07-18 14:37:48,633 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 13.6054
2025-07-18 14:37:48,633 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.1291
2025-07-18 14:37:48,633 - __main__ - INFO - Class distribution: {np.int64(0): 450, np.int64(2): 501, np.int64(1): 49}
2025-07-18 14:37:48,633 - __main__ - INFO - Original class weights: [0.7407407407407407, 6.802721088435374, 0.6653359946773121]
2025-07-18 14:37:48,633 - __main__ - INFO - Adjusted class weights: tensor([ 2.3704, 13.6054,  2.1291])
2025-07-18 14:37:48,633 - __main__ - INFO - Creating trainer...
2025-07-18 14:37:48,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:37:48,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:37:48,634 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:37:48,637 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:37:48,638 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:37:48,638 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:37:48,638 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:37:48,639 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.3704, 13.6054,  2.1291])
2025-07-18 14:37:48,639 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:37:48,639 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:37:48,639 - __main__ - INFO - Starting training for period 2020-08_to_2021-10...
2025-07-18 14:37:48,639 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:37:48,639 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2020-08-18 14:37:35.282119 to 2021-08-18 14:37:35.282119
2025-07-18 14:37:48,639 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 839.3 MB
Memory usage: 839.3 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 839.3 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 839.3 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 854.5 MB
Memory usage: 854.5 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 854.5 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.3704, 13.6054,  2.1291])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2020-08-18 14:37:35.282119 to 2021-08-18 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 854.7 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:50,959 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:50,963 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:37:50,963 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(432), np.int64(1): np.int64(48), np.int64(2): np.int64(520)}
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:37:50,964 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:37:50,965 - __main__ - ERROR - Error in train_and_evaluate_period for 2020-08_to_2021-10: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:37:50,965 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:37:50,969 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:37:50,970 - __main__ - ERROR - ✗ Period 2020-08_to_2021-10 failed
2025-07-18 14:37:50,970 - __main__ - INFO - Progress Summary:
2025-07-18 14:37:50,970 - __main__ - INFO -   Completed: 2/47 periods
2025-07-18 14:37:50,970 - __main__ - INFO -   Successful: 0, Failed: 2
2025-07-18 14:37:50,970 - __main__ - INFO -   Elapsed time: 0.3 minutes
2025-07-18 14:37:50,970 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:37:50,970 - __main__ - INFO -   Estimated remaining time: 5.8 minutes
Processing periods:   4%|▍         | 2/47 [00:15<05:37,  7.50s/period]2025-07-18 14:37:50,971 - __main__ - INFO - 
============================================================
2025-07-18 14:37:50,971 - __main__ - INFO - Processing period 3/47: 2020-09_to_2021-11
2025-07-18 14:37:50,971 - __main__ - INFO - Progress: 3/47 (6.4%)
2025-07-18 14:37:50,971 - __main__ - INFO - ============================================================
2025-07-18 14:37:50,971 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:37:50,971 - __main__ - INFO - Using default hyperparameters for period 2
2025-07-18 14:37:50,971 - __main__ - INFO - Processing period: 2020-09_to_2021-11
2025-07-18 14:37:50,972 - __main__ - INFO - Preparing training data...
2025-07-18 14:37:50,972 - __main__ - INFO - Preparing data for period: 2020-09-17 to 2021-09-17
2025-07-18 14:37:50,972 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:50,972 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:51,091 - __main__ - INFO - Memory usage: 806.4 MB
2025-07-18 14:37:51,203 - __main__ - INFO - Loading data for ['ETH/USD'] from 2020-09-17 14:37:35.282119 to 2021-09-17 14:37:35.282119
2025-07-18 14:37:51,203 - __main__ - INFO - Loading data for ETH/USD from 2020-09-17 14:37:35.282119 to 2021-09-17 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 868.3 MB
Memory usage: 868.3 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 868.3 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(432), np.int64(1): np.int64(48), np.int64(2): np.int64(520)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 806.4 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:53,412 - __main__ - INFO - Enhanced data preparation completed in 2.32 seconds
2025-07-18 14:37:53,412 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:53,526 - __main__ - INFO - Memory usage: 841.7 MB
2025-07-18 14:37:53,527 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:37:53,527 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(428), np.int64(1): np.int64(55), np.int64(2): np.int64(517)}
2025-07-18 14:37:53,527 - __main__ - INFO - Preparing test data...
2025-07-18 14:37:53,527 - __main__ - INFO - Preparing data for period: 2021-09-17 to 2021-11-16
2025-07-18 14:37:53,528 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:53,528 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:53,642 - __main__ - INFO - Memory usage: 841.7 MB
2025-07-18 14:37:53,757 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-09-17 14:37:35.282119 to 2021-11-16 14:37:35.282119
2025-07-18 14:37:53,757 - __main__ - INFO - Loading data for ETH/USD from 2021-09-17 14:37:35.282119 to 2021-11-16 14:37:35.282119
2025-07-18 14:37:55,140 - __main__ - INFO - Enhanced data preparation completed in 1.50 seconds
2025-07-18 14:37:55,140 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:55,254 - __main__ - INFO - Memory usage: 864.3 MB
2025-07-18 14:37:55,254 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:37:55,254 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(492), np.int64(1): np.int64(69), np.int64(2): np.int64(439)}
2025-07-18 14:37:55,254 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:37:55,254 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:37:55,254 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(428), np.int64(1): np.int64(55), np.int64(2): np.int64(517)}
2025-07-18 14:37:55,254 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:37:55,255 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:37:55,255 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.4922
2025-07-18 14:37:55,255 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 12.1212
2025-07-18 14:37:55,255 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.0632
2025-07-18 14:37:55,255 - __main__ - INFO - Class distribution: {np.int64(0): 428, np.int64(2): 517, np.int64(1): 55}
2025-07-18 14:37:55,255 - __main__ - INFO - Original class weights: [0.778816199376947, 6.0606060606060606, 0.6447453255963894]
2025-07-18 14:37:55,256 - __main__ - INFO - Adjusted class weights: tensor([ 2.4922, 12.1212,  2.0632])
2025-07-18 14:37:55,256 - __main__ - INFO - Creating trainer...
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:37:55,256 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:37:55,257 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:37:55,259 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:37:55,260 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:37:55,260 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:37:55,260 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:37:55,261 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.4922, 12.1212,  2.0632])
2025-07-18 14:37:55,261 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:37:55,261 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:37:55,261 - __main__ - INFO - Starting training for period 2020-09_to_2021-11...
2025-07-18 14:37:55,261 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:37:55,261 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2020-09-17 14:37:35.282119 to 2021-09-17 14:37:35.282119
2025-07-18 14:37:55,261 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 841.7 MB
Memory usage: 841.7 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 841.7 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 841.7 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.3 MB
Memory usage: 864.3 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 864.3 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.4922, 12.1212,  2.0632])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2020-09-17 14:37:35.282119 to 2021-09-17 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 864.4 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:57,538 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:37:57,543 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:37:57,543 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:37:57,543 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:37:57,543 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:37:57,543 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:37:57,544 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(44), np.int64(2): np.int64(470)}
2025-07-18 14:37:57,544 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:37:57,544 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:37:57,544 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:37:57,544 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:37:57,544 - __main__ - ERROR - Error in train_and_evaluate_period for 2020-09_to_2021-11: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:37:57,544 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:37:57,545 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:37:57,545 - __main__ - ERROR - ✗ Period 2020-09_to_2021-11 failed
2025-07-18 14:37:57,545 - __main__ - INFO - Progress Summary:
2025-07-18 14:37:57,545 - __main__ - INFO -   Completed: 3/47 periods
2025-07-18 14:37:57,545 - __main__ - INFO -   Successful: 0, Failed: 3
2025-07-18 14:37:57,545 - __main__ - INFO -   Elapsed time: 0.4 minutes
2025-07-18 14:37:57,545 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:37:57,546 - __main__ - INFO -   Estimated remaining time: 5.4 minutes
Processing periods:   6%|▋         | 3/47 [00:21<05:11,  7.08s/period]2025-07-18 14:37:57,546 - __main__ - INFO - 
============================================================
2025-07-18 14:37:57,546 - __main__ - INFO - Processing period 4/47: 2020-10_to_2021-12
2025-07-18 14:37:57,546 - __main__ - INFO - Progress: 4/47 (8.5%)
2025-07-18 14:37:57,546 - __main__ - INFO - ============================================================
2025-07-18 14:37:57,548 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:37:57,548 - __main__ - INFO - Using default hyperparameters for period 3
2025-07-18 14:37:57,548 - __main__ - INFO - Processing period: 2020-10_to_2021-12
2025-07-18 14:37:57,548 - __main__ - INFO - Preparing training data...
2025-07-18 14:37:57,548 - __main__ - INFO - Preparing data for period: 2020-10-17 to 2021-10-17
2025-07-18 14:37:57,549 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:37:57,549 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:37:57,672 - __main__ - INFO - Memory usage: 856.8 MB
2025-07-18 14:37:57,786 - __main__ - INFO - Loading data for ['ETH/USD'] from 2020-10-17 14:37:35.282119 to 2021-10-17 14:37:35.282119
2025-07-18 14:37:57,786 - __main__ - INFO - Loading data for ETH/USD from 2020-10-17 14:37:35.282119 to 2021-10-17 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 854.8 MB
Memory usage: 854.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 854.8 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(44), np.int64(2): np.int64(470)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 856.8 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:37:59,940 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:37:59,940 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:00,053 - __main__ - INFO - Memory usage: 857.5 MB
2025-07-18 14:38:00,053 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:00,053 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(462), np.int64(1): np.int64(27), np.int64(2): np.int64(511)}
2025-07-18 14:38:00,053 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:00,053 - __main__ - INFO - Preparing data for period: 2021-10-17 to 2021-12-16
2025-07-18 14:38:00,054 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:00,054 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:00,166 - __main__ - INFO - Memory usage: 857.5 MB
2025-07-18 14:38:00,278 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-10-17 14:37:35.282119 to 2021-12-16 14:37:35.282119
2025-07-18 14:38:00,279 - __main__ - INFO - Loading data for ETH/USD from 2021-10-17 14:37:35.282119 to 2021-12-16 14:37:35.282119
2025-07-18 14:38:01,601 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:38:01,601 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:01,713 - __main__ - INFO - Memory usage: 864.8 MB
2025-07-18 14:38:01,713 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:01,713 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(459), np.int64(1): np.int64(43), np.int64(2): np.int64(498)}
2025-07-18 14:38:01,713 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:01,713 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:01,714 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(462), np.int64(1): np.int64(27), np.int64(2): np.int64(511)}
2025-07-18 14:38:01,714 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:01,714 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:01,714 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.3088
2025-07-18 14:38:01,714 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 24.6914
2025-07-18 14:38:01,714 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.0874
2025-07-18 14:38:01,714 - __main__ - INFO - Class distribution: {np.int64(2): 511, np.int64(0): 462, np.int64(1): 27}
2025-07-18 14:38:01,714 - __main__ - INFO - Original class weights: [0.7215007215007215, 12.345679012345679, 0.6523157208088715]
2025-07-18 14:38:01,715 - __main__ - INFO - Adjusted class weights: tensor([ 2.3088, 24.6914,  2.0874])
2025-07-18 14:38:01,715 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:01,715 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:01,715 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:01,715 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:01,715 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:01,715 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:01,716 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:01,716 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:01,716 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:01,716 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:01,718 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:01,719 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:01,719 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:01,719 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:01,719 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.3088, 24.6914,  2.0874])
2025-07-18 14:38:01,720 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:01,720 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:01,720 - __main__ - INFO - Starting training for period 2020-10_to_2021-12...
2025-07-18 14:38:01,720 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:01,720 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2020-10-17 14:37:35.282119 to 2021-10-17 14:37:35.282119
2025-07-18 14:38:01,720 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 857.5 MB
Memory usage: 857.5 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 857.5 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.5 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.8 MB
Memory usage: 864.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 864.8 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.3088, 24.6914,  2.0874])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2020-10-17 14:37:35.282119 to 2021-10-17 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 864.8 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:03,972 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:03,976 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:03,976 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(466), np.int64(1): np.int64(34), np.int64(2): np.int64(500)}
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:03,977 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:03,978 - __main__ - ERROR - Error in train_and_evaluate_period for 2020-10_to_2021-12: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:03,978 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:03,978 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:03,979 - __main__ - ERROR - ✗ Period 2020-10_to_2021-12 failed
2025-07-18 14:38:03,979 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:03,979 - __main__ - INFO -   Completed: 4/47 periods
2025-07-18 14:38:03,979 - __main__ - INFO -   Successful: 0, Failed: 4
2025-07-18 14:38:03,979 - __main__ - INFO -   Elapsed time: 0.5 minutes
2025-07-18 14:38:03,979 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:03,979 - __main__ - INFO -   Estimated remaining time: 5.1 minutes
Processing periods:   9%|▊         | 4/47 [00:28<04:53,  6.82s/period]2025-07-18 14:38:03,979 - __main__ - INFO - 
============================================================
2025-07-18 14:38:03,979 - __main__ - INFO - Processing period 5/47: 2020-11_to_2022-01
2025-07-18 14:38:03,979 - __main__ - INFO - Progress: 5/47 (10.6%)
2025-07-18 14:38:03,979 - __main__ - INFO - ============================================================
2025-07-18 14:38:03,981 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:03,981 - __main__ - INFO - Using default hyperparameters for period 4
2025-07-18 14:38:03,982 - __main__ - INFO - Processing period: 2020-11_to_2022-01
2025-07-18 14:38:03,982 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:03,982 - __main__ - INFO - Preparing data for period: 2020-11-16 to 2021-11-16
2025-07-18 14:38:03,982 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:03,982 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:04,111 - __main__ - INFO - Memory usage: 857.1 MB
2025-07-18 14:38:04,229 - __main__ - INFO - Loading data for ['ETH/USD'] from 2020-11-16 14:37:35.282119 to 2021-11-16 14:37:35.282119
2025-07-18 14:38:04,229 - __main__ - INFO - Loading data for ETH/USD from 2020-11-16 14:37:35.282119 to 2021-11-16 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 854.2 MB
Memory usage: 854.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 854.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(466), np.int64(1): np.int64(34), np.int64(2): np.int64(500)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:06,402 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:38:06,403 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:06,516 - __main__ - INFO - Memory usage: 857.1 MB
2025-07-18 14:38:06,516 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:06,516 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(475), np.int64(1): np.int64(28), np.int64(2): np.int64(497)}
2025-07-18 14:38:06,516 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:06,516 - __main__ - INFO - Preparing data for period: 2021-11-16 to 2022-01-15
2025-07-18 14:38:06,517 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:06,517 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:06,631 - __main__ - INFO - Memory usage: 857.1 MB
2025-07-18 14:38:06,744 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-11-16 14:37:35.282119 to 2022-01-15 14:37:35.282119
2025-07-18 14:38:06,744 - __main__ - INFO - Loading data for ETH/USD from 2021-11-16 14:37:35.282119 to 2022-01-15 14:37:35.282119
2025-07-18 14:38:08,068 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:38:08,068 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:08,181 - __main__ - INFO - Memory usage: 864.1 MB
2025-07-18 14:38:08,181 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:08,181 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(487), np.int64(1): np.int64(74), np.int64(2): np.int64(439)}
2025-07-18 14:38:08,181 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:08,182 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:08,182 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(475), np.int64(1): np.int64(28), np.int64(2): np.int64(497)}
2025-07-18 14:38:08,182 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:08,182 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:08,182 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2456
2025-07-18 14:38:08,182 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 23.8095
2025-07-18 14:38:08,182 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.1462
2025-07-18 14:38:08,182 - __main__ - INFO - Class distribution: {np.int64(0): 475, np.int64(2): 497, np.int64(1): 28}
2025-07-18 14:38:08,182 - __main__ - INFO - Original class weights: [0.7017543859649122, 11.904761904761905, 0.670690811535882]
2025-07-18 14:38:08,183 - __main__ - INFO - Adjusted class weights: tensor([ 2.2456, 23.8095,  2.1462])
2025-07-18 14:38:08,183 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:08,183 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:08,183 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:08,183 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:08,183 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:08,183 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:08,184 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:08,184 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:08,184 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:08,184 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:08,186 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:08,187 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:08,187 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:08,187 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:08,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.2456, 23.8095,  2.1462])
2025-07-18 14:38:08,188 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:08,188 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:08,188 - __main__ - INFO - Starting training for period 2020-11_to_2022-01...
2025-07-18 14:38:08,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:08,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2020-11-16 14:37:35.282119 to 2021-11-16 14:37:35.282119
2025-07-18 14:38:08,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 857.1 MB
Memory usage: 857.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 857.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.1 MB
Memory usage: 864.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 864.1 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.2456, 23.8095,  2.1462])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2020-11-16 14:37:35.282119 to 2021-11-16 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 864.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:10,461 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(32), np.int64(2): np.int64(482)}
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:10,466 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:10,467 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:10,467 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:10,467 - __main__ - ERROR - Error in train_and_evaluate_period for 2020-11_to_2022-01: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:10,467 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:10,467 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:10,469 - __main__ - ERROR - ✗ Period 2020-11_to_2022-01 failed
2025-07-18 14:38:10,469 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:10,469 - __main__ - INFO -   Completed: 5/47 periods
2025-07-18 14:38:10,469 - __main__ - INFO -   Successful: 0, Failed: 5
2025-07-18 14:38:10,469 - __main__ - INFO -   Elapsed time: 0.6 minutes
2025-07-18 14:38:10,469 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:10,469 - __main__ - INFO -   Estimated remaining time: 4.9 minutes
Processing periods:  11%|█         | 5/47 [00:34<04:41,  6.70s/period]2025-07-18 14:38:10,470 - __main__ - INFO - 
============================================================
2025-07-18 14:38:10,470 - __main__ - INFO - Processing period 6/47: 2020-12_to_2022-02
2025-07-18 14:38:10,470 - __main__ - INFO - Progress: 6/47 (12.8%)
2025-07-18 14:38:10,470 - __main__ - INFO - ============================================================
2025-07-18 14:38:10,471 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:10,471 - __main__ - INFO - Using default hyperparameters for period 5
2025-07-18 14:38:10,471 - __main__ - INFO - Processing period: 2020-12_to_2022-02
2025-07-18 14:38:10,471 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:10,471 - __main__ - INFO - Preparing data for period: 2020-12-16 to 2021-12-16
2025-07-18 14:38:10,471 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:10,472 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:10,591 - __main__ - INFO - Memory usage: 825.8 MB
2025-07-18 14:38:10,704 - __main__ - INFO - Loading data for ['ETH/USD'] from 2020-12-16 14:37:35.282119 to 2021-12-16 14:37:35.282119
2025-07-18 14:38:10,704 - __main__ - INFO - Loading data for ETH/USD from 2020-12-16 14:37:35.282119 to 2021-12-16 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 873.4 MB
Memory usage: 873.4 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 873.4 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(32), np.int64(2): np.int64(482)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 825.8 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:12,862 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:38:12,862 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:12,974 - __main__ - INFO - Memory usage: 846.2 MB
2025-07-18 14:38:12,974 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:12,975 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(501), np.int64(1): np.int64(25), np.int64(2): np.int64(474)}
2025-07-18 14:38:12,975 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:12,975 - __main__ - INFO - Preparing data for period: 2021-12-16 to 2022-02-14
2025-07-18 14:38:12,976 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:12,976 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:13,088 - __main__ - INFO - Memory usage: 846.2 MB
2025-07-18 14:38:13,200 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-12-16 14:37:35.282119 to 2022-02-14 14:37:35.282119
2025-07-18 14:38:13,200 - __main__ - INFO - Loading data for ETH/USD from 2021-12-16 14:37:35.282119 to 2022-02-14 14:37:35.282119
2025-07-18 14:38:14,519 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:38:14,519 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:14,631 - __main__ - INFO - Memory usage: 864.9 MB
2025-07-18 14:38:14,631 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:14,631 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(465), np.int64(1): np.int64(72), np.int64(2): np.int64(463)}
2025-07-18 14:38:14,631 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:14,631 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:14,631 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(501), np.int64(1): np.int64(25), np.int64(2): np.int64(474)}
2025-07-18 14:38:14,632 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:14,632 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:14,632 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.1291
2025-07-18 14:38:14,632 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 26.6667
2025-07-18 14:38:14,632 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.2504
2025-07-18 14:38:14,632 - __main__ - INFO - Class distribution: {np.int64(2): 474, np.int64(0): 501, np.int64(1): 25}
2025-07-18 14:38:14,632 - __main__ - INFO - Original class weights: [0.6653359946773121, 13.333333333333334, 0.7032348804500703]
2025-07-18 14:38:14,633 - __main__ - INFO - Adjusted class weights: tensor([ 2.1291, 26.6667,  2.2504])
2025-07-18 14:38:14,633 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:14,633 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:14,635 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.1291, 26.6667,  2.2504])
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:14,637 - __main__ - INFO - Starting training for period 2020-12_to_2022-02...
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:14,637 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2020-12-16 14:37:35.282119 to 2021-12-16 14:37:35.282119
2025-07-18 14:38:14,638 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 846.2 MB
Memory usage: 846.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 846.2 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 846.2 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.9 MB
Memory usage: 864.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 864.9 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.1291, 26.6667,  2.2504])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2020-12-16 14:37:35.282119 to 2021-12-16 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 864.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:16,903 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:16,907 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:16,907 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:16,907 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:16,907 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:16,907 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:16,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(22), np.int64(2): np.int64(492)}
2025-07-18 14:38:16,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:16,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:16,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:16,908 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:16,908 - __main__ - ERROR - Error in train_and_evaluate_period for 2020-12_to_2022-02: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:16,908 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:16,912 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:16,914 - __main__ - ERROR - ✗ Period 2020-12_to_2022-02 failed
2025-07-18 14:38:16,914 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:16,914 - __main__ - INFO -   Completed: 6/47 periods
2025-07-18 14:38:16,914 - __main__ - INFO -   Successful: 0, Failed: 6
2025-07-18 14:38:16,914 - __main__ - INFO -   Elapsed time: 0.7 minutes
2025-07-18 14:38:16,914 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:16,914 - __main__ - INFO -   Estimated remaining time: 4.7 minutes
Processing periods:  13%|█▎        | 6/47 [00:41<04:31,  6.62s/period]2025-07-18 14:38:16,914 - __main__ - INFO - 
============================================================
2025-07-18 14:38:16,914 - __main__ - INFO - Processing period 7/47: 2021-01_to_2022-03
2025-07-18 14:38:16,914 - __main__ - INFO - Progress: 7/47 (14.9%)
2025-07-18 14:38:16,914 - __main__ - INFO - ============================================================
2025-07-18 14:38:16,915 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:16,915 - __main__ - INFO - Using default hyperparameters for period 6
2025-07-18 14:38:16,915 - __main__ - INFO - Processing period: 2021-01_to_2022-03
2025-07-18 14:38:16,915 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:16,915 - __main__ - INFO - Preparing data for period: 2021-01-15 to 2022-01-15
2025-07-18 14:38:16,915 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:16,915 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:17,033 - __main__ - INFO - Memory usage: 826.6 MB
2025-07-18 14:38:17,145 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-01-15 14:37:35.282119 to 2022-01-15 14:37:35.282119
2025-07-18 14:38:17,145 - __main__ - INFO - Loading data for ETH/USD from 2021-01-15 14:37:35.282119 to 2022-01-15 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 874.2 MB
Memory usage: 874.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 874.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(22), np.int64(2): np.int64(492)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.6 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:19,389 - __main__ - INFO - Enhanced data preparation completed in 2.36 seconds
2025-07-18 14:38:19,390 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:19,504 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:38:19,504 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:19,504 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(491), np.int64(1): np.int64(29), np.int64(2): np.int64(480)}
2025-07-18 14:38:19,504 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:19,505 - __main__ - INFO - Preparing data for period: 2022-01-15 to 2022-03-16
2025-07-18 14:38:19,505 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:19,505 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:19,639 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:38:19,753 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-01-15 14:37:35.282119 to 2022-03-16 14:37:35.282119
2025-07-18 14:38:19,753 - __main__ - INFO - Loading data for ETH/USD from 2022-01-15 14:37:35.282119 to 2022-03-16 14:37:35.282119
2025-07-18 14:38:21,153 - __main__ - INFO - Enhanced data preparation completed in 1.51 seconds
2025-07-18 14:38:21,153 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:21,268 - __main__ - INFO - Memory usage: 865.9 MB
2025-07-18 14:38:21,268 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:21,268 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(504), np.int64(1): np.int64(49), np.int64(2): np.int64(447)}
2025-07-18 14:38:21,268 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:21,268 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:21,268 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(491), np.int64(1): np.int64(29), np.int64(2): np.int64(480)}
2025-07-18 14:38:21,268 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:21,268 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:21,269 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.1724
2025-07-18 14:38:21,269 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 22.9885
2025-07-18 14:38:21,269 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.2222
2025-07-18 14:38:21,269 - __main__ - INFO - Class distribution: {np.int64(2): 480, np.int64(0): 491, np.int64(1): 29}
2025-07-18 14:38:21,269 - __main__ - INFO - Original class weights: [0.6788866259334692, 11.494252873563218, 0.6944444444444444]
2025-07-18 14:38:21,270 - __main__ - INFO - Adjusted class weights: tensor([ 2.1724, 22.9885,  2.2222])
2025-07-18 14:38:21,270 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:21,270 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:21,270 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:21,270 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:21,270 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:21,270 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:21,271 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:21,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:21,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:21,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:21,273 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:21,274 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:21,274 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:21,274 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:21,275 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.1724, 22.9885,  2.2222])
2025-07-18 14:38:21,275 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:21,275 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:21,275 - __main__ - INFO - Starting training for period 2021-01_to_2022-03...
2025-07-18 14:38:21,275 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:21,275 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-01-15 14:37:35.282119 to 2022-01-15 14:37:35.282119
2025-07-18 14:38:21,275 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 865.9 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.1724, 22.9885,  2.2222])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-01-15 14:37:35.282119 to 2022-01-15 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 865.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:23,545 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:23,549 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:23,549 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:23,549 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:23,549 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:23,549 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:23,549 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(463), np.int64(1): np.int64(29), np.int64(2): np.int64(508)}
2025-07-18 14:38:23,550 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:23,550 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:23,550 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:23,550 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:23,550 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-01_to_2022-03: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:23,550 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:23,551 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:23,552 - __main__ - ERROR - ✗ Period 2021-01_to_2022-03 failed
2025-07-18 14:38:23,552 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:23,552 - __main__ - INFO -   Completed: 7/47 periods
2025-07-18 14:38:23,552 - __main__ - INFO -   Successful: 0, Failed: 7
2025-07-18 14:38:23,552 - __main__ - INFO -   Elapsed time: 0.8 minutes
2025-07-18 14:38:23,552 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:23,553 - __main__ - INFO -   Estimated remaining time: 4.6 minutes
Processing periods:  15%|█▍        | 7/47 [00:48<04:24,  6.62s/period]2025-07-18 14:38:23,553 - __main__ - INFO - 
============================================================
2025-07-18 14:38:23,553 - __main__ - INFO - Processing period 8/47: 2021-02_to_2022-04
2025-07-18 14:38:23,553 - __main__ - INFO - Progress: 8/47 (17.0%)
2025-07-18 14:38:23,553 - __main__ - INFO - ============================================================
2025-07-18 14:38:23,554 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:23,554 - __main__ - INFO - Using default hyperparameters for period 7
2025-07-18 14:38:23,554 - __main__ - INFO - Processing period: 2021-02_to_2022-04
2025-07-18 14:38:23,554 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:23,554 - __main__ - INFO - Preparing data for period: 2021-02-14 to 2022-02-14
2025-07-18 14:38:23,555 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:23,555 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:23,673 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:38:23,784 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-02-14 14:37:35.282119 to 2022-02-14 14:37:35.282119
2025-07-18 14:38:23,784 - __main__ - INFO - Loading data for ETH/USD from 2021-02-14 14:37:35.282119 to 2022-02-14 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.1 MB
Memory usage: 875.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.1 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(463), np.int64(1): np.int64(29), np.int64(2): np.int64(508)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:25,940 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:38:25,940 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:26,052 - __main__ - INFO - Memory usage: 847.2 MB
2025-07-18 14:38:26,052 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:26,053 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(473), np.int64(1): np.int64(38), np.int64(2): np.int64(489)}
2025-07-18 14:38:26,053 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:26,053 - __main__ - INFO - Preparing data for period: 2022-02-14 to 2022-04-15
2025-07-18 14:38:26,054 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:26,054 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:26,166 - __main__ - INFO - Memory usage: 847.2 MB
2025-07-18 14:38:26,278 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-02-14 14:37:35.282119 to 2022-04-15 14:37:35.282119
2025-07-18 14:38:26,278 - __main__ - INFO - Loading data for ETH/USD from 2022-02-14 14:37:35.282119 to 2022-04-15 14:37:35.282119
2025-07-18 14:38:27,618 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:38:27,618 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:27,730 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:38:27,730 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:27,730 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(437), np.int64(1): np.int64(125), np.int64(2): np.int64(438)}
2025-07-18 14:38:27,730 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:27,730 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:27,730 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(473), np.int64(1): np.int64(38), np.int64(2): np.int64(489)}
2025-07-18 14:38:27,731 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:27,731 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:27,731 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2551
2025-07-18 14:38:27,731 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 17.5439
2025-07-18 14:38:27,731 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.1813
2025-07-18 14:38:27,731 - __main__ - INFO - Class distribution: {np.int64(0): 473, np.int64(2): 489, np.int64(1): 38}
2025-07-18 14:38:27,731 - __main__ - INFO - Original class weights: [0.704721634954193, 8.771929824561404, 0.6816632583503749]
2025-07-18 14:38:27,732 - __main__ - INFO - Adjusted class weights: tensor([ 2.2551, 17.5439,  2.1813])
2025-07-18 14:38:27,732 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:27,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:27,733 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:27,733 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:27,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.2551, 17.5439,  2.1813])
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:27,736 - __main__ - INFO - Starting training for period 2021-02_to_2022-04...
2025-07-18 14:38:27,736 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:27,737 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-02-14 14:37:35.282119 to 2022-02-14 14:37:35.282119
2025-07-18 14:38:27,737 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.2 MB
Memory usage: 847.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.2 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.2 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.2551, 17.5439,  2.1813])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-02-14 14:37:35.282119 to 2022-02-14 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:30,019 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:30,027 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:30,027 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:30,027 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:30,027 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:30,027 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:30,028 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(469), np.int64(1): np.int64(37), np.int64(2): np.int64(494)}
2025-07-18 14:38:30,028 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:30,028 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:30,028 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:30,028 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:30,028 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-02_to_2022-04: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:30,028 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:30,029 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:30,030 - __main__ - ERROR - ✗ Period 2021-02_to_2022-04 failed
2025-07-18 14:38:30,031 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:30,031 - __main__ - INFO -   Completed: 8/47 periods
2025-07-18 14:38:30,031 - __main__ - INFO -   Successful: 0, Failed: 8
2025-07-18 14:38:30,031 - __main__ - INFO -   Elapsed time: 0.9 minutes
2025-07-18 14:38:30,031 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:30,031 - __main__ - INFO -   Estimated remaining time: 4.4 minutes
Processing periods:  17%|█▋        | 8/47 [00:54<04:16,  6.58s/period]2025-07-18 14:38:30,031 - __main__ - INFO - 
============================================================
2025-07-18 14:38:30,031 - __main__ - INFO - Processing period 9/47: 2021-03_to_2022-05
2025-07-18 14:38:30,031 - __main__ - INFO - Progress: 9/47 (19.1%)
2025-07-18 14:38:30,031 - __main__ - INFO - ============================================================
2025-07-18 14:38:30,032 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:30,032 - __main__ - INFO - Using default hyperparameters for period 8
2025-07-18 14:38:30,032 - __main__ - INFO - Processing period: 2021-03_to_2022-05
2025-07-18 14:38:30,032 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:30,032 - __main__ - INFO - Preparing data for period: 2021-03-16 to 2022-03-16
2025-07-18 14:38:30,033 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:30,033 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:30,151 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:38:30,263 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-03-16 14:37:35.282119 to 2022-03-16 14:37:35.282119
2025-07-18 14:38:30,263 - __main__ - INFO - Loading data for ETH/USD from 2021-03-16 14:37:35.282119 to 2022-03-16 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(469), np.int64(1): np.int64(37), np.int64(2): np.int64(494)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:32,428 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:38:32,428 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:32,540 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:32,540 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:32,540 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(491), np.int64(1): np.int64(28), np.int64(2): np.int64(481)}
2025-07-18 14:38:32,540 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:32,541 - __main__ - INFO - Preparing data for period: 2022-03-16 to 2022-05-15
2025-07-18 14:38:32,542 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:32,542 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:32,654 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:32,766 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-03-16 14:37:35.282119 to 2022-05-15 14:37:35.282119
2025-07-18 14:38:32,766 - __main__ - INFO - Loading data for ETH/USD from 2022-03-16 14:37:35.282119 to 2022-05-15 14:37:35.282119
2025-07-18 14:38:34,106 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:38:34,106 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:34,218 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:38:34,219 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:34,219 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(426), np.int64(1): np.int64(168), np.int64(2): np.int64(406)}
2025-07-18 14:38:34,219 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:34,219 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:34,219 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(491), np.int64(1): np.int64(28), np.int64(2): np.int64(481)}
2025-07-18 14:38:34,219 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:34,219 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:34,220 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.1724
2025-07-18 14:38:34,220 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 23.8095
2025-07-18 14:38:34,220 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.2176
2025-07-18 14:38:34,220 - __main__ - INFO - Class distribution: {np.int64(2): 481, np.int64(0): 491, np.int64(1): 28}
2025-07-18 14:38:34,220 - __main__ - INFO - Original class weights: [0.6788866259334692, 11.904761904761905, 0.693000693000693]
2025-07-18 14:38:34,220 - __main__ - INFO - Adjusted class weights: tensor([ 2.1724, 23.8095,  2.2176])
2025-07-18 14:38:34,220 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:34,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:34,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:34,221 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:34,223 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:34,224 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:34,224 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:34,224 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:34,225 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.1724, 23.8095,  2.2176])
2025-07-18 14:38:34,225 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:34,225 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:34,225 - __main__ - INFO - Starting training for period 2021-03_to_2022-05...
2025-07-18 14:38:34,225 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:34,225 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-03-16 14:37:35.282119 to 2022-03-16 14:37:35.282119
2025-07-18 14:38:34,225 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.1724, 23.8095,  2.2176])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-03-16 14:37:35.282119 to 2022-03-16 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:36,496 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:36,500 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:36,500 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:36,500 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:36,500 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:36,500 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:36,501 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(471), np.int64(1): np.int64(41), np.int64(2): np.int64(488)}
2025-07-18 14:38:36,501 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:36,501 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:36,501 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:36,501 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:36,501 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-03_to_2022-05: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:36,501 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:36,502 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:36,503 - __main__ - ERROR - ✗ Period 2021-03_to_2022-05 failed
2025-07-18 14:38:36,503 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:36,504 - __main__ - INFO -   Completed: 9/47 periods
2025-07-18 14:38:36,504 - __main__ - INFO -   Successful: 0, Failed: 9
2025-07-18 14:38:36,504 - __main__ - INFO -   Elapsed time: 1.0 minutes
2025-07-18 14:38:36,504 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:36,504 - __main__ - INFO -   Estimated remaining time: 4.3 minutes
Processing periods:  19%|█▉        | 9/47 [01:00<04:08,  6.54s/period]2025-07-18 14:38:36,504 - __main__ - INFO - 
============================================================
2025-07-18 14:38:36,504 - __main__ - INFO - Processing period 10/47: 2021-04_to_2022-06
2025-07-18 14:38:36,504 - __main__ - INFO - Progress: 10/47 (21.3%)
2025-07-18 14:38:36,504 - __main__ - INFO - ============================================================
2025-07-18 14:38:36,505 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:36,505 - __main__ - INFO - Using default hyperparameters for period 9
2025-07-18 14:38:36,505 - __main__ - INFO - Processing period: 2021-04_to_2022-06
2025-07-18 14:38:36,505 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:36,505 - __main__ - INFO - Preparing data for period: 2021-04-15 to 2022-04-15
2025-07-18 14:38:36,506 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:36,506 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:36,625 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:38:36,737 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-04-15 14:37:35.282119 to 2022-04-15 14:37:35.282119
2025-07-18 14:38:36,737 - __main__ - INFO - Loading data for ETH/USD from 2021-04-15 14:37:35.282119 to 2022-04-15 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(471), np.int64(1): np.int64(41), np.int64(2): np.int64(488)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:38,920 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:38:38,920 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:39,032 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:39,032 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:39,032 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(474), np.int64(1): np.int64(56), np.int64(2): np.int64(470)}
2025-07-18 14:38:39,032 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:39,032 - __main__ - INFO - Preparing data for period: 2022-04-15 to 2022-06-14
2025-07-18 14:38:39,033 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:39,034 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:39,146 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:39,259 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-04-15 14:37:35.282119 to 2022-06-14 14:37:35.282119
2025-07-18 14:38:39,259 - __main__ - INFO - Loading data for ETH/USD from 2022-04-15 14:37:35.282119 to 2022-06-14 14:37:35.282119
2025-07-18 14:38:40,585 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:38:40,586 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:40,698 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:38:40,698 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:40,698 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(469), np.int64(1): np.int64(130), np.int64(2): np.int64(401)}
2025-07-18 14:38:40,698 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:40,698 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:40,698 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(474), np.int64(1): np.int64(56), np.int64(2): np.int64(470)}
2025-07-18 14:38:40,698 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:40,699 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:40,699 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2504
2025-07-18 14:38:40,699 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 11.9048
2025-07-18 14:38:40,699 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.2695
2025-07-18 14:38:40,699 - __main__ - INFO - Class distribution: {np.int64(0): 474, np.int64(2): 470, np.int64(1): 56}
2025-07-18 14:38:40,699 - __main__ - INFO - Original class weights: [0.7032348804500703, 5.9523809523809526, 0.7092198581560284]
2025-07-18 14:38:40,700 - __main__ - INFO - Adjusted class weights: tensor([ 2.2504, 11.9048,  2.2695])
2025-07-18 14:38:40,700 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:40,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:40,702 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:40,704 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:40,704 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:40,704 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:40,704 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.2504, 11.9048,  2.2695])
2025-07-18 14:38:40,704 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:40,704 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:40,705 - __main__ - INFO - Starting training for period 2021-04_to_2022-06...
2025-07-18 14:38:40,705 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:40,705 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-04-15 14:37:35.282119 to 2022-04-15 14:37:35.282119
2025-07-18 14:38:40,705 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.2504, 11.9048,  2.2695])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-04-15 14:37:35.282119 to 2022-04-15 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:42,983 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:42,986 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:42,986 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(463), np.int64(1): np.int64(65), np.int64(2): np.int64(472)}
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:42,987 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:42,987 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-04_to_2022-06: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:42,988 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:42,992 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:42,993 - __main__ - ERROR - ✗ Period 2021-04_to_2022-06 failed
2025-07-18 14:38:42,993 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:42,993 - __main__ - INFO -   Completed: 10/47 periods
2025-07-18 14:38:42,993 - __main__ - INFO -   Successful: 0, Failed: 10
2025-07-18 14:38:42,993 - __main__ - INFO -   Elapsed time: 1.1 minutes
2025-07-18 14:38:42,994 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:42,994 - __main__ - INFO -   Estimated remaining time: 4.2 minutes
Processing periods:  21%|██▏       | 10/47 [01:07<04:01,  6.53s/period]2025-07-18 14:38:42,994 - __main__ - INFO - 
============================================================
2025-07-18 14:38:42,994 - __main__ - INFO - Processing period 11/47: 2021-05_to_2022-07
2025-07-18 14:38:42,994 - __main__ - INFO - Progress: 11/47 (23.4%)
2025-07-18 14:38:42,994 - __main__ - INFO - ============================================================
2025-07-18 14:38:42,994 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:42,994 - __main__ - INFO - Using default hyperparameters for period 10
2025-07-18 14:38:42,994 - __main__ - INFO - Processing period: 2021-05_to_2022-07
2025-07-18 14:38:42,994 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:42,994 - __main__ - INFO - Preparing data for period: 2021-05-15 to 2022-05-15
2025-07-18 14:38:42,995 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:42,995 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:43,114 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:38:43,226 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-05-15 14:37:35.282119 to 2022-05-15 14:37:35.282119
2025-07-18 14:38:43,226 - __main__ - INFO - Loading data for ETH/USD from 2021-05-15 14:37:35.282119 to 2022-05-15 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(463), np.int64(1): np.int64(65), np.int64(2): np.int64(472)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:45,377 - __main__ - INFO - Enhanced data preparation completed in 2.26 seconds
2025-07-18 14:38:45,378 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:45,490 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:45,490 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:45,491 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(463), np.int64(1): np.int64(60), np.int64(2): np.int64(477)}
2025-07-18 14:38:45,491 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:45,491 - __main__ - INFO - Preparing data for period: 2022-05-15 to 2022-07-14
2025-07-18 14:38:45,492 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:45,492 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:45,608 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:45,741 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-05-15 14:37:35.282119 to 2022-07-14 14:37:35.282119
2025-07-18 14:38:45,742 - __main__ - INFO - Loading data for ETH/USD from 2022-05-15 14:37:35.282119 to 2022-07-14 14:37:35.282119
2025-07-18 14:38:47,067 - __main__ - INFO - Enhanced data preparation completed in 1.46 seconds
2025-07-18 14:38:47,067 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:47,180 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:38:47,180 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:47,180 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(495), np.int64(1): np.int64(49), np.int64(2): np.int64(456)}
2025-07-18 14:38:47,180 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:47,180 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:47,180 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(463), np.int64(1): np.int64(60), np.int64(2): np.int64(477)}
2025-07-18 14:38:47,180 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:47,180 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:47,181 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.3038
2025-07-18 14:38:47,181 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 11.1111
2025-07-18 14:38:47,181 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.2362
2025-07-18 14:38:47,181 - __main__ - INFO - Class distribution: {np.int64(2): 477, np.int64(0): 463, np.int64(1): 60}
2025-07-18 14:38:47,181 - __main__ - INFO - Original class weights: [0.7199424046076314, 5.555555555555555, 0.6988120195667366]
2025-07-18 14:38:47,181 - __main__ - INFO - Adjusted class weights: tensor([ 2.3038, 11.1111,  2.2362])
2025-07-18 14:38:47,181 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:47,181 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:47,182 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:47,184 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:47,185 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:47,185 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.3038, 11.1111,  2.2362])
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:47,186 - __main__ - INFO - Starting training for period 2021-05_to_2022-07...
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-05-15 14:37:35.282119 to 2022-05-15 14:37:35.282119
2025-07-18 14:38:47,186 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.3038, 11.1111,  2.2362])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-05-15 14:37:35.282119 to 2022-05-15 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:49,471 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:49,474 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:49,474 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(476), np.int64(1): np.int64(66), np.int64(2): np.int64(458)}
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:49,475 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:49,476 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-05_to_2022-07: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:49,476 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:49,476 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:49,478 - __main__ - ERROR - ✗ Period 2021-05_to_2022-07 failed
2025-07-18 14:38:49,478 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:49,478 - __main__ - INFO -   Completed: 11/47 periods
2025-07-18 14:38:49,478 - __main__ - INFO -   Successful: 0, Failed: 11
2025-07-18 14:38:49,478 - __main__ - INFO -   Elapsed time: 1.2 minutes
2025-07-18 14:38:49,478 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:49,478 - __main__ - INFO -   Estimated remaining time: 4.0 minutes
Processing periods:  23%|██▎       | 11/47 [01:13<03:54,  6.51s/period]2025-07-18 14:38:49,478 - __main__ - INFO - 
============================================================
2025-07-18 14:38:49,478 - __main__ - INFO - Processing period 12/47: 2021-06_to_2022-08
2025-07-18 14:38:49,478 - __main__ - INFO - Progress: 12/47 (25.5%)
2025-07-18 14:38:49,478 - __main__ - INFO - ============================================================
2025-07-18 14:38:49,479 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:49,479 - __main__ - INFO - Using default hyperparameters for period 11
2025-07-18 14:38:49,480 - __main__ - INFO - Processing period: 2021-06_to_2022-08
2025-07-18 14:38:49,480 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:49,480 - __main__ - INFO - Preparing data for period: 2021-06-14 to 2022-06-14
2025-07-18 14:38:49,480 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:49,480 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:49,600 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:38:49,713 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-06-14 14:37:35.282119 to 2022-06-14 14:37:35.282119
2025-07-18 14:38:49,713 - __main__ - INFO - Loading data for ETH/USD from 2021-06-14 14:37:35.282119 to 2022-06-14 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(476), np.int64(1): np.int64(66), np.int64(2): np.int64(458)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:51,875 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:38:51,875 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:51,988 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:51,988 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:51,988 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(65), np.int64(2): np.int64(449)}
2025-07-18 14:38:51,988 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:51,988 - __main__ - INFO - Preparing data for period: 2022-06-14 to 2022-08-13
2025-07-18 14:38:51,989 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:51,990 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:52,103 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:52,217 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-06-14 14:37:35.282119 to 2022-08-13 14:37:35.282119
2025-07-18 14:38:52,217 - __main__ - INFO - Loading data for ETH/USD from 2022-06-14 14:37:35.282119 to 2022-08-13 14:37:35.282119
2025-07-18 14:38:53,550 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:38:53,550 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:53,664 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:38:53,664 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:53,664 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(485), np.int64(1): np.int64(39), np.int64(2): np.int64(476)}
2025-07-18 14:38:53,664 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:38:53,664 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:38:53,664 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(486), np.int64(1): np.int64(65), np.int64(2): np.int64(449)}
2025-07-18 14:38:53,664 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:38:53,664 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:38:53,665 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.1948
2025-07-18 14:38:53,665 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 10.2564
2025-07-18 14:38:53,665 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.3756
2025-07-18 14:38:53,665 - __main__ - INFO - Class distribution: {np.int64(0): 486, np.int64(2): 449, np.int64(1): 65}
2025-07-18 14:38:53,665 - __main__ - INFO - Original class weights: [0.6858710562414266, 5.128205128205129, 0.7423904974016332]
2025-07-18 14:38:53,665 - __main__ - INFO - Adjusted class weights: tensor([ 2.1948, 10.2564,  2.3756])
2025-07-18 14:38:53,665 - __main__ - INFO - Creating trainer...
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:38:53,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:38:53,668 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:38:53,669 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:38:53,669 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.1948, 10.2564,  2.3756])
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:38:53,670 - __main__ - INFO - Starting training for period 2021-06_to_2022-08...
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-06-14 14:37:35.282119 to 2022-06-14 14:37:35.282119
2025-07-18 14:38:53,670 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.1948, 10.2564,  2.3756])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-06-14 14:37:35.282119 to 2022-06-14 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:55,967 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:55,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:38:55,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(483), np.int64(1): np.int64(61), np.int64(2): np.int64(456)}
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:38:55,971 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:38:55,972 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-06_to_2022-08: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:55,972 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:38:55,972 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:38:55,974 - __main__ - ERROR - ✗ Period 2021-06_to_2022-08 failed
2025-07-18 14:38:55,974 - __main__ - INFO - Progress Summary:
2025-07-18 14:38:55,974 - __main__ - INFO -   Completed: 12/47 periods
2025-07-18 14:38:55,974 - __main__ - INFO -   Successful: 0, Failed: 12
2025-07-18 14:38:55,974 - __main__ - INFO -   Elapsed time: 1.3 minutes
2025-07-18 14:38:55,974 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:38:55,974 - __main__ - INFO -   Estimated remaining time: 3.9 minutes
Processing periods:  26%|██▌       | 12/47 [01:20<03:47,  6.51s/period]2025-07-18 14:38:55,974 - __main__ - INFO - 
============================================================
2025-07-18 14:38:55,975 - __main__ - INFO - Processing period 13/47: 2021-07_to_2022-09
2025-07-18 14:38:55,975 - __main__ - INFO - Progress: 13/47 (27.7%)
2025-07-18 14:38:55,975 - __main__ - INFO - ============================================================
2025-07-18 14:38:55,975 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:38:55,976 - __main__ - INFO - Using default hyperparameters for period 12
2025-07-18 14:38:55,976 - __main__ - INFO - Processing period: 2021-07_to_2022-09
2025-07-18 14:38:55,976 - __main__ - INFO - Preparing training data...
2025-07-18 14:38:55,976 - __main__ - INFO - Preparing data for period: 2021-07-14 to 2022-07-14
2025-07-18 14:38:55,976 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:55,976 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:56,095 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:38:56,207 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-07-14 14:37:35.282119 to 2022-07-14 14:37:35.282119
2025-07-18 14:38:56,208 - __main__ - INFO - Loading data for ETH/USD from 2021-07-14 14:37:35.282119 to 2022-07-14 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(483), np.int64(1): np.int64(61), np.int64(2): np.int64(456)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:38:58,380 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:38:58,380 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:38:58,492 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:58,492 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:38:58,492 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(492), np.int64(1): np.int64(75), np.int64(2): np.int64(433)}
2025-07-18 14:38:58,492 - __main__ - INFO - Preparing test data...
2025-07-18 14:38:58,492 - __main__ - INFO - Preparing data for period: 2022-07-14 to 2022-09-12
2025-07-18 14:38:58,494 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:38:58,494 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:38:58,606 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:38:58,718 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-07-14 14:37:35.282119 to 2022-09-12 14:37:35.282119
2025-07-18 14:38:58,718 - __main__ - INFO - Loading data for ETH/USD from 2022-07-14 14:37:35.282119 to 2022-09-12 14:37:35.282119
2025-07-18 14:39:00,037 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:39:00,037 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:00,149 - __main__ - INFO - Memory usage: 865.9 MB
2025-07-18 14:39:00,149 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:00,149 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(445), np.int64(1): np.int64(61), np.int64(2): np.int64(494)}
2025-07-18 14:39:00,149 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:00,149 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:00,150 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(492), np.int64(1): np.int64(75), np.int64(2): np.int64(433)}
2025-07-18 14:39:00,150 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:00,150 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:00,150 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.1680
2025-07-18 14:39:00,150 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 8.8889
2025-07-18 14:39:00,150 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.4634
2025-07-18 14:39:00,150 - __main__ - INFO - Class distribution: {np.int64(0): 492, np.int64(2): 433, np.int64(1): 75}
2025-07-18 14:39:00,150 - __main__ - INFO - Original class weights: [0.6775067750677507, 4.444444444444445, 0.7698229407236336]
2025-07-18 14:39:00,151 - __main__ - INFO - Adjusted class weights: tensor([2.1680, 8.8889, 2.4634])
2025-07-18 14:39:00,151 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:00,151 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:00,151 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:00,151 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:00,151 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:00,151 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:00,152 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:00,152 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:00,152 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:00,152 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:00,154 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:00,155 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:00,155 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:00,155 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:00,156 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.1680, 8.8889, 2.4634])
2025-07-18 14:39:00,156 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:00,156 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:00,156 - __main__ - INFO - Starting training for period 2021-07_to_2022-09...
2025-07-18 14:39:00,156 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:00,156 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-07-14 14:37:35.282119 to 2022-07-14 14:37:35.282119
2025-07-18 14:39:00,156 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 865.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 865.9 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.1680, 8.8889, 2.4634])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-07-14 14:37:35.282119 to 2022-07-14 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:02,412 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:02,416 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:02,416 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:02,416 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:02,416 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:02,416 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:02,417 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(466), np.int64(1): np.int64(60), np.int64(2): np.int64(474)}
2025-07-18 14:39:02,417 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:02,417 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:02,417 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:02,417 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:02,417 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-07_to_2022-09: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:02,417 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:02,418 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:02,419 - __main__ - ERROR - ✗ Period 2021-07_to_2022-09 failed
2025-07-18 14:39:02,419 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:02,419 - __main__ - INFO -   Completed: 13/47 periods
2025-07-18 14:39:02,420 - __main__ - INFO -   Successful: 0, Failed: 13
2025-07-18 14:39:02,420 - __main__ - INFO -   Elapsed time: 1.4 minutes
2025-07-18 14:39:02,420 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:02,420 - __main__ - INFO -   Estimated remaining time: 3.8 minutes
Processing periods:  28%|██▊       | 13/47 [01:26<03:40,  6.49s/period]2025-07-18 14:39:02,420 - __main__ - INFO - 
============================================================
2025-07-18 14:39:02,420 - __main__ - INFO - Processing period 14/47: 2021-08_to_2022-10
2025-07-18 14:39:02,420 - __main__ - INFO - Progress: 14/47 (29.8%)
2025-07-18 14:39:02,420 - __main__ - INFO - ============================================================
2025-07-18 14:39:02,421 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:02,421 - __main__ - INFO - Using default hyperparameters for period 13
2025-07-18 14:39:02,421 - __main__ - INFO - Processing period: 2021-08_to_2022-10
2025-07-18 14:39:02,421 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:02,421 - __main__ - INFO - Preparing data for period: 2021-08-13 to 2022-08-13
2025-07-18 14:39:02,422 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:02,422 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:02,540 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:02,652 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-08-13 14:37:35.282119 to 2022-08-13 14:37:35.282119
2025-07-18 14:39:02,652 - __main__ - INFO - Loading data for ETH/USD from 2021-08-13 14:37:35.282119 to 2022-08-13 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(466), np.int64(1): np.int64(60), np.int64(2): np.int64(474)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:04,807 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:39:04,807 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:04,919 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:04,920 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:04,920 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(471), np.int64(1): np.int64(85), np.int64(2): np.int64(444)}
2025-07-18 14:39:04,920 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:04,920 - __main__ - INFO - Preparing data for period: 2022-08-13 to 2022-10-12
2025-07-18 14:39:04,921 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:04,921 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:05,034 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:05,146 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-08-13 14:37:35.282119 to 2022-10-12 14:37:35.282119
2025-07-18 14:39:05,146 - __main__ - INFO - Loading data for ETH/USD from 2022-08-13 14:37:35.282119 to 2022-10-12 14:37:35.282119
2025-07-18 14:39:06,475 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:39:06,475 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:06,588 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:06,588 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:06,588 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(453), np.int64(1): np.int64(115), np.int64(2): np.int64(432)}
2025-07-18 14:39:06,588 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:06,588 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:06,588 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(471), np.int64(1): np.int64(85), np.int64(2): np.int64(444)}
2025-07-18 14:39:06,589 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:06,589 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:06,589 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2647
2025-07-18 14:39:06,589 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 7.8431
2025-07-18 14:39:06,589 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.4024
2025-07-18 14:39:06,589 - __main__ - INFO - Class distribution: {np.int64(0): 471, np.int64(2): 444, np.int64(1): 85}
2025-07-18 14:39:06,589 - __main__ - INFO - Original class weights: [0.7077140835102619, 3.9215686274509802, 0.7507507507507507]
2025-07-18 14:39:06,590 - __main__ - INFO - Adjusted class weights: tensor([2.2647, 7.8431, 2.4024])
2025-07-18 14:39:06,590 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:06,590 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:06,592 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:06,593 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.2647, 7.8431, 2.4024])
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:06,594 - __main__ - INFO - Starting training for period 2021-08_to_2022-10...
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-08-13 14:37:35.282119 to 2022-08-13 14:37:35.282119
2025-07-18 14:39:06,594 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.2647, 7.8431, 2.4024])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-08-13 14:37:35.282119 to 2022-08-13 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:08,863 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:08,872 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:08,872 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:08,872 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:08,872 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:08,872 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:08,873 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(461), np.int64(1): np.int64(68), np.int64(2): np.int64(471)}
2025-07-18 14:39:08,873 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:08,873 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:08,873 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:08,873 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:08,873 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-08_to_2022-10: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:08,873 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:08,874 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:08,875 - __main__ - ERROR - ✗ Period 2021-08_to_2022-10 failed
2025-07-18 14:39:08,875 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:08,875 - __main__ - INFO -   Completed: 14/47 periods
2025-07-18 14:39:08,876 - __main__ - INFO -   Successful: 0, Failed: 14
2025-07-18 14:39:08,876 - __main__ - INFO -   Elapsed time: 1.6 minutes
2025-07-18 14:39:08,876 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:08,876 - __main__ - INFO -   Estimated remaining time: 3.7 minutes
Processing periods:  30%|██▉       | 14/47 [01:33<03:33,  6.48s/period]2025-07-18 14:39:08,876 - __main__ - INFO - 
============================================================
2025-07-18 14:39:08,876 - __main__ - INFO - Processing period 15/47: 2021-09_to_2022-11
2025-07-18 14:39:08,876 - __main__ - INFO - Progress: 15/47 (31.9%)
2025-07-18 14:39:08,876 - __main__ - INFO - ============================================================
2025-07-18 14:39:08,877 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:08,877 - __main__ - INFO - Using default hyperparameters for period 14
2025-07-18 14:39:08,877 - __main__ - INFO - Processing period: 2021-09_to_2022-11
2025-07-18 14:39:08,877 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:08,877 - __main__ - INFO - Preparing data for period: 2021-09-12 to 2022-09-12
2025-07-18 14:39:08,878 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:08,878 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:08,997 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:09,109 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-09-12 14:37:35.282119 to 2022-09-12 14:37:35.282119
2025-07-18 14:39:09,109 - __main__ - INFO - Loading data for ETH/USD from 2021-09-12 14:37:35.282119 to 2022-09-12 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 877.2 MB
Memory usage: 877.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 877.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(461), np.int64(1): np.int64(68), np.int64(2): np.int64(471)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:11,278 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:39:11,278 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:11,390 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:11,390 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:11,391 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(486), np.int64(1): np.int64(57), np.int64(2): np.int64(457)}
2025-07-18 14:39:11,391 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:11,391 - __main__ - INFO - Preparing data for period: 2022-09-12 to 2022-11-11
2025-07-18 14:39:11,392 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:11,392 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:11,505 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:11,618 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-09-12 14:37:35.282119 to 2022-11-11 14:37:35.282119
2025-07-18 14:39:11,618 - __main__ - INFO - Loading data for ETH/USD from 2022-09-12 14:37:35.282119 to 2022-11-11 14:37:35.282119
2025-07-18 14:39:12,942 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:39:12,942 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:13,055 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:13,055 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:13,055 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(420), np.int64(1): np.int64(178), np.int64(2): np.int64(402)}
2025-07-18 14:39:13,055 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:13,055 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:13,055 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(486), np.int64(1): np.int64(57), np.int64(2): np.int64(457)}
2025-07-18 14:39:13,055 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:13,055 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:13,056 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.1948
2025-07-18 14:39:13,056 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 11.6959
2025-07-18 14:39:13,056 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.3341
2025-07-18 14:39:13,056 - __main__ - INFO - Class distribution: {np.int64(0): 486, np.int64(2): 457, np.int64(1): 57}
2025-07-18 14:39:13,056 - __main__ - INFO - Original class weights: [0.6858710562414266, 5.847953216374269, 0.7293946024799417]
2025-07-18 14:39:13,056 - __main__ - INFO - Adjusted class weights: tensor([ 2.1948, 11.6959,  2.3341])
2025-07-18 14:39:13,056 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:13,057 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:13,059 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:13,060 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:13,060 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([ 2.1948, 11.6959,  2.3341])
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:13,061 - __main__ - INFO - Starting training for period 2021-09_to_2022-11...
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-09-12 14:37:35.282119 to 2022-09-12 14:37:35.282119
2025-07-18 14:39:13,061 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([ 2.1948, 11.6959,  2.3341])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-09-12 14:37:35.282119 to 2022-09-12 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:15,342 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:15,346 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:15,346 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:15,346 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:15,346 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:15,346 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:15,347 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(462), np.int64(1): np.int64(80), np.int64(2): np.int64(458)}
2025-07-18 14:39:15,347 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:15,347 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:15,347 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:15,347 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:15,347 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-09_to_2022-11: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:15,347 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:15,348 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:15,350 - __main__ - ERROR - ✗ Period 2021-09_to_2022-11 failed
2025-07-18 14:39:15,350 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:15,350 - __main__ - INFO -   Completed: 15/47 periods
2025-07-18 14:39:15,350 - __main__ - INFO -   Successful: 0, Failed: 15
2025-07-18 14:39:15,350 - __main__ - INFO -   Elapsed time: 1.7 minutes
2025-07-18 14:39:15,350 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:15,350 - __main__ - INFO -   Estimated remaining time: 3.5 minutes
Processing periods:  32%|███▏      | 15/47 [01:39<03:27,  6.48s/period]2025-07-18 14:39:15,350 - __main__ - INFO - 
============================================================
2025-07-18 14:39:15,350 - __main__ - INFO - Processing period 16/47: 2021-10_to_2022-12
2025-07-18 14:39:15,350 - __main__ - INFO - Progress: 16/47 (34.0%)
2025-07-18 14:39:15,350 - __main__ - INFO - ============================================================
2025-07-18 14:39:15,351 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:15,351 - __main__ - INFO - Using default hyperparameters for period 15
2025-07-18 14:39:15,351 - __main__ - INFO - Processing period: 2021-10_to_2022-12
2025-07-18 14:39:15,351 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:15,351 - __main__ - INFO - Preparing data for period: 2021-10-12 to 2022-10-12
2025-07-18 14:39:15,352 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:15,352 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:15,472 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:15,587 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-10-12 14:37:35.282119 to 2022-10-12 14:37:35.282119
2025-07-18 14:39:15,587 - __main__ - INFO - Loading data for ETH/USD from 2021-10-12 14:37:35.282119 to 2022-10-12 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(462), np.int64(1): np.int64(80), np.int64(2): np.int64(458)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:17,751 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:39:17,751 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:17,863 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:17,864 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:17,864 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(465), np.int64(1): np.int64(83), np.int64(2): np.int64(452)}
2025-07-18 14:39:17,864 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:17,864 - __main__ - INFO - Preparing data for period: 2022-10-12 to 2022-12-11
2025-07-18 14:39:17,865 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:17,865 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:17,978 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:18,090 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-10-12 14:37:35.282119 to 2022-12-11 14:37:35.282119
2025-07-18 14:39:18,090 - __main__ - INFO - Loading data for ETH/USD from 2022-10-12 14:37:35.282119 to 2022-12-11 14:37:35.282119
2025-07-18 14:39:19,411 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:39:19,411 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:19,523 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:19,523 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:19,524 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(387), np.int64(1): np.int64(241), np.int64(2): np.int64(372)}
2025-07-18 14:39:19,524 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:19,524 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:19,524 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(465), np.int64(1): np.int64(83), np.int64(2): np.int64(452)}
2025-07-18 14:39:19,524 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:19,524 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:19,524 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2939
2025-07-18 14:39:19,524 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 8.0321
2025-07-18 14:39:19,524 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.3599
2025-07-18 14:39:19,524 - __main__ - INFO - Class distribution: {np.int64(2): 452, np.int64(0): 465, np.int64(1): 83}
2025-07-18 14:39:19,524 - __main__ - INFO - Original class weights: [0.7168458781362007, 4.016064257028113, 0.7374631268436578]
2025-07-18 14:39:19,525 - __main__ - INFO - Adjusted class weights: tensor([2.2939, 8.0321, 2.3599])
2025-07-18 14:39:19,525 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:19,525 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:19,525 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:19,525 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:19,525 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:19,525 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:19,526 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:19,526 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:19,526 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:19,526 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:19,528 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:19,529 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:19,529 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:19,529 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:19,530 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.2939, 8.0321, 2.3599])
2025-07-18 14:39:19,530 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:19,530 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:19,530 - __main__ - INFO - Starting training for period 2021-10_to_2022-12...
2025-07-18 14:39:19,530 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:19,530 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-10-12 14:37:35.282119 to 2022-10-12 14:37:35.282119
2025-07-18 14:39:19,530 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.2939, 8.0321, 2.3599])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-10-12 14:37:35.282119 to 2022-10-12 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:21,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:21,799 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(438), np.int64(1): np.int64(99), np.int64(2): np.int64(463)}
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:21,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:21,801 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:21,801 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-10_to_2022-12: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:21,801 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:21,805 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:21,806 - __main__ - ERROR - ✗ Period 2021-10_to_2022-12 failed
2025-07-18 14:39:21,807 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:21,807 - __main__ - INFO -   Completed: 16/47 periods
2025-07-18 14:39:21,807 - __main__ - INFO -   Successful: 0, Failed: 16
2025-07-18 14:39:21,807 - __main__ - INFO -   Elapsed time: 1.8 minutes
2025-07-18 14:39:21,807 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:21,807 - __main__ - INFO -   Estimated remaining time: 3.4 minutes
Processing periods:  34%|███▍      | 16/47 [01:46<03:20,  6.47s/period]2025-07-18 14:39:21,807 - __main__ - INFO - 
============================================================
2025-07-18 14:39:21,807 - __main__ - INFO - Processing period 17/47: 2021-11_to_2023-01
2025-07-18 14:39:21,807 - __main__ - INFO - Progress: 17/47 (36.2%)
2025-07-18 14:39:21,807 - __main__ - INFO - ============================================================
2025-07-18 14:39:21,807 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:21,808 - __main__ - INFO - Using default hyperparameters for period 16
2025-07-18 14:39:21,808 - __main__ - INFO - Processing period: 2021-11_to_2023-01
2025-07-18 14:39:21,808 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:21,808 - __main__ - INFO - Preparing data for period: 2021-11-11 to 2022-11-11
2025-07-18 14:39:21,808 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:21,808 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:21,927 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:22,040 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-11-11 14:37:35.282119 to 2022-11-11 14:37:35.282119
2025-07-18 14:39:22,040 - __main__ - INFO - Loading data for ETH/USD from 2021-11-11 14:37:35.282119 to 2022-11-11 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(438), np.int64(1): np.int64(99), np.int64(2): np.int64(463)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:24,195 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:39:24,195 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:24,308 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:24,308 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:24,308 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(463), np.int64(1): np.int64(115), np.int64(2): np.int64(422)}
2025-07-18 14:39:24,308 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:24,308 - __main__ - INFO - Preparing data for period: 2022-11-11 to 2023-01-10
2025-07-18 14:39:24,309 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:24,309 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:24,422 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:24,534 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-11-11 14:37:35.282119 to 2023-01-10 14:37:35.282119
2025-07-18 14:39:24,534 - __main__ - INFO - Loading data for ETH/USD from 2022-11-11 14:37:35.282119 to 2023-01-10 14:37:35.282119
2025-07-18 14:39:25,856 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:39:25,856 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:25,969 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:25,969 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:25,969 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(264), np.int64(1): np.int64(464), np.int64(2): np.int64(272)}
2025-07-18 14:39:25,969 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:25,969 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:25,969 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(463), np.int64(1): np.int64(115), np.int64(2): np.int64(422)}
2025-07-18 14:39:25,969 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:25,970 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:25,970 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.3038
2025-07-18 14:39:25,970 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 5.7971
2025-07-18 14:39:25,970 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.5276
2025-07-18 14:39:25,970 - __main__ - INFO - Class distribution: {np.int64(2): 422, np.int64(1): 115, np.int64(0): 463}
2025-07-18 14:39:25,970 - __main__ - INFO - Original class weights: [0.7199424046076314, 2.898550724637681, 0.7898894154818326]
2025-07-18 14:39:25,970 - __main__ - INFO - Adjusted class weights: tensor([2.3038, 5.7971, 2.5276])
2025-07-18 14:39:25,971 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:25,971 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:25,973 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:25,974 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:25,974 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.3038, 5.7971, 2.5276])
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:25,975 - __main__ - INFO - Starting training for period 2021-11_to_2023-01...
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-11-11 14:37:35.282119 to 2022-11-11 14:37:35.282119
2025-07-18 14:39:25,975 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.3038, 5.7971, 2.5276])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-11-11 14:37:35.282119 to 2022-11-11 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:28,263 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:28,266 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:28,266 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(456), np.int64(1): np.int64(90), np.int64(2): np.int64(454)}
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:28,267 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:28,268 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-11_to_2023-01: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:28,268 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:28,268 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:28,270 - __main__ - ERROR - ✗ Period 2021-11_to_2023-01 failed
2025-07-18 14:39:28,270 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:28,270 - __main__ - INFO -   Completed: 17/47 periods
2025-07-18 14:39:28,270 - __main__ - INFO -   Successful: 0, Failed: 17
2025-07-18 14:39:28,270 - __main__ - INFO -   Elapsed time: 1.9 minutes
2025-07-18 14:39:28,270 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:28,270 - __main__ - INFO -   Estimated remaining time: 3.3 minutes
Processing periods:  36%|███▌      | 17/47 [01:52<03:14,  6.47s/period]2025-07-18 14:39:28,270 - __main__ - INFO - 
============================================================
2025-07-18 14:39:28,270 - __main__ - INFO - Processing period 18/47: 2021-12_to_2023-02
2025-07-18 14:39:28,270 - __main__ - INFO - Progress: 18/47 (38.3%)
2025-07-18 14:39:28,270 - __main__ - INFO - ============================================================
2025-07-18 14:39:28,271 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:28,271 - __main__ - INFO - Using default hyperparameters for period 17
2025-07-18 14:39:28,272 - __main__ - INFO - Processing period: 2021-12_to_2023-02
2025-07-18 14:39:28,272 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:28,272 - __main__ - INFO - Preparing data for period: 2021-12-11 to 2022-12-11
2025-07-18 14:39:28,272 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:28,272 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:28,392 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:28,504 - __main__ - INFO - Loading data for ['ETH/USD'] from 2021-12-11 14:37:35.282119 to 2022-12-11 14:37:35.282119
2025-07-18 14:39:28,505 - __main__ - INFO - Loading data for ETH/USD from 2021-12-11 14:37:35.282119 to 2022-12-11 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(456), np.int64(1): np.int64(90), np.int64(2): np.int64(454)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:30,664 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:39:30,664 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:30,778 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:30,778 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:30,778 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(464), np.int64(1): np.int64(117), np.int64(2): np.int64(419)}
2025-07-18 14:39:30,778 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:30,778 - __main__ - INFO - Preparing data for period: 2022-12-11 to 2023-02-09
2025-07-18 14:39:30,779 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:30,779 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:30,893 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:31,006 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-12-11 14:37:35.282119 to 2023-02-09 14:37:35.282119
2025-07-18 14:39:31,006 - __main__ - INFO - Loading data for ETH/USD from 2022-12-11 14:37:35.282119 to 2023-02-09 14:37:35.282119
2025-07-18 14:39:32,338 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:39:32,338 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:32,451 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:32,451 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:32,451 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(239), np.int64(1): np.int64(438), np.int64(2): np.int64(323)}
2025-07-18 14:39:32,451 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:32,451 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:32,451 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(464), np.int64(1): np.int64(117), np.int64(2): np.int64(419)}
2025-07-18 14:39:32,452 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:32,452 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:32,452 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.2989
2025-07-18 14:39:32,452 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 5.6980
2025-07-18 14:39:32,452 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.5457
2025-07-18 14:39:32,452 - __main__ - INFO - Class distribution: {np.int64(0): 464, np.int64(2): 419, np.int64(1): 117}
2025-07-18 14:39:32,452 - __main__ - INFO - Original class weights: [0.7183908045977011, 2.849002849002849, 0.7955449482895783]
2025-07-18 14:39:32,453 - __main__ - INFO - Adjusted class weights: tensor([2.2989, 5.6980, 2.5457])
2025-07-18 14:39:32,453 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:32,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:32,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:32,453 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:32,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:32,453 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:32,453 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:32,454 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:32,454 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:32,454 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:32,455 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:32,457 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:32,457 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:32,457 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:32,457 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.2989, 5.6980, 2.5457])
2025-07-18 14:39:32,457 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:32,458 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:32,458 - __main__ - INFO - Starting training for period 2021-12_to_2023-02...
2025-07-18 14:39:32,458 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:32,458 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2021-12-11 14:37:35.282119 to 2022-12-11 14:37:35.282119
2025-07-18 14:39:32,458 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.2989, 5.6980, 2.5457])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2021-12-11 14:37:35.282119 to 2022-12-11 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:34,730 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:34,733 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:34,733 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:34,733 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(447), np.int64(1): np.int64(120), np.int64(2): np.int64(433)}
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:34,734 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:34,734 - __main__ - ERROR - Error in train_and_evaluate_period for 2021-12_to_2023-02: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:34,734 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:34,735 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:34,737 - __main__ - ERROR - ✗ Period 2021-12_to_2023-02 failed
2025-07-18 14:39:34,737 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:34,737 - __main__ - INFO -   Completed: 18/47 periods
2025-07-18 14:39:34,737 - __main__ - INFO -   Successful: 0, Failed: 18
2025-07-18 14:39:34,737 - __main__ - INFO -   Elapsed time: 2.0 minutes
2025-07-18 14:39:34,737 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:34,737 - __main__ - INFO -   Estimated remaining time: 3.2 minutes
Processing periods:  38%|███▊      | 18/47 [01:59<03:07,  6.47s/period]2025-07-18 14:39:34,737 - __main__ - INFO - 
============================================================
2025-07-18 14:39:34,737 - __main__ - INFO - Processing period 19/47: 2022-01_to_2023-03
2025-07-18 14:39:34,737 - __main__ - INFO - Progress: 19/47 (40.4%)
2025-07-18 14:39:34,737 - __main__ - INFO - ============================================================
2025-07-18 14:39:34,738 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:34,738 - __main__ - INFO - Using default hyperparameters for period 18
2025-07-18 14:39:34,738 - __main__ - INFO - Processing period: 2022-01_to_2023-03
2025-07-18 14:39:34,738 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:34,738 - __main__ - INFO - Preparing data for period: 2022-01-10 to 2023-01-10
2025-07-18 14:39:34,738 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:34,739 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:34,857 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:34,970 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-01-10 14:37:35.282119 to 2023-01-10 14:37:35.282119
2025-07-18 14:39:34,971 - __main__ - INFO - Loading data for ETH/USD from 2022-01-10 14:37:35.282119 to 2023-01-10 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(447), np.int64(1): np.int64(120), np.int64(2): np.int64(433)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:37,157 - __main__ - INFO - Enhanced data preparation completed in 2.30 seconds
2025-07-18 14:39:37,157 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:37,272 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:37,272 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:37,273 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(408), np.int64(1): np.int64(170), np.int64(2): np.int64(422)}
2025-07-18 14:39:37,273 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:37,273 - __main__ - INFO - Preparing data for period: 2023-01-10 to 2023-03-11
2025-07-18 14:39:37,274 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:37,274 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:37,389 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:37,503 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-01-10 14:37:35.282119 to 2023-03-11 14:37:35.282119
2025-07-18 14:39:37,503 - __main__ - INFO - Loading data for ETH/USD from 2023-01-10 14:37:35.282119 to 2023-03-11 14:37:35.282119
2025-07-18 14:39:38,842 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:39:38,843 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:38,954 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:38,954 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:38,955 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(343), np.int64(1): np.int64(313), np.int64(2): np.int64(344)}
2025-07-18 14:39:38,955 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:38,955 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:38,955 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(408), np.int64(1): np.int64(170), np.int64(2): np.int64(422)}
2025-07-18 14:39:38,955 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:38,955 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:38,955 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.6144
2025-07-18 14:39:38,955 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.9216
2025-07-18 14:39:38,955 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.5276
2025-07-18 14:39:38,955 - __main__ - INFO - Class distribution: {np.int64(2): 422, np.int64(1): 170, np.int64(0): 408}
2025-07-18 14:39:38,956 - __main__ - INFO - Original class weights: [0.8169934640522876, 1.9607843137254901, 0.7898894154818326]
2025-07-18 14:39:38,956 - __main__ - INFO - Adjusted class weights: tensor([2.6144, 3.9216, 2.5276])
2025-07-18 14:39:38,956 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:38,956 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:38,956 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:38,956 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:38,956 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:38,957 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:38,957 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:38,957 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:38,957 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:38,957 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:38,959 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:38,960 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:38,960 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:38,960 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:38,961 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.6144, 3.9216, 2.5276])
2025-07-18 14:39:38,961 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:38,961 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:38,961 - __main__ - INFO - Starting training for period 2022-01_to_2023-03...
2025-07-18 14:39:38,961 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:38,961 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-01-10 14:37:35.282119 to 2023-01-10 14:37:35.282119
2025-07-18 14:39:38,961 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.6144, 3.9216, 2.5276])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-01-10 14:37:35.282119 to 2023-01-10 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:41,230 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:41,234 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:41,234 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:41,234 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:41,234 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:41,234 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:41,235 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(428), np.int64(1): np.int64(155), np.int64(2): np.int64(417)}
2025-07-18 14:39:41,235 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:41,235 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:41,235 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:41,235 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:41,235 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-01_to_2023-03: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:41,235 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:41,236 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:41,238 - __main__ - ERROR - ✗ Period 2022-01_to_2023-03 failed
2025-07-18 14:39:41,238 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:41,238 - __main__ - INFO -   Completed: 19/47 periods
2025-07-18 14:39:41,238 - __main__ - INFO -   Successful: 0, Failed: 19
2025-07-18 14:39:41,238 - __main__ - INFO -   Elapsed time: 2.1 minutes
2025-07-18 14:39:41,238 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:41,238 - __main__ - INFO -   Estimated remaining time: 3.1 minutes
Processing periods:  40%|████      | 19/47 [02:05<03:01,  6.48s/period]2025-07-18 14:39:41,238 - __main__ - INFO - 
============================================================
2025-07-18 14:39:41,238 - __main__ - INFO - Processing period 20/47: 2022-02_to_2023-04
2025-07-18 14:39:41,238 - __main__ - INFO - Progress: 20/47 (42.6%)
2025-07-18 14:39:41,238 - __main__ - INFO - ============================================================
2025-07-18 14:39:41,239 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:41,239 - __main__ - INFO - Using default hyperparameters for period 19
2025-07-18 14:39:41,239 - __main__ - INFO - Processing period: 2022-02_to_2023-04
2025-07-18 14:39:41,239 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:41,239 - __main__ - INFO - Preparing data for period: 2022-02-09 to 2023-02-09
2025-07-18 14:39:41,239 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:41,239 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:41,357 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:41,469 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-02-09 14:37:35.282119 to 2023-02-09 14:37:35.282119
2025-07-18 14:39:41,469 - __main__ - INFO - Loading data for ETH/USD from 2022-02-09 14:37:35.282119 to 2023-02-09 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(428), np.int64(1): np.int64(155), np.int64(2): np.int64(417)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:43,640 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:39:43,641 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:43,754 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:43,754 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:43,754 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(404), np.int64(1): np.int64(197), np.int64(2): np.int64(399)}
2025-07-18 14:39:43,754 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:43,754 - __main__ - INFO - Preparing data for period: 2023-02-09 to 2023-04-10
2025-07-18 14:39:43,755 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:43,755 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:43,868 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:43,981 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-02-09 14:37:35.282119 to 2023-04-10 14:37:35.282119
2025-07-18 14:39:43,981 - __main__ - INFO - Loading data for ETH/USD from 2023-02-09 14:37:35.282119 to 2023-04-10 14:37:35.282119
2025-07-18 14:39:45,310 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:39:45,310 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:45,424 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:45,424 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:45,424 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(301), np.int64(1): np.int64(336), np.int64(2): np.int64(363)}
2025-07-18 14:39:45,424 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:45,424 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:45,424 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(404), np.int64(1): np.int64(197), np.int64(2): np.int64(399)}
2025-07-18 14:39:45,425 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:45,425 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:45,425 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.6403
2025-07-18 14:39:45,425 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.3841
2025-07-18 14:39:45,425 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.6734
2025-07-18 14:39:45,425 - __main__ - INFO - Class distribution: {np.int64(0): 404, np.int64(2): 399, np.int64(1): 197}
2025-07-18 14:39:45,425 - __main__ - INFO - Original class weights: [0.8250825082508251, 1.6920473773265652, 0.835421888053467]
2025-07-18 14:39:45,425 - __main__ - INFO - Adjusted class weights: tensor([2.6403, 3.3841, 2.6734])
2025-07-18 14:39:45,426 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:45,426 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:45,428 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:45,429 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:45,429 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.6403, 3.3841, 2.6734])
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:45,430 - __main__ - INFO - Starting training for period 2022-02_to_2023-04...
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-02-09 14:37:35.282119 to 2023-02-09 14:37:35.282119
2025-07-18 14:39:45,430 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.6403, 3.3841, 2.6734])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-02-09 14:37:35.282119 to 2023-02-09 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:47,721 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:47,724 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:47,724 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(460), np.int64(1): np.int64(174), np.int64(2): np.int64(366)}
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:47,725 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:47,726 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-02_to_2023-04: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:47,726 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:47,730 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:47,731 - __main__ - ERROR - ✗ Period 2022-02_to_2023-04 failed
2025-07-18 14:39:47,732 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:47,732 - __main__ - INFO -   Completed: 20/47 periods
2025-07-18 14:39:47,732 - __main__ - INFO -   Successful: 0, Failed: 20
2025-07-18 14:39:47,732 - __main__ - INFO -   Elapsed time: 2.2 minutes
2025-07-18 14:39:47,732 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:47,732 - __main__ - INFO -   Estimated remaining time: 3.0 minutes
Processing periods:  43%|████▎     | 20/47 [02:12<02:55,  6.48s/period]2025-07-18 14:39:47,732 - __main__ - INFO - 
============================================================
2025-07-18 14:39:47,732 - __main__ - INFO - Processing period 21/47: 2022-03_to_2023-05
2025-07-18 14:39:47,732 - __main__ - INFO - Progress: 21/47 (44.7%)
2025-07-18 14:39:47,732 - __main__ - INFO - ============================================================
2025-07-18 14:39:47,732 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:47,732 - __main__ - INFO - Using default hyperparameters for period 20
2025-07-18 14:39:47,732 - __main__ - INFO - Processing period: 2022-03_to_2023-05
2025-07-18 14:39:47,732 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:47,732 - __main__ - INFO - Preparing data for period: 2022-03-11 to 2023-03-11
2025-07-18 14:39:47,733 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:47,733 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:47,853 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:47,967 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-03-11 14:37:35.282119 to 2023-03-11 14:37:35.282119
2025-07-18 14:39:47,967 - __main__ - INFO - Loading data for ETH/USD from 2022-03-11 14:37:35.282119 to 2023-03-11 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(460), np.int64(1): np.int64(174), np.int64(2): np.int64(366)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:50,361 - __main__ - INFO - Enhanced data preparation completed in 2.51 seconds
2025-07-18 14:39:50,361 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:50,546 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:50,547 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:50,547 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(411), np.int64(1): np.int64(193), np.int64(2): np.int64(396)}
2025-07-18 14:39:50,547 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:50,547 - __main__ - INFO - Preparing data for period: 2023-03-11 to 2023-05-10
2025-07-18 14:39:50,548 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:50,548 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:50,734 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:50,919 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-03-11 14:37:35.282119 to 2023-05-10 14:37:35.282119
2025-07-18 14:39:50,920 - __main__ - INFO - Loading data for ETH/USD from 2023-03-11 14:37:35.282119 to 2023-05-10 14:37:35.282119
2025-07-18 14:39:52,506 - __main__ - INFO - Enhanced data preparation completed in 1.77 seconds
2025-07-18 14:39:52,506 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:52,691 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:52,691 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:52,691 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(341), np.int64(1): np.int64(315), np.int64(2): np.int64(344)}
2025-07-18 14:39:52,692 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:52,692 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:52,692 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(411), np.int64(1): np.int64(193), np.int64(2): np.int64(396)}
2025-07-18 14:39:52,692 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:52,692 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:52,692 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.5953
2025-07-18 14:39:52,692 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.4542
2025-07-18 14:39:52,692 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.6936
2025-07-18 14:39:52,692 - __main__ - INFO - Class distribution: {np.int64(1): 193, np.int64(2): 396, np.int64(0): 411}
2025-07-18 14:39:52,692 - __main__ - INFO - Original class weights: [0.8110300081103001, 1.7271157167530224, 0.8417508417508418]
2025-07-18 14:39:52,694 - __main__ - INFO - Adjusted class weights: tensor([2.5953, 3.4542, 2.6936])
2025-07-18 14:39:52,694 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:52,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:52,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:52,694 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:52,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:52,694 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:52,695 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:52,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:52,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:52,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:52,697 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:52,698 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:52,698 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:52,699 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:52,699 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.5953, 3.4542, 2.6936])
2025-07-18 14:39:52,699 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:52,699 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:52,699 - __main__ - INFO - Starting training for period 2022-03_to_2023-05...
2025-07-18 14:39:52,699 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:52,699 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-03-11 14:37:35.282119 to 2023-03-11 14:37:35.282119
2025-07-18 14:39:52,700 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.5953, 3.4542, 2.6936])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-03-11 14:37:35.282119 to 2023-03-11 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:55,033 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:55,036 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:39:55,036 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:39:55,036 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:39:55,036 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:39:55,036 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:39:55,037 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(402), np.int64(1): np.int64(213), np.int64(2): np.int64(385)}
2025-07-18 14:39:55,037 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:39:55,037 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:39:55,037 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:39:55,037 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:39:55,037 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-03_to_2023-05: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:55,037 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:39:55,038 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:39:55,039 - __main__ - ERROR - ✗ Period 2022-03_to_2023-05 failed
2025-07-18 14:39:55,040 - __main__ - INFO - Progress Summary:
2025-07-18 14:39:55,040 - __main__ - INFO -   Completed: 21/47 periods
2025-07-18 14:39:55,040 - __main__ - INFO -   Successful: 0, Failed: 21
2025-07-18 14:39:55,040 - __main__ - INFO -   Elapsed time: 2.3 minutes
2025-07-18 14:39:55,040 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:39:55,040 - __main__ - INFO -   Estimated remaining time: 2.9 minutes
Processing periods:  45%|████▍     | 21/47 [02:19<02:54,  6.73s/period]2025-07-18 14:39:55,040 - __main__ - INFO - 
============================================================
2025-07-18 14:39:55,040 - __main__ - INFO - Processing period 22/47: 2022-04_to_2023-06
2025-07-18 14:39:55,040 - __main__ - INFO - Progress: 22/47 (46.8%)
2025-07-18 14:39:55,040 - __main__ - INFO - ============================================================
2025-07-18 14:39:55,041 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:39:55,041 - __main__ - INFO - Using default hyperparameters for period 21
2025-07-18 14:39:55,041 - __main__ - INFO - Processing period: 2022-04_to_2023-06
2025-07-18 14:39:55,041 - __main__ - INFO - Preparing training data...
2025-07-18 14:39:55,041 - __main__ - INFO - Preparing data for period: 2022-04-10 to 2023-04-10
2025-07-18 14:39:55,042 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:55,042 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:55,163 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:39:55,278 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-04-10 14:37:35.282119 to 2023-04-10 14:37:35.282119
2025-07-18 14:39:55,278 - __main__ - INFO - Loading data for ETH/USD from 2022-04-10 14:37:35.282119 to 2023-04-10 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(402), np.int64(1): np.int64(213), np.int64(2): np.int64(385)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:39:57,500 - __main__ - INFO - Enhanced data preparation completed in 2.34 seconds
2025-07-18 14:39:57,500 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:57,616 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:57,616 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:57,616 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(391), np.int64(1): np.int64(214), np.int64(2): np.int64(395)}
2025-07-18 14:39:57,616 - __main__ - INFO - Preparing test data...
2025-07-18 14:39:57,616 - __main__ - INFO - Preparing data for period: 2023-04-10 to 2023-06-09
2025-07-18 14:39:57,617 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:39:57,617 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:39:57,732 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:39:57,847 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-04-10 14:37:35.282119 to 2023-06-09 14:37:35.282119
2025-07-18 14:39:57,847 - __main__ - INFO - Loading data for ETH/USD from 2023-04-10 14:37:35.282119 to 2023-06-09 14:37:35.282119
2025-07-18 14:39:59,232 - __main__ - INFO - Enhanced data preparation completed in 1.50 seconds
2025-07-18 14:39:59,232 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:39:59,347 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:39:59,347 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:39:59,347 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(283), np.int64(1): np.int64(450), np.int64(2): np.int64(267)}
2025-07-18 14:39:59,347 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:39:59,347 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:39:59,347 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(391), np.int64(1): np.int64(214), np.int64(2): np.int64(395)}
2025-07-18 14:39:59,348 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:39:59,348 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:39:59,348 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.7280
2025-07-18 14:39:59,348 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.1153
2025-07-18 14:39:59,348 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.7004
2025-07-18 14:39:59,348 - __main__ - INFO - Class distribution: {np.int64(2): 395, np.int64(1): 214, np.int64(0): 391}
2025-07-18 14:39:59,348 - __main__ - INFO - Original class weights: [0.8525149190110827, 1.557632398753894, 0.8438818565400844]
2025-07-18 14:39:59,349 - __main__ - INFO - Adjusted class weights: tensor([2.7280, 3.1153, 2.7004])
2025-07-18 14:39:59,349 - __main__ - INFO - Creating trainer...
2025-07-18 14:39:59,349 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:39:59,349 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:39:59,349 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:39:59,349 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:39:59,349 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:39:59,350 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:39:59,350 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:39:59,350 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:39:59,350 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:39:59,351 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:39:59,353 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:39:59,353 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:39:59,353 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:39:59,353 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.7280, 3.1153, 2.7004])
2025-07-18 14:39:59,353 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:39:59,354 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:39:59,354 - __main__ - INFO - Starting training for period 2022-04_to_2023-06...
2025-07-18 14:39:59,354 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:39:59,354 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-04-10 14:37:35.282119 to 2023-04-10 14:37:35.282119
2025-07-18 14:39:59,354 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.7280, 3.1153, 2.7004])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-04-10 14:37:35.282119 to 2023-04-10 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:01,661 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:01,665 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:01,665 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:01,665 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:01,665 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:01,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:01,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(413), np.int64(1): np.int64(216), np.int64(2): np.int64(371)}
2025-07-18 14:40:01,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:01,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:01,666 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:01,666 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:01,666 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-04_to_2023-06: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:01,666 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:01,667 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:01,669 - __main__ - ERROR - ✗ Period 2022-04_to_2023-06 failed
2025-07-18 14:40:01,669 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:01,669 - __main__ - INFO -   Completed: 22/47 periods
2025-07-18 14:40:01,669 - __main__ - INFO -   Successful: 0, Failed: 22
2025-07-18 14:40:01,669 - __main__ - INFO -   Elapsed time: 2.4 minutes
2025-07-18 14:40:01,669 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:01,669 - __main__ - INFO -   Estimated remaining time: 2.8 minutes
Processing periods:  47%|████▋     | 22/47 [02:26<02:47,  6.70s/period]2025-07-18 14:40:01,669 - __main__ - INFO - 
============================================================
2025-07-18 14:40:01,669 - __main__ - INFO - Processing period 23/47: 2022-05_to_2023-07
2025-07-18 14:40:01,669 - __main__ - INFO - Progress: 23/47 (48.9%)
2025-07-18 14:40:01,669 - __main__ - INFO - ============================================================
2025-07-18 14:40:01,670 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:01,670 - __main__ - INFO - Using default hyperparameters for period 22
2025-07-18 14:40:01,670 - __main__ - INFO - Processing period: 2022-05_to_2023-07
2025-07-18 14:40:01,670 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:01,670 - __main__ - INFO - Preparing data for period: 2022-05-10 to 2023-05-10
2025-07-18 14:40:01,671 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:01,671 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:01,813 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:01,927 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-05-10 14:37:35.282119 to 2023-05-10 14:37:35.282119
2025-07-18 14:40:01,928 - __main__ - INFO - Loading data for ETH/USD from 2022-05-10 14:37:35.282119 to 2023-05-10 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(413), np.int64(1): np.int64(216), np.int64(2): np.int64(371)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:04,112 - __main__ - INFO - Enhanced data preparation completed in 2.30 seconds
2025-07-18 14:40:04,112 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:04,223 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:04,224 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:04,224 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(378), np.int64(1): np.int64(239), np.int64(2): np.int64(383)}
2025-07-18 14:40:04,224 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:04,224 - __main__ - INFO - Preparing data for period: 2023-05-10 to 2023-07-09
2025-07-18 14:40:04,225 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:04,225 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:04,337 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:04,449 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-05-10 14:37:35.282119 to 2023-07-09 14:37:35.282119
2025-07-18 14:40:04,449 - __main__ - INFO - Loading data for ETH/USD from 2023-05-10 14:37:35.282119 to 2023-07-09 14:37:35.282119
2025-07-18 14:40:05,795 - __main__ - INFO - Enhanced data preparation completed in 1.46 seconds
2025-07-18 14:40:05,795 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:05,909 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:05,909 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:05,909 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(230), np.int64(1): np.int64(525), np.int64(2): np.int64(245)}
2025-07-18 14:40:05,909 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:05,910 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:05,910 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(378), np.int64(1): np.int64(239), np.int64(2): np.int64(383)}
2025-07-18 14:40:05,910 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:05,910 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:05,910 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.8219
2025-07-18 14:40:05,910 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.7894
2025-07-18 14:40:05,910 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.7850
2025-07-18 14:40:05,910 - __main__ - INFO - Class distribution: {np.int64(2): 383, np.int64(0): 378, np.int64(1): 239}
2025-07-18 14:40:05,910 - __main__ - INFO - Original class weights: [0.8818342151675485, 1.394700139470014, 0.8703220191470844]
2025-07-18 14:40:05,911 - __main__ - INFO - Adjusted class weights: tensor([2.8219, 2.7894, 2.7850])
2025-07-18 14:40:05,911 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:05,911 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:05,911 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:05,911 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:05,911 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:05,912 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:05,912 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:05,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:05,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:05,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:05,914 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:05,915 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:05,915 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:05,915 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:05,916 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.8219, 2.7894, 2.7850])
2025-07-18 14:40:05,916 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:05,916 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:05,916 - __main__ - INFO - Starting training for period 2022-05_to_2023-07...
2025-07-18 14:40:05,916 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:05,916 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-05-10 14:37:35.282119 to 2023-05-10 14:37:35.282119
2025-07-18 14:40:05,916 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.8219, 2.7894, 2.7850])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-05-10 14:37:35.282119 to 2023-05-10 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:08,199 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:08,203 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:08,203 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:08,203 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:08,203 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:08,203 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:08,204 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(399), np.int64(1): np.int64(222), np.int64(2): np.int64(379)}
2025-07-18 14:40:08,204 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:08,204 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:08,204 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:08,204 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:08,204 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-05_to_2023-07: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:08,204 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:08,205 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:08,206 - __main__ - ERROR - ✗ Period 2022-05_to_2023-07 failed
2025-07-18 14:40:08,207 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:08,207 - __main__ - INFO -   Completed: 23/47 periods
2025-07-18 14:40:08,207 - __main__ - INFO -   Successful: 0, Failed: 23
2025-07-18 14:40:08,207 - __main__ - INFO -   Elapsed time: 2.5 minutes
2025-07-18 14:40:08,207 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:08,207 - __main__ - INFO -   Estimated remaining time: 2.7 minutes
Processing periods:  49%|████▉     | 23/47 [02:32<02:39,  6.65s/period]2025-07-18 14:40:08,207 - __main__ - INFO - 
============================================================
2025-07-18 14:40:08,207 - __main__ - INFO - Processing period 24/47: 2022-06_to_2023-08
2025-07-18 14:40:08,207 - __main__ - INFO - Progress: 24/47 (51.1%)
2025-07-18 14:40:08,207 - __main__ - INFO - ============================================================
2025-07-18 14:40:08,208 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:08,208 - __main__ - INFO - Using default hyperparameters for period 23
2025-07-18 14:40:08,208 - __main__ - INFO - Processing period: 2022-06_to_2023-08
2025-07-18 14:40:08,208 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:08,208 - __main__ - INFO - Preparing data for period: 2022-06-09 to 2023-06-09
2025-07-18 14:40:08,209 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:08,209 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:08,327 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:08,439 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-06-09 14:37:35.282119 to 2023-06-09 14:37:35.282119
2025-07-18 14:40:08,439 - __main__ - INFO - Loading data for ETH/USD from 2022-06-09 14:37:35.282119 to 2023-06-09 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(399), np.int64(1): np.int64(222), np.int64(2): np.int64(379)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:10,588 - __main__ - INFO - Enhanced data preparation completed in 2.26 seconds
2025-07-18 14:40:10,588 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:10,700 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:10,700 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:10,700 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(391), np.int64(1): np.int64(254), np.int64(2): np.int64(355)}
2025-07-18 14:40:10,700 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:10,701 - __main__ - INFO - Preparing data for period: 2023-06-09 to 2023-08-08
2025-07-18 14:40:10,702 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:10,702 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:10,814 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:10,926 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-06-09 14:37:35.282119 to 2023-08-08 14:37:35.282119
2025-07-18 14:40:10,926 - __main__ - INFO - Loading data for ETH/USD from 2023-06-09 14:37:35.282119 to 2023-08-08 14:37:35.282119
2025-07-18 14:40:12,252 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:40:12,252 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:12,370 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:12,370 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:12,371 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(219), np.int64(1): np.int64(584), np.int64(2): np.int64(197)}
2025-07-18 14:40:12,371 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:12,371 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:12,371 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(391), np.int64(1): np.int64(254), np.int64(2): np.int64(355)}
2025-07-18 14:40:12,371 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:12,371 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:12,372 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.7280
2025-07-18 14:40:12,372 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.6247
2025-07-18 14:40:12,372 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.0047
2025-07-18 14:40:12,372 - __main__ - INFO - Class distribution: {np.int64(2): 355, np.int64(0): 391, np.int64(1): 254}
2025-07-18 14:40:12,372 - __main__ - INFO - Original class weights: [0.8525149190110827, 1.3123359580052494, 0.9389671361502347]
2025-07-18 14:40:12,372 - __main__ - INFO - Adjusted class weights: tensor([2.7280, 2.6247, 3.0047])
2025-07-18 14:40:12,372 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:12,372 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:12,372 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:12,373 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:12,375 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:12,376 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:12,376 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.7280, 2.6247, 3.0047])
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:12,377 - __main__ - INFO - Starting training for period 2022-06_to_2023-08...
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-06-09 14:37:35.282119 to 2023-06-09 14:37:35.282119
2025-07-18 14:40:12,377 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.7280, 2.6247, 3.0047])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-06-09 14:37:35.282119 to 2023-06-09 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:14,664 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:14,667 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:14,667 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:14,667 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:14,667 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:14,668 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:14,668 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(402), np.int64(1): np.int64(236), np.int64(2): np.int64(362)}
2025-07-18 14:40:14,668 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:14,668 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:14,668 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:14,668 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:14,668 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-06_to_2023-08: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:14,668 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:14,672 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:14,674 - __main__ - ERROR - ✗ Period 2022-06_to_2023-08 failed
2025-07-18 14:40:14,674 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:14,674 - __main__ - INFO -   Completed: 24/47 periods
2025-07-18 14:40:14,674 - __main__ - INFO -   Successful: 0, Failed: 24
2025-07-18 14:40:14,674 - __main__ - INFO -   Elapsed time: 2.7 minutes
2025-07-18 14:40:14,674 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:14,674 - __main__ - INFO -   Estimated remaining time: 2.5 minutes
Processing periods:  51%|█████     | 24/47 [02:39<02:31,  6.60s/period]2025-07-18 14:40:14,675 - __main__ - INFO - 
============================================================
2025-07-18 14:40:14,675 - __main__ - INFO - Processing period 25/47: 2022-07_to_2023-09
2025-07-18 14:40:14,675 - __main__ - INFO - Progress: 25/47 (53.2%)
2025-07-18 14:40:14,675 - __main__ - INFO - ============================================================
2025-07-18 14:40:14,675 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:14,675 - __main__ - INFO - Using default hyperparameters for period 24
2025-07-18 14:40:14,675 - __main__ - INFO - Processing period: 2022-07_to_2023-09
2025-07-18 14:40:14,675 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:14,676 - __main__ - INFO - Preparing data for period: 2022-07-09 to 2023-07-09
2025-07-18 14:40:14,676 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:14,677 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:14,797 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:14,910 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-07-09 14:37:35.282119 to 2023-07-09 14:37:35.282119
2025-07-18 14:40:14,910 - __main__ - INFO - Loading data for ETH/USD from 2022-07-09 14:37:35.282119 to 2023-07-09 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(402), np.int64(1): np.int64(236), np.int64(2): np.int64(362)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:17,116 - __main__ - INFO - Enhanced data preparation completed in 2.32 seconds
2025-07-18 14:40:17,116 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:17,231 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:17,231 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:17,231 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(335), np.int64(1): np.int64(309), np.int64(2): np.int64(356)}
2025-07-18 14:40:17,231 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:17,231 - __main__ - INFO - Preparing data for period: 2023-07-09 to 2023-09-07
2025-07-18 14:40:17,232 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:17,232 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:17,348 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:17,463 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-07-09 14:37:35.282119 to 2023-09-07 14:37:35.282119
2025-07-18 14:40:17,463 - __main__ - INFO - Loading data for ETH/USD from 2023-07-09 14:37:35.282119 to 2023-09-07 14:37:35.282119
2025-07-18 14:40:18,803 - __main__ - INFO - Enhanced data preparation completed in 1.46 seconds
2025-07-18 14:40:18,804 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:18,918 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:18,919 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:18,919 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(178), np.int64(1): np.int64(678), np.int64(2): np.int64(144)}
2025-07-18 14:40:18,919 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:18,919 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:18,919 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(335), np.int64(1): np.int64(309), np.int64(2): np.int64(356)}
2025-07-18 14:40:18,919 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:18,919 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:18,920 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.1841
2025-07-18 14:40:18,920 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.1575
2025-07-18 14:40:18,920 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.9963
2025-07-18 14:40:18,920 - __main__ - INFO - Class distribution: {np.int64(0): 335, np.int64(2): 356, np.int64(1): 309}
2025-07-18 14:40:18,920 - __main__ - INFO - Original class weights: [0.9950248756218906, 1.0787486515641855, 0.9363295880149812]
2025-07-18 14:40:18,920 - __main__ - INFO - Adjusted class weights: tensor([3.1841, 2.1575, 2.9963])
2025-07-18 14:40:18,920 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:18,920 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:18,920 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:18,920 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:18,920 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:18,921 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:18,921 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:18,921 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:18,921 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:18,921 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:18,923 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:18,924 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:18,924 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:18,924 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:18,925 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.1841, 2.1575, 2.9963])
2025-07-18 14:40:18,925 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:18,925 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:18,925 - __main__ - INFO - Starting training for period 2022-07_to_2023-09...
2025-07-18 14:40:18,925 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:18,925 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-07-09 14:37:35.282119 to 2023-07-09 14:37:35.282119
2025-07-18 14:40:18,925 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.1841, 2.1575, 2.9963])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-07-09 14:37:35.282119 to 2023-07-09 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:21,216 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:21,219 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(327), np.int64(1): np.int64(306), np.int64(2): np.int64(367)}
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:21,220 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:21,221 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:21,221 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:21,221 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-07_to_2023-09: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:21,221 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:21,221 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:21,223 - __main__ - ERROR - ✗ Period 2022-07_to_2023-09 failed
2025-07-18 14:40:21,223 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:21,223 - __main__ - INFO -   Completed: 25/47 periods
2025-07-18 14:40:21,223 - __main__ - INFO -   Successful: 0, Failed: 25
2025-07-18 14:40:21,223 - __main__ - INFO -   Elapsed time: 2.8 minutes
2025-07-18 14:40:21,223 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:21,223 - __main__ - INFO -   Estimated remaining time: 2.4 minutes
Processing periods:  53%|█████▎    | 25/47 [02:45<02:24,  6.58s/period]2025-07-18 14:40:21,223 - __main__ - INFO - 
============================================================
2025-07-18 14:40:21,224 - __main__ - INFO - Processing period 26/47: 2022-08_to_2023-10
2025-07-18 14:40:21,224 - __main__ - INFO - Progress: 26/47 (55.3%)
2025-07-18 14:40:21,224 - __main__ - INFO - ============================================================
2025-07-18 14:40:21,225 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:21,225 - __main__ - INFO - Using default hyperparameters for period 25
2025-07-18 14:40:21,225 - __main__ - INFO - Processing period: 2022-08_to_2023-10
2025-07-18 14:40:21,225 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:21,225 - __main__ - INFO - Preparing data for period: 2022-08-08 to 2023-08-08
2025-07-18 14:40:21,225 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:21,226 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:21,344 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:21,457 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-08-08 14:37:35.282119 to 2023-08-08 14:37:35.282119
2025-07-18 14:40:21,457 - __main__ - INFO - Loading data for ETH/USD from 2022-08-08 14:37:35.282119 to 2023-08-08 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(327), np.int64(1): np.int64(306), np.int64(2): np.int64(367)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:23,619 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:40:23,619 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:23,732 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:23,732 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:23,732 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(320), np.int64(1): np.int64(379), np.int64(2): np.int64(301)}
2025-07-18 14:40:23,732 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:23,732 - __main__ - INFO - Preparing data for period: 2023-08-08 to 2023-10-07
2025-07-18 14:40:23,733 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:23,733 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:23,846 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:23,958 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-08-08 14:37:35.282119 to 2023-10-07 14:37:35.282119
2025-07-18 14:40:23,959 - __main__ - INFO - Loading data for ETH/USD from 2023-08-08 14:37:35.282119 to 2023-10-07 14:37:35.282119
2025-07-18 14:40:25,278 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:40:25,278 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:25,391 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:25,391 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:25,392 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(193), np.int64(1): np.int64(653), np.int64(2): np.int64(154)}
2025-07-18 14:40:25,392 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:25,392 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:25,392 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(320), np.int64(1): np.int64(379), np.int64(2): np.int64(301)}
2025-07-18 14:40:25,392 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:25,392 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:25,392 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.3333
2025-07-18 14:40:25,393 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.7590
2025-07-18 14:40:25,393 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.5437
2025-07-18 14:40:25,393 - __main__ - INFO - Class distribution: {np.int64(2): 301, np.int64(0): 320, np.int64(1): 379}
2025-07-18 14:40:25,393 - __main__ - INFO - Original class weights: [1.0416666666666667, 0.8795074758135444, 1.1074197120708749]
2025-07-18 14:40:25,393 - __main__ - INFO - Adjusted class weights: tensor([3.3333, 1.7590, 3.5437])
2025-07-18 14:40:25,393 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:25,393 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:25,393 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:25,393 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:25,393 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:25,394 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:25,394 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:25,394 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:25,394 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:25,394 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:25,396 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:25,397 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:25,397 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:25,397 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:25,398 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.3333, 1.7590, 3.5437])
2025-07-18 14:40:25,398 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:25,398 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:25,398 - __main__ - INFO - Starting training for period 2022-08_to_2023-10...
2025-07-18 14:40:25,398 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:25,398 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-08-08 14:37:35.282119 to 2023-08-08 14:37:35.282119
2025-07-18 14:40:25,398 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.3333, 1.7590, 3.5437])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-08-08 14:37:35.282119 to 2023-08-08 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:27,690 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:27,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:27,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:27,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:27,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:27,694 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:27,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(320), np.int64(1): np.int64(339), np.int64(2): np.int64(341)}
2025-07-18 14:40:27,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:27,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:27,695 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:27,695 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:27,695 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-08_to_2023-10: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:27,695 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:27,699 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:27,701 - __main__ - ERROR - ✗ Period 2022-08_to_2023-10 failed
2025-07-18 14:40:27,701 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:27,701 - __main__ - INFO -   Completed: 26/47 periods
2025-07-18 14:40:27,701 - __main__ - INFO -   Successful: 0, Failed: 26
2025-07-18 14:40:27,701 - __main__ - INFO -   Elapsed time: 2.9 minutes
2025-07-18 14:40:27,701 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:27,701 - __main__ - INFO -   Estimated remaining time: 2.3 minutes
Processing periods:  55%|█████▌    | 26/47 [02:52<02:17,  6.55s/period]2025-07-18 14:40:27,701 - __main__ - INFO - 
============================================================
2025-07-18 14:40:27,701 - __main__ - INFO - Processing period 27/47: 2022-09_to_2023-11
2025-07-18 14:40:27,701 - __main__ - INFO - Progress: 27/47 (57.4%)
2025-07-18 14:40:27,701 - __main__ - INFO - ============================================================
2025-07-18 14:40:27,702 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:27,702 - __main__ - INFO - Using default hyperparameters for period 26
2025-07-18 14:40:27,702 - __main__ - INFO - Processing period: 2022-09_to_2023-11
2025-07-18 14:40:27,702 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:27,702 - __main__ - INFO - Preparing data for period: 2022-09-07 to 2023-09-07
2025-07-18 14:40:27,702 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:27,702 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:27,823 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:27,937 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-09-07 14:37:35.282119 to 2023-09-07 14:37:35.282119
2025-07-18 14:40:27,937 - __main__ - INFO - Loading data for ETH/USD from 2022-09-07 14:37:35.282119 to 2023-09-07 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(320), np.int64(1): np.int64(339), np.int64(2): np.int64(341)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:30,112 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:40:30,112 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:30,224 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:30,225 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:30,225 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(291), np.int64(1): np.int64(402), np.int64(2): np.int64(307)}
2025-07-18 14:40:30,225 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:30,225 - __main__ - INFO - Preparing data for period: 2023-09-07 to 2023-11-06
2025-07-18 14:40:30,226 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:30,226 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:30,338 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:30,451 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-09-07 14:37:35.282119 to 2023-11-06 14:37:35.282119
2025-07-18 14:40:30,451 - __main__ - INFO - Loading data for ETH/USD from 2023-09-07 14:37:35.282119 to 2023-11-06 14:37:35.282119
2025-07-18 14:40:31,772 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:40:31,772 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:31,885 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:31,885 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:31,885 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(243), np.int64(1): np.int64(518), np.int64(2): np.int64(239)}
2025-07-18 14:40:31,885 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:31,886 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:31,886 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(291), np.int64(1): np.int64(402), np.int64(2): np.int64(307)}
2025-07-18 14:40:31,886 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:31,886 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:31,886 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.6655
2025-07-18 14:40:31,886 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.6584
2025-07-18 14:40:31,886 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.4745
2025-07-18 14:40:31,886 - __main__ - INFO - Class distribution: {np.int64(0): 291, np.int64(2): 307, np.int64(1): 402}
2025-07-18 14:40:31,886 - __main__ - INFO - Original class weights: [1.145475372279496, 0.8291873963515755, 1.0857763300760044]
2025-07-18 14:40:31,887 - __main__ - INFO - Adjusted class weights: tensor([3.6655, 1.6584, 3.4745])
2025-07-18 14:40:31,887 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:31,887 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:31,887 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:31,887 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:31,887 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:31,887 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:31,888 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:31,888 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:31,888 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:31,888 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:31,890 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:31,891 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:31,891 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:31,891 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:31,891 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.6655, 1.6584, 3.4745])
2025-07-18 14:40:31,892 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:31,892 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:31,892 - __main__ - INFO - Starting training for period 2022-09_to_2023-11...
2025-07-18 14:40:31,892 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:31,892 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-09-07 14:37:35.282119 to 2023-09-07 14:37:35.282119
2025-07-18 14:40:31,892 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 865.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.6655, 1.6584, 3.4745])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-09-07 14:37:35.282119 to 2023-09-07 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:34,162 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:34,166 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:34,166 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:34,166 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:34,166 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:34,167 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:34,167 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(307), np.int64(1): np.int64(392), np.int64(2): np.int64(301)}
2025-07-18 14:40:34,167 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:34,167 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:34,167 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:34,167 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:34,167 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-09_to_2023-11: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:34,167 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:34,168 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:34,169 - __main__ - ERROR - ✗ Period 2022-09_to_2023-11 failed
2025-07-18 14:40:34,170 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:34,170 - __main__ - INFO -   Completed: 27/47 periods
2025-07-18 14:40:34,170 - __main__ - INFO -   Successful: 0, Failed: 27
2025-07-18 14:40:34,170 - __main__ - INFO -   Elapsed time: 3.0 minutes
2025-07-18 14:40:34,170 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:34,170 - __main__ - INFO -   Estimated remaining time: 2.2 minutes
Processing periods:  57%|█████▋    | 27/47 [02:58<02:10,  6.53s/period]2025-07-18 14:40:34,170 - __main__ - INFO - 
============================================================
2025-07-18 14:40:34,170 - __main__ - INFO - Processing period 28/47: 2022-10_to_2023-12
2025-07-18 14:40:34,170 - __main__ - INFO - Progress: 28/47 (59.6%)
2025-07-18 14:40:34,170 - __main__ - INFO - ============================================================
2025-07-18 14:40:34,171 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:34,171 - __main__ - INFO - Using default hyperparameters for period 27
2025-07-18 14:40:34,171 - __main__ - INFO - Processing period: 2022-10_to_2023-12
2025-07-18 14:40:34,171 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:34,172 - __main__ - INFO - Preparing data for period: 2022-10-07 to 2023-10-07
2025-07-18 14:40:34,172 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:34,172 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:34,292 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:34,405 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-10-07 14:37:35.282119 to 2023-10-07 14:37:35.282119
2025-07-18 14:40:34,405 - __main__ - INFO - Loading data for ETH/USD from 2022-10-07 14:37:35.282119 to 2023-10-07 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(307), np.int64(1): np.int64(392), np.int64(2): np.int64(301)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:36,584 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:40:36,585 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:36,698 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:36,698 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:36,698 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(264), np.int64(1): np.int64(469), np.int64(2): np.int64(267)}
2025-07-18 14:40:36,698 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:36,699 - __main__ - INFO - Preparing data for period: 2023-10-07 to 2023-12-06
2025-07-18 14:40:36,700 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:36,700 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:36,813 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:36,926 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-10-07 14:37:35.282119 to 2023-12-06 14:37:35.282119
2025-07-18 14:40:36,926 - __main__ - INFO - Loading data for ETH/USD from 2023-10-07 14:37:35.282119 to 2023-12-06 14:37:35.282119
2025-07-18 14:40:38,264 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:40:38,264 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:38,377 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:38,377 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:38,378 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(298), np.int64(1): np.int64(350), np.int64(2): np.int64(352)}
2025-07-18 14:40:38,378 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:38,378 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:38,378 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(264), np.int64(1): np.int64(469), np.int64(2): np.int64(267)}
2025-07-18 14:40:38,378 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:38,378 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:38,378 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 4.0404
2025-07-18 14:40:38,378 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.4215
2025-07-18 14:40:38,379 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.9950
2025-07-18 14:40:38,379 - __main__ - INFO - Class distribution: {np.int64(2): 267, np.int64(0): 264, np.int64(1): 469}
2025-07-18 14:40:38,379 - __main__ - INFO - Original class weights: [1.2626262626262625, 0.7107320540156361, 1.2484394506866416]
2025-07-18 14:40:38,379 - __main__ - INFO - Adjusted class weights: tensor([4.0404, 1.4215, 3.9950])
2025-07-18 14:40:38,379 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:38,379 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:38,379 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:38,379 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:38,379 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:38,380 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:38,380 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:38,380 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:38,380 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:38,380 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:38,382 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:38,383 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:38,383 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:38,383 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:38,384 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([4.0404, 1.4215, 3.9950])
2025-07-18 14:40:38,384 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:38,384 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:38,384 - __main__ - INFO - Starting training for period 2022-10_to_2023-12...
2025-07-18 14:40:38,384 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:38,384 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-10-07 14:37:35.282119 to 2023-10-07 14:37:35.282119
2025-07-18 14:40:38,384 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([4.0404, 1.4215, 3.9950])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-10-07 14:37:35.282119 to 2023-10-07 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:40,670 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:40,673 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(258), np.int64(1): np.int64(457), np.int64(2): np.int64(285)}
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:40,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:40,675 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:40,675 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-10_to_2023-12: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:40,675 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:40,675 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:40,677 - __main__ - ERROR - ✗ Period 2022-10_to_2023-12 failed
2025-07-18 14:40:40,677 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:40,677 - __main__ - INFO -   Completed: 28/47 periods
2025-07-18 14:40:40,677 - __main__ - INFO -   Successful: 0, Failed: 28
2025-07-18 14:40:40,677 - __main__ - INFO -   Elapsed time: 3.1 minutes
2025-07-18 14:40:40,677 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:40,677 - __main__ - INFO -   Estimated remaining time: 2.1 minutes
Processing periods:  60%|█████▉    | 28/47 [03:05<02:03,  6.52s/period]2025-07-18 14:40:40,677 - __main__ - INFO - 
============================================================
2025-07-18 14:40:40,677 - __main__ - INFO - Processing period 29/47: 2022-11_to_2024-01
2025-07-18 14:40:40,677 - __main__ - INFO - Progress: 29/47 (61.7%)
2025-07-18 14:40:40,678 - __main__ - INFO - ============================================================
2025-07-18 14:40:40,679 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:40,679 - __main__ - INFO - Using default hyperparameters for period 28
2025-07-18 14:40:40,679 - __main__ - INFO - Processing period: 2022-11_to_2024-01
2025-07-18 14:40:40,679 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:40,679 - __main__ - INFO - Preparing data for period: 2022-11-06 to 2023-11-06
2025-07-18 14:40:40,679 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:40,679 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:40,799 - __main__ - INFO - Memory usage: 826.9 MB
2025-07-18 14:40:40,912 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-11-06 14:37:35.282119 to 2023-11-06 14:37:35.282119
2025-07-18 14:40:40,912 - __main__ - INFO - Loading data for ETH/USD from 2022-11-06 14:37:35.282119 to 2023-11-06 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(258), np.int64(1): np.int64(457), np.int64(2): np.int64(285)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 826.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:43,083 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:40:43,084 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:43,196 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:43,196 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:43,197 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(289), np.int64(1): np.int64(451), np.int64(2): np.int64(260)}
2025-07-18 14:40:43,197 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:43,197 - __main__ - INFO - Preparing data for period: 2023-11-06 to 2024-01-05
2025-07-18 14:40:43,198 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:43,198 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:43,310 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:43,423 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-11-06 14:37:35.282119 to 2024-01-05 14:37:35.282119
2025-07-18 14:40:43,423 - __main__ - INFO - Loading data for ETH/USD from 2023-11-06 14:37:35.282119 to 2024-01-05 14:37:35.282119
2025-07-18 14:40:44,744 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:40:44,744 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:44,856 - __main__ - INFO - Memory usage: 865.9 MB
2025-07-18 14:40:44,857 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:44,857 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(341), np.int64(1): np.int64(244), np.int64(2): np.int64(415)}
2025-07-18 14:40:44,857 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:44,857 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:44,857 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(289), np.int64(1): np.int64(451), np.int64(2): np.int64(260)}
2025-07-18 14:40:44,857 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:44,857 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:44,858 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.6909
2025-07-18 14:40:44,858 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.4782
2025-07-18 14:40:44,858 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 4.1026
2025-07-18 14:40:44,858 - __main__ - INFO - Class distribution: {np.int64(0): 289, np.int64(2): 260, np.int64(1): 451}
2025-07-18 14:40:44,858 - __main__ - INFO - Original class weights: [1.1534025374855825, 0.7390983000739099, 1.2820512820512822]
2025-07-18 14:40:44,858 - __main__ - INFO - Adjusted class weights: tensor([3.6909, 1.4782, 4.1026])
2025-07-18 14:40:44,858 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:44,858 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:44,858 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:44,858 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:44,858 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:44,859 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:44,859 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:44,859 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:44,859 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:44,859 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:44,861 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:44,862 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:44,862 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:44,862 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:44,863 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.6909, 1.4782, 4.1026])
2025-07-18 14:40:44,863 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:44,863 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:44,863 - __main__ - INFO - Starting training for period 2022-11_to_2024-01...
2025-07-18 14:40:44,863 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:44,863 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-11-06 14:37:35.282119 to 2023-11-06 14:37:35.282119
2025-07-18 14:40:44,863 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 865.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 865.9 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.6909, 1.4782, 4.1026])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-11-06 14:37:35.282119 to 2023-11-06 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:47,156 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:47,160 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:47,160 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:47,160 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:47,160 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:47,160 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:47,160 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(284), np.int64(1): np.int64(446), np.int64(2): np.int64(270)}
2025-07-18 14:40:47,161 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:47,161 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:47,161 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:47,161 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:47,161 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-11_to_2024-01: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:47,161 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:47,162 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:47,163 - __main__ - ERROR - ✗ Period 2022-11_to_2024-01 failed
2025-07-18 14:40:47,163 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:47,163 - __main__ - INFO -   Completed: 29/47 periods
2025-07-18 14:40:47,163 - __main__ - INFO -   Successful: 0, Failed: 29
2025-07-18 14:40:47,163 - __main__ - INFO -   Elapsed time: 3.2 minutes
2025-07-18 14:40:47,163 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:47,164 - __main__ - INFO -   Estimated remaining time: 2.0 minutes
Processing periods:  62%|██████▏   | 29/47 [03:11<01:57,  6.51s/period]2025-07-18 14:40:47,164 - __main__ - INFO - 
============================================================
2025-07-18 14:40:47,164 - __main__ - INFO - Processing period 30/47: 2022-12_to_2024-02
2025-07-18 14:40:47,164 - __main__ - INFO - Progress: 30/47 (63.8%)
2025-07-18 14:40:47,164 - __main__ - INFO - ============================================================
2025-07-18 14:40:47,165 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:47,165 - __main__ - INFO - Using default hyperparameters for period 29
2025-07-18 14:40:47,165 - __main__ - INFO - Processing period: 2022-12_to_2024-02
2025-07-18 14:40:47,165 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:47,165 - __main__ - INFO - Preparing data for period: 2022-12-06 to 2023-12-06
2025-07-18 14:40:47,166 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:47,166 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:47,284 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:40:47,397 - __main__ - INFO - Loading data for ['ETH/USD'] from 2022-12-06 14:37:35.282119 to 2023-12-06 14:37:35.282119
2025-07-18 14:40:47,397 - __main__ - INFO - Loading data for ETH/USD from 2022-12-06 14:37:35.282119 to 2023-12-06 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(284), np.int64(1): np.int64(446), np.int64(2): np.int64(270)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:49,545 - __main__ - INFO - Enhanced data preparation completed in 2.26 seconds
2025-07-18 14:40:49,545 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:49,658 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:49,658 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:49,659 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(254), np.int64(1): np.int64(449), np.int64(2): np.int64(297)}
2025-07-18 14:40:49,659 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:49,659 - __main__ - INFO - Preparing data for period: 2023-12-06 to 2024-02-04
2025-07-18 14:40:49,660 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:49,660 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:49,772 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:49,885 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-12-06 14:37:35.282119 to 2024-02-04 14:37:35.282119
2025-07-18 14:40:49,885 - __main__ - INFO - Loading data for ETH/USD from 2023-12-06 14:37:35.282119 to 2024-02-04 14:37:35.282119
2025-07-18 14:40:51,210 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:40:51,210 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:51,323 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:51,323 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:51,323 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(374), np.int64(1): np.int64(259), np.int64(2): np.int64(367)}
2025-07-18 14:40:51,323 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:51,323 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:51,323 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(254), np.int64(1): np.int64(449), np.int64(2): np.int64(297)}
2025-07-18 14:40:51,324 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:51,324 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:51,324 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 4.1995
2025-07-18 14:40:51,324 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.4848
2025-07-18 14:40:51,324 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.5915
2025-07-18 14:40:51,324 - __main__ - INFO - Class distribution: {np.int64(1): 449, np.int64(2): 297, np.int64(0): 254}
2025-07-18 14:40:51,324 - __main__ - INFO - Original class weights: [1.3123359580052494, 0.7423904974016332, 1.122334455667789]
2025-07-18 14:40:51,325 - __main__ - INFO - Adjusted class weights: tensor([4.1995, 1.4848, 3.5915])
2025-07-18 14:40:51,325 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:51,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:51,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:51,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:51,327 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:51,328 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([4.1995, 1.4848, 3.5915])
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:51,329 - __main__ - INFO - Starting training for period 2022-12_to_2024-02...
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2022-12-06 14:37:35.282119 to 2023-12-06 14:37:35.282119
2025-07-18 14:40:51,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([4.1995, 1.4848, 3.5915])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2022-12-06 14:37:35.282119 to 2023-12-06 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:53,614 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:53,617 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:40:53,617 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:40:53,617 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:40:53,617 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:40:53,618 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:40:53,618 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(245), np.int64(1): np.int64(483), np.int64(2): np.int64(272)}
2025-07-18 14:40:53,618 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:40:53,618 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:40:53,618 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:40:53,618 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:40:53,618 - __main__ - ERROR - Error in train_and_evaluate_period for 2022-12_to_2024-02: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:53,618 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:40:53,623 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:40:53,624 - __main__ - ERROR - ✗ Period 2022-12_to_2024-02 failed
2025-07-18 14:40:53,624 - __main__ - INFO - Progress Summary:
2025-07-18 14:40:53,624 - __main__ - INFO -   Completed: 30/47 periods
2025-07-18 14:40:53,624 - __main__ - INFO -   Successful: 0, Failed: 30
2025-07-18 14:40:53,624 - __main__ - INFO -   Elapsed time: 3.3 minutes
2025-07-18 14:40:53,624 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:40:53,624 - __main__ - INFO -   Estimated remaining time: 1.9 minutes
Processing periods:  64%|██████▍   | 30/47 [03:18<01:50,  6.50s/period]2025-07-18 14:40:53,625 - __main__ - INFO - 
============================================================
2025-07-18 14:40:53,625 - __main__ - INFO - Processing period 31/47: 2023-01_to_2024-03
2025-07-18 14:40:53,625 - __main__ - INFO - Progress: 31/47 (66.0%)
2025-07-18 14:40:53,625 - __main__ - INFO - ============================================================
2025-07-18 14:40:53,625 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:40:53,625 - __main__ - INFO - Using default hyperparameters for period 30
2025-07-18 14:40:53,625 - __main__ - INFO - Processing period: 2023-01_to_2024-03
2025-07-18 14:40:53,626 - __main__ - INFO - Preparing training data...
2025-07-18 14:40:53,626 - __main__ - INFO - Preparing data for period: 2023-01-05 to 2024-01-05
2025-07-18 14:40:53,626 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:53,626 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:53,745 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:40:53,859 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-01-05 14:37:35.282119 to 2024-01-05 14:37:35.282119
2025-07-18 14:40:53,859 - __main__ - INFO - Loading data for ETH/USD from 2023-01-05 14:37:35.282119 to 2024-01-05 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(245), np.int64(1): np.int64(483), np.int64(2): np.int64(272)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:40:56,015 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:40:56,015 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:56,128 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:56,128 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:56,128 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(297), np.int64(1): np.int64(427), np.int64(2): np.int64(276)}
2025-07-18 14:40:56,129 - __main__ - INFO - Preparing test data...
2025-07-18 14:40:56,129 - __main__ - INFO - Preparing data for period: 2024-01-05 to 2024-03-05
2025-07-18 14:40:56,130 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:40:56,130 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:40:56,243 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:40:56,356 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-01-05 14:37:35.282119 to 2024-03-05 14:37:35.282119
2025-07-18 14:40:56,357 - __main__ - INFO - Loading data for ETH/USD from 2024-01-05 14:37:35.282119 to 2024-03-05 14:37:35.282119
2025-07-18 14:40:57,682 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:40:57,682 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:40:57,795 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:40:57,795 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:40:57,795 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(353), np.int64(1): np.int64(259), np.int64(2): np.int64(388)}
2025-07-18 14:40:57,796 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:40:57,796 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:40:57,796 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(297), np.int64(1): np.int64(427), np.int64(2): np.int64(276)}
2025-07-18 14:40:57,796 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:40:57,796 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:40:57,796 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.5915
2025-07-18 14:40:57,796 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.5613
2025-07-18 14:40:57,796 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.8647
2025-07-18 14:40:57,796 - __main__ - INFO - Class distribution: {np.int64(1): 427, np.int64(2): 276, np.int64(0): 297}
2025-07-18 14:40:57,796 - __main__ - INFO - Original class weights: [1.122334455667789, 0.78064012490242, 1.2077294685990339]
2025-07-18 14:40:57,797 - __main__ - INFO - Adjusted class weights: tensor([3.5915, 1.5613, 3.8647])
2025-07-18 14:40:57,797 - __main__ - INFO - Creating trainer...
2025-07-18 14:40:57,797 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:40:57,797 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:40:57,797 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:40:57,797 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:40:57,797 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:40:57,798 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:40:57,798 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:40:57,798 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:40:57,798 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:40:57,800 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:40:57,801 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:40:57,801 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:40:57,801 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:40:57,802 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.5915, 1.5613, 3.8647])
2025-07-18 14:40:57,802 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:40:57,802 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:40:57,802 - __main__ - INFO - Starting training for period 2023-01_to_2024-03...
2025-07-18 14:40:57,802 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:40:57,802 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-01-05 14:37:35.282119 to 2024-01-05 14:37:35.282119
2025-07-18 14:40:57,802 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.5915, 1.5613, 3.8647])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-01-05 14:37:35.282119 to 2024-01-05 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:00,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:00,084 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:00,084 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(268), np.int64(1): np.int64(435), np.int64(2): np.int64(297)}
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:00,085 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:00,085 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-01_to_2024-03: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:00,086 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:00,086 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:00,088 - __main__ - ERROR - ✗ Period 2023-01_to_2024-03 failed
2025-07-18 14:41:00,088 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:00,088 - __main__ - INFO -   Completed: 31/47 periods
2025-07-18 14:41:00,088 - __main__ - INFO -   Successful: 0, Failed: 31
2025-07-18 14:41:00,088 - __main__ - INFO -   Elapsed time: 3.4 minutes
2025-07-18 14:41:00,088 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:00,088 - __main__ - INFO -   Estimated remaining time: 1.8 minutes
Processing periods:  66%|██████▌   | 31/47 [03:24<01:43,  6.49s/period]2025-07-18 14:41:00,088 - __main__ - INFO - 
============================================================
2025-07-18 14:41:00,088 - __main__ - INFO - Processing period 32/47: 2023-02_to_2024-04
2025-07-18 14:41:00,088 - __main__ - INFO - Progress: 32/47 (68.1%)
2025-07-18 14:41:00,088 - __main__ - INFO - ============================================================
2025-07-18 14:41:00,089 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:00,089 - __main__ - INFO - Using default hyperparameters for period 31
2025-07-18 14:41:00,090 - __main__ - INFO - Processing period: 2023-02_to_2024-04
2025-07-18 14:41:00,090 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:00,090 - __main__ - INFO - Preparing data for period: 2023-02-04 to 2024-02-04
2025-07-18 14:41:00,090 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:00,090 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:00,210 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:00,323 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-02-04 14:37:35.282119 to 2024-02-04 14:37:35.282119
2025-07-18 14:41:00,323 - __main__ - INFO - Loading data for ETH/USD from 2023-02-04 14:37:35.282119 to 2024-02-04 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(268), np.int64(1): np.int64(435), np.int64(2): np.int64(297)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:02,488 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:41:02,488 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:02,601 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:02,601 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:02,601 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(270), np.int64(1): np.int64(436), np.int64(2): np.int64(294)}
2025-07-18 14:41:02,601 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:02,601 - __main__ - INFO - Preparing data for period: 2024-02-04 to 2024-04-04
2025-07-18 14:41:02,602 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:02,602 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:02,715 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:02,828 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-02-04 14:37:35.282119 to 2024-04-04 14:37:35.282119
2025-07-18 14:41:02,828 - __main__ - INFO - Loading data for ETH/USD from 2024-02-04 14:37:35.282119 to 2024-04-04 14:37:35.282119
2025-07-18 14:41:04,150 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:41:04,150 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:04,262 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:04,262 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:04,263 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(363), np.int64(1): np.int64(149), np.int64(2): np.int64(488)}
2025-07-18 14:41:04,263 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:04,263 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:04,263 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(270), np.int64(1): np.int64(436), np.int64(2): np.int64(294)}
2025-07-18 14:41:04,263 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:04,263 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:04,263 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.9506
2025-07-18 14:41:04,264 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.5291
2025-07-18 14:41:04,264 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.6281
2025-07-18 14:41:04,264 - __main__ - INFO - Class distribution: {np.int64(0): 270, np.int64(1): 436, np.int64(2): 294}
2025-07-18 14:41:04,264 - __main__ - INFO - Original class weights: [1.2345679012345678, 0.764525993883792, 1.1337868480725624]
2025-07-18 14:41:04,264 - __main__ - INFO - Adjusted class weights: tensor([3.9506, 1.5291, 3.6281])
2025-07-18 14:41:04,264 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:04,264 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:04,264 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:04,264 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:04,264 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:04,265 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:04,265 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:04,265 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:04,265 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:04,265 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:04,267 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:04,268 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:04,268 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:04,268 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:04,269 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.9506, 1.5291, 3.6281])
2025-07-18 14:41:04,269 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:04,269 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:04,269 - __main__ - INFO - Starting training for period 2023-02_to_2024-04...
2025-07-18 14:41:04,269 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:04,269 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-02-04 14:37:35.282119 to 2024-02-04 14:37:35.282119
2025-07-18 14:41:04,269 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 865.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.9506, 1.5291, 3.6281])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-02-04 14:37:35.282119 to 2024-02-04 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:06,606 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:06,609 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(288), np.int64(1): np.int64(440), np.int64(2): np.int64(272)}
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:06,610 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:06,611 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:06,611 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:06,611 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-02_to_2024-04: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:06,611 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:06,611 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:06,613 - __main__ - ERROR - ✗ Period 2023-02_to_2024-04 failed
2025-07-18 14:41:06,613 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:06,613 - __main__ - INFO -   Completed: 32/47 periods
2025-07-18 14:41:06,613 - __main__ - INFO -   Successful: 0, Failed: 32
2025-07-18 14:41:06,613 - __main__ - INFO -   Elapsed time: 3.5 minutes
2025-07-18 14:41:06,613 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:06,613 - __main__ - INFO -   Estimated remaining time: 1.6 minutes
Processing periods:  68%|██████▊   | 32/47 [03:31<01:37,  6.50s/period]2025-07-18 14:41:06,614 - __main__ - INFO - 
============================================================
2025-07-18 14:41:06,614 - __main__ - INFO - Processing period 33/47: 2023-03_to_2024-05
2025-07-18 14:41:06,614 - __main__ - INFO - Progress: 33/47 (70.2%)
2025-07-18 14:41:06,614 - __main__ - INFO - ============================================================
2025-07-18 14:41:06,615 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:06,615 - __main__ - INFO - Using default hyperparameters for period 32
2025-07-18 14:41:06,615 - __main__ - INFO - Processing period: 2023-03_to_2024-05
2025-07-18 14:41:06,615 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:06,615 - __main__ - INFO - Preparing data for period: 2023-03-06 to 2024-03-05
2025-07-18 14:41:06,615 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:06,615 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:06,737 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:06,852 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-03-06 14:37:35.282119 to 2024-03-05 14:37:35.282119
2025-07-18 14:41:06,852 - __main__ - INFO - Loading data for ETH/USD from 2023-03-06 14:37:35.282119 to 2024-03-05 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(288), np.int64(1): np.int64(440), np.int64(2): np.int64(272)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:09,021 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:41:09,021 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:09,134 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:09,134 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:09,134 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(314), np.int64(1): np.int64(383), np.int64(2): np.int64(303)}
2025-07-18 14:41:09,134 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:09,134 - __main__ - INFO - Preparing data for period: 2024-03-05 to 2024-05-04
2025-07-18 14:41:09,135 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:09,135 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:09,247 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:09,360 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-03-05 14:37:35.282119 to 2024-05-04 14:37:35.282119
2025-07-18 14:41:09,360 - __main__ - INFO - Loading data for ETH/USD from 2024-03-05 14:37:35.282119 to 2024-05-04 14:37:35.282119
2025-07-18 14:41:10,684 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:41:10,684 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:10,796 - __main__ - INFO - Memory usage: 865.9 MB
2025-07-18 14:41:10,796 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:10,797 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(432), np.int64(1): np.int64(113), np.int64(2): np.int64(455)}
2025-07-18 14:41:10,797 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:10,797 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:10,797 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(314), np.int64(1): np.int64(383), np.int64(2): np.int64(303)}
2025-07-18 14:41:10,797 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:10,797 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:10,797 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.3970
2025-07-18 14:41:10,797 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.7406
2025-07-18 14:41:10,797 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.5204
2025-07-18 14:41:10,797 - __main__ - INFO - Class distribution: {np.int64(1): 383, np.int64(2): 303, np.int64(0): 314}
2025-07-18 14:41:10,798 - __main__ - INFO - Original class weights: [1.0615711252653928, 0.8703220191470844, 1.1001100110011002]
2025-07-18 14:41:10,798 - __main__ - INFO - Adjusted class weights: tensor([3.3970, 1.7406, 3.5204])
2025-07-18 14:41:10,798 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:10,798 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:10,798 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:10,798 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:10,798 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:10,799 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:10,799 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:10,799 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:10,799 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:10,799 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:10,801 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:10,802 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:10,802 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:10,802 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:10,803 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.3970, 1.7406, 3.5204])
2025-07-18 14:41:10,803 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:10,803 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:10,803 - __main__ - INFO - Starting training for period 2023-03_to_2024-05...
2025-07-18 14:41:10,803 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:10,803 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-03-06 14:37:35.282119 to 2024-03-05 14:37:35.282119
2025-07-18 14:41:10,803 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 865.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 865.9 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.3970, 1.7406, 3.5204])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-03-06 14:37:35.282119 to 2024-03-05 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:13,086 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:13,089 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(274), np.int64(1): np.int64(407), np.int64(2): np.int64(319)}
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:13,090 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:13,091 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:13,091 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-03_to_2024-05: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:13,091 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:13,091 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:13,093 - __main__ - ERROR - ✗ Period 2023-03_to_2024-05 failed
2025-07-18 14:41:13,093 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:13,093 - __main__ - INFO -   Completed: 33/47 periods
2025-07-18 14:41:13,093 - __main__ - INFO -   Successful: 0, Failed: 33
2025-07-18 14:41:13,093 - __main__ - INFO -   Elapsed time: 3.6 minutes
2025-07-18 14:41:13,093 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:13,093 - __main__ - INFO -   Estimated remaining time: 1.5 minutes
Processing periods:  70%|███████   | 33/47 [03:37<01:30,  6.49s/period]2025-07-18 14:41:13,093 - __main__ - INFO - 
============================================================
2025-07-18 14:41:13,094 - __main__ - INFO - Processing period 34/47: 2023-04_to_2024-06
2025-07-18 14:41:13,094 - __main__ - INFO - Progress: 34/47 (72.3%)
2025-07-18 14:41:13,094 - __main__ - INFO - ============================================================
2025-07-18 14:41:13,095 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:13,095 - __main__ - INFO - Using default hyperparameters for period 33
2025-07-18 14:41:13,095 - __main__ - INFO - Processing period: 2023-04_to_2024-06
2025-07-18 14:41:13,095 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:13,095 - __main__ - INFO - Preparing data for period: 2023-04-05 to 2024-04-04
2025-07-18 14:41:13,096 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:13,096 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:13,217 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:13,332 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-04-05 14:37:35.282119 to 2024-04-04 14:37:35.282119
2025-07-18 14:41:13,332 - __main__ - INFO - Loading data for ETH/USD from 2023-04-05 14:37:35.282119 to 2024-04-04 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(274), np.int64(1): np.int64(407), np.int64(2): np.int64(319)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:15,744 - __main__ - INFO - Enhanced data preparation completed in 2.53 seconds
2025-07-18 14:41:15,744 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:15,926 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:41:15,926 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:15,926 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(286), np.int64(1): np.int64(423), np.int64(2): np.int64(291)}
2025-07-18 14:41:15,926 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:15,926 - __main__ - INFO - Preparing data for period: 2024-04-04 to 2024-06-03
2025-07-18 14:41:15,927 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:15,927 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:16,111 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:41:16,267 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-04-04 14:37:35.282119 to 2024-06-03 14:37:35.282119
2025-07-18 14:41:16,267 - __main__ - INFO - Loading data for ETH/USD from 2024-04-04 14:37:35.282119 to 2024-06-03 14:37:35.282119
2025-07-18 14:41:17,722 - __main__ - INFO - Enhanced data preparation completed in 1.61 seconds
2025-07-18 14:41:17,722 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:17,837 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:17,837 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:17,838 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(387), np.int64(1): np.int64(208), np.int64(2): np.int64(405)}
2025-07-18 14:41:17,838 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:17,838 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:17,838 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(286), np.int64(1): np.int64(423), np.int64(2): np.int64(291)}
2025-07-18 14:41:17,838 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:17,838 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:17,839 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.7296
2025-07-18 14:41:17,839 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.5760
2025-07-18 14:41:17,839 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.6655
2025-07-18 14:41:17,839 - __main__ - INFO - Class distribution: {np.int64(1): 423, np.int64(2): 291, np.int64(0): 286}
2025-07-18 14:41:17,839 - __main__ - INFO - Original class weights: [1.1655011655011656, 0.7880220646178093, 1.145475372279496]
2025-07-18 14:41:17,839 - __main__ - INFO - Adjusted class weights: tensor([3.7296, 1.5760, 3.6655])
2025-07-18 14:41:17,840 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:17,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:17,843 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:17,844 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:17,844 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:17,844 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:17,845 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.7296, 1.5760, 3.6655])
2025-07-18 14:41:17,845 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:17,845 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:17,845 - __main__ - INFO - Starting training for period 2023-04_to_2024-06...
2025-07-18 14:41:17,845 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:17,845 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-04-05 14:37:35.282119 to 2024-04-04 14:37:35.282119
2025-07-18 14:41:17,845 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.7296, 1.5760, 3.6655])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-04-05 14:37:35.282119 to 2024-04-04 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:20,183 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:20,187 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:20,187 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(301), np.int64(1): np.int64(419), np.int64(2): np.int64(280)}
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:20,188 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:20,189 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-04_to_2024-06: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:20,189 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:20,189 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:20,191 - __main__ - ERROR - ✗ Period 2023-04_to_2024-06 failed
2025-07-18 14:41:20,191 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:20,191 - __main__ - INFO -   Completed: 34/47 periods
2025-07-18 14:41:20,191 - __main__ - INFO -   Successful: 0, Failed: 34
2025-07-18 14:41:20,191 - __main__ - INFO -   Elapsed time: 3.7 minutes
2025-07-18 14:41:20,191 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:20,191 - __main__ - INFO -   Estimated remaining time: 1.4 minutes
Processing periods:  72%|███████▏  | 34/47 [03:44<01:26,  6.67s/period]2025-07-18 14:41:20,191 - __main__ - INFO - 
============================================================
2025-07-18 14:41:20,191 - __main__ - INFO - Processing period 35/47: 2023-05_to_2024-07
2025-07-18 14:41:20,191 - __main__ - INFO - Progress: 35/47 (74.5%)
2025-07-18 14:41:20,191 - __main__ - INFO - ============================================================
2025-07-18 14:41:20,192 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:20,192 - __main__ - INFO - Using default hyperparameters for period 34
2025-07-18 14:41:20,192 - __main__ - INFO - Processing period: 2023-05_to_2024-07
2025-07-18 14:41:20,192 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:20,193 - __main__ - INFO - Preparing data for period: 2023-05-05 to 2024-05-04
2025-07-18 14:41:20,193 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:20,193 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:20,314 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:20,429 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-05-05 14:37:35.282119 to 2024-05-04 14:37:35.282119
2025-07-18 14:41:20,430 - __main__ - INFO - Loading data for ETH/USD from 2023-05-05 14:37:35.282119 to 2024-05-04 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(301), np.int64(1): np.int64(419), np.int64(2): np.int64(280)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:22,652 - __main__ - INFO - Enhanced data preparation completed in 2.34 seconds
2025-07-18 14:41:22,652 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:22,767 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:41:22,768 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:22,768 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(312), np.int64(1): np.int64(386), np.int64(2): np.int64(302)}
2025-07-18 14:41:22,768 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:22,768 - __main__ - INFO - Preparing data for period: 2024-05-04 to 2024-07-03
2025-07-18 14:41:22,769 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:22,769 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:22,884 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:41:22,999 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-05-04 14:37:35.282119 to 2024-07-03 14:37:35.282119
2025-07-18 14:41:22,999 - __main__ - INFO - Loading data for ETH/USD from 2024-05-04 14:37:35.282119 to 2024-07-03 14:37:35.282119
2025-07-18 14:41:24,384 - __main__ - INFO - Enhanced data preparation completed in 1.50 seconds
2025-07-18 14:41:24,384 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:24,500 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:24,500 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:24,500 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(355), np.int64(1): np.int64(306), np.int64(2): np.int64(339)}
2025-07-18 14:41:24,500 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:24,500 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:24,500 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(312), np.int64(1): np.int64(386), np.int64(2): np.int64(302)}
2025-07-18 14:41:24,501 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:24,501 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:24,501 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.4188
2025-07-18 14:41:24,501 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.7271
2025-07-18 14:41:24,501 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.5320
2025-07-18 14:41:24,501 - __main__ - INFO - Class distribution: {np.int64(2): 302, np.int64(0): 312, np.int64(1): 386}
2025-07-18 14:41:24,501 - __main__ - INFO - Original class weights: [1.0683760683760684, 0.8635578583765112, 1.1037527593818985]
2025-07-18 14:41:24,502 - __main__ - INFO - Adjusted class weights: tensor([3.4188, 1.7271, 3.5320])
2025-07-18 14:41:24,502 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:24,502 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:24,502 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:24,502 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:24,502 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:24,502 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:24,502 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:24,503 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:24,503 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:24,503 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:24,505 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:24,506 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:24,506 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:24,506 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:24,507 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.4188, 1.7271, 3.5320])
2025-07-18 14:41:24,507 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:24,507 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:24,507 - __main__ - INFO - Starting training for period 2023-05_to_2024-07...
2025-07-18 14:41:24,507 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:24,507 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-05-05 14:37:35.282119 to 2024-05-04 14:37:35.282119
2025-07-18 14:41:24,507 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.4188, 1.7271, 3.5320])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-05-05 14:37:35.282119 to 2024-05-04 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:26,836 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:26,839 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:26,839 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:26,839 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:26,839 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:26,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:26,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(302), np.int64(1): np.int64(398), np.int64(2): np.int64(300)}
2025-07-18 14:41:26,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:26,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:26,840 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:26,840 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:26,840 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-05_to_2024-07: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:26,840 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:26,841 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:26,843 - __main__ - ERROR - ✗ Period 2023-05_to_2024-07 failed
2025-07-18 14:41:26,843 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:26,843 - __main__ - INFO -   Completed: 35/47 periods
2025-07-18 14:41:26,843 - __main__ - INFO -   Successful: 0, Failed: 35
2025-07-18 14:41:26,843 - __main__ - INFO -   Elapsed time: 3.9 minutes
2025-07-18 14:41:26,843 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:26,843 - __main__ - INFO -   Estimated remaining time: 1.3 minutes
Processing periods:  74%|███████▍  | 35/47 [03:51<01:20,  6.67s/period]2025-07-18 14:41:26,843 - __main__ - INFO - 
============================================================
2025-07-18 14:41:26,843 - __main__ - INFO - Processing period 36/47: 2023-06_to_2024-08
2025-07-18 14:41:26,843 - __main__ - INFO - Progress: 36/47 (76.6%)
2025-07-18 14:41:26,843 - __main__ - INFO - ============================================================
2025-07-18 14:41:26,844 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:26,844 - __main__ - INFO - Using default hyperparameters for period 35
2025-07-18 14:41:26,844 - __main__ - INFO - Processing period: 2023-06_to_2024-08
2025-07-18 14:41:26,844 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:26,844 - __main__ - INFO - Preparing data for period: 2023-06-04 to 2024-06-03
2025-07-18 14:41:26,845 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:26,845 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:26,966 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:27,082 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-06-04 14:37:35.282119 to 2024-06-03 14:37:35.282119
2025-07-18 14:41:27,082 - __main__ - INFO - Loading data for ETH/USD from 2023-06-04 14:37:35.282119 to 2024-06-03 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(302), np.int64(1): np.int64(398), np.int64(2): np.int64(300)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:29,249 - __main__ - INFO - Enhanced data preparation completed in 2.28 seconds
2025-07-18 14:41:29,249 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:29,364 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:29,364 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:29,364 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(325), np.int64(1): np.int64(350), np.int64(2): np.int64(325)}
2025-07-18 14:41:29,364 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:29,364 - __main__ - INFO - Preparing data for period: 2024-06-03 to 2024-08-02
2025-07-18 14:41:29,365 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:29,366 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:29,480 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:29,595 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-06-03 14:37:35.282119 to 2024-08-02 14:37:35.282119
2025-07-18 14:41:29,595 - __main__ - INFO - Loading data for ETH/USD from 2024-06-03 14:37:35.282119 to 2024-08-02 14:37:35.282119
2025-07-18 14:41:30,927 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:41:30,927 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:31,041 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:31,041 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:31,042 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(369), np.int64(1): np.int64(286), np.int64(2): np.int64(345)}
2025-07-18 14:41:31,042 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:31,042 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:31,042 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(325), np.int64(1): np.int64(350), np.int64(2): np.int64(325)}
2025-07-18 14:41:31,042 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:31,042 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:31,042 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.2821
2025-07-18 14:41:31,043 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.9048
2025-07-18 14:41:31,043 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.2821
2025-07-18 14:41:31,043 - __main__ - INFO - Class distribution: {np.int64(1): 350, np.int64(2): 325, np.int64(0): 325}
2025-07-18 14:41:31,043 - __main__ - INFO - Original class weights: [1.0256410256410255, 0.9523809523809523, 1.0256410256410255]
2025-07-18 14:41:31,043 - __main__ - INFO - Adjusted class weights: tensor([3.2821, 1.9048, 3.2821])
2025-07-18 14:41:31,043 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:31,043 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:31,043 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:31,043 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:31,043 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:31,044 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:31,044 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:31,044 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:31,044 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:31,044 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:31,046 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:31,047 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:31,047 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:31,047 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:31,048 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.2821, 1.9048, 3.2821])
2025-07-18 14:41:31,048 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:31,048 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:31,048 - __main__ - INFO - Starting training for period 2023-06_to_2024-08...
2025-07-18 14:41:31,048 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:31,048 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-06-04 14:37:35.282119 to 2024-06-03 14:37:35.282119
2025-07-18 14:41:31,048 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.2821, 1.9048, 3.2821])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-06-04 14:37:35.282119 to 2024-06-03 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:33,376 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:33,384 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:33,384 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(319), np.int64(1): np.int64(329), np.int64(2): np.int64(352)}
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:33,385 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:33,386 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-06_to_2024-08: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:33,386 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:33,388 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:33,390 - __main__ - ERROR - ✗ Period 2023-06_to_2024-08 failed
2025-07-18 14:41:33,390 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:33,390 - __main__ - INFO -   Completed: 36/47 periods
2025-07-18 14:41:33,390 - __main__ - INFO -   Successful: 0, Failed: 36
2025-07-18 14:41:33,390 - __main__ - INFO -   Elapsed time: 4.0 minutes
2025-07-18 14:41:33,390 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:33,390 - __main__ - INFO -   Estimated remaining time: 1.2 minutes
Processing periods:  77%|███████▋  | 36/47 [03:57<01:12,  6.63s/period]2025-07-18 14:41:33,390 - __main__ - INFO - 
============================================================
2025-07-18 14:41:33,390 - __main__ - INFO - Processing period 37/47: 2023-07_to_2024-09
2025-07-18 14:41:33,390 - __main__ - INFO - Progress: 37/47 (78.7%)
2025-07-18 14:41:33,390 - __main__ - INFO - ============================================================
2025-07-18 14:41:33,391 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:33,391 - __main__ - INFO - Using default hyperparameters for period 36
2025-07-18 14:41:33,391 - __main__ - INFO - Processing period: 2023-07_to_2024-09
2025-07-18 14:41:33,391 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:33,391 - __main__ - INFO - Preparing data for period: 2023-07-04 to 2024-07-03
2025-07-18 14:41:33,391 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:33,391 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:33,512 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:33,627 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-07-04 14:37:35.282119 to 2024-07-03 14:37:35.282119
2025-07-18 14:41:33,627 - __main__ - INFO - Loading data for ETH/USD from 2023-07-04 14:37:35.282119 to 2024-07-03 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(319), np.int64(1): np.int64(329), np.int64(2): np.int64(352)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:35,836 - __main__ - INFO - Enhanced data preparation completed in 2.32 seconds
2025-07-18 14:41:35,837 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:35,959 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:35,959 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:35,959 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(295), np.int64(1): np.int64(386), np.int64(2): np.int64(319)}
2025-07-18 14:41:35,959 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:35,959 - __main__ - INFO - Preparing data for period: 2024-07-03 to 2024-09-01
2025-07-18 14:41:35,960 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:35,960 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:36,078 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:36,191 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-07-03 14:37:35.282119 to 2024-09-01 14:37:35.282119
2025-07-18 14:41:36,191 - __main__ - INFO - Loading data for ETH/USD from 2024-07-03 14:37:35.282119 to 2024-09-01 14:37:35.282119
2025-07-18 14:41:37,540 - __main__ - INFO - Enhanced data preparation completed in 1.46 seconds
2025-07-18 14:41:37,541 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:37,653 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:37,654 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:37,654 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(399), np.int64(1): np.int64(169), np.int64(2): np.int64(432)}
2025-07-18 14:41:37,654 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:37,654 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:37,654 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(295), np.int64(1): np.int64(386), np.int64(2): np.int64(319)}
2025-07-18 14:41:37,654 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:37,654 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:37,655 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.6158
2025-07-18 14:41:37,655 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 1.7271
2025-07-18 14:41:37,655 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 3.3438
2025-07-18 14:41:37,655 - __main__ - INFO - Class distribution: {np.int64(2): 319, np.int64(1): 386, np.int64(0): 295}
2025-07-18 14:41:37,655 - __main__ - INFO - Original class weights: [1.1299435028248588, 0.8635578583765112, 1.044932079414838]
2025-07-18 14:41:37,655 - __main__ - INFO - Adjusted class weights: tensor([3.6158, 1.7271, 3.3438])
2025-07-18 14:41:37,655 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:37,655 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:37,656 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:37,658 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:37,659 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:37,659 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.6158, 1.7271, 3.3438])
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:37,660 - __main__ - INFO - Starting training for period 2023-07_to_2024-09...
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-07-04 14:37:35.282119 to 2024-07-03 14:37:35.282119
2025-07-18 14:41:37,660 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.6158, 1.7271, 3.3438])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-07-04 14:37:35.282119 to 2024-07-03 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:39,936 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:39,944 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:39,944 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:39,944 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:39,944 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:39,944 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:39,944 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(332), np.int64(1): np.int64(338), np.int64(2): np.int64(330)}
2025-07-18 14:41:39,945 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:39,945 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:39,945 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:39,945 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:39,945 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-07_to_2024-09: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:39,945 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:39,946 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:39,947 - __main__ - ERROR - ✗ Period 2023-07_to_2024-09 failed
2025-07-18 14:41:39,947 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:39,947 - __main__ - INFO -   Completed: 37/47 periods
2025-07-18 14:41:39,947 - __main__ - INFO -   Successful: 0, Failed: 37
2025-07-18 14:41:39,947 - __main__ - INFO -   Elapsed time: 4.1 minutes
2025-07-18 14:41:39,947 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:39,948 - __main__ - INFO -   Estimated remaining time: 1.1 minutes
Processing periods:  79%|███████▊  | 37/47 [04:04<01:06,  6.61s/period]2025-07-18 14:41:39,948 - __main__ - INFO - 
============================================================
2025-07-18 14:41:39,948 - __main__ - INFO - Processing period 38/47: 2023-08_to_2024-10
2025-07-18 14:41:39,948 - __main__ - INFO - Progress: 38/47 (80.9%)
2025-07-18 14:41:39,948 - __main__ - INFO - ============================================================
2025-07-18 14:41:39,949 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:39,949 - __main__ - INFO - Using default hyperparameters for period 37
2025-07-18 14:41:39,949 - __main__ - INFO - Processing period: 2023-08_to_2024-10
2025-07-18 14:41:39,949 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:39,949 - __main__ - INFO - Preparing data for period: 2023-08-03 to 2024-08-02
2025-07-18 14:41:39,950 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:39,950 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:40,068 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:40,181 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-08-03 14:37:35.282119 to 2024-08-02 14:37:35.282119
2025-07-18 14:41:40,181 - __main__ - INFO - Loading data for ETH/USD from 2023-08-03 14:37:35.282119 to 2024-08-02 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(332), np.int64(1): np.int64(338), np.int64(2): np.int64(330)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:42,427 - __main__ - INFO - Enhanced data preparation completed in 2.36 seconds
2025-07-18 14:41:42,427 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:42,542 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:42,542 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:42,543 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(333), np.int64(1): np.int64(305), np.int64(2): np.int64(362)}
2025-07-18 14:41:42,543 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:42,543 - __main__ - INFO - Preparing data for period: 2024-08-02 to 2024-10-01
2025-07-18 14:41:42,544 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:42,544 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:42,684 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:42,799 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-08-02 14:37:35.282119 to 2024-10-01 14:37:35.282119
2025-07-18 14:41:42,799 - __main__ - INFO - Loading data for ETH/USD from 2024-08-02 14:37:35.282119 to 2024-10-01 14:37:35.282119
2025-07-18 14:41:44,208 - __main__ - INFO - Enhanced data preparation completed in 1.52 seconds
2025-07-18 14:41:44,208 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:44,323 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:44,323 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:44,323 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(421), np.int64(1): np.int64(193), np.int64(2): np.int64(386)}
2025-07-18 14:41:44,323 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:44,324 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:44,324 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(333), np.int64(1): np.int64(305), np.int64(2): np.int64(362)}
2025-07-18 14:41:44,324 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:44,324 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:44,324 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 3.2032
2025-07-18 14:41:44,324 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.1858
2025-07-18 14:41:44,324 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.9466
2025-07-18 14:41:44,324 - __main__ - INFO - Class distribution: {np.int64(1): 305, np.int64(0): 333, np.int64(2): 362}
2025-07-18 14:41:44,324 - __main__ - INFO - Original class weights: [1.001001001001001, 1.092896174863388, 0.9208103130755064]
2025-07-18 14:41:44,325 - __main__ - INFO - Adjusted class weights: tensor([3.2032, 2.1858, 2.9466])
2025-07-18 14:41:44,325 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:44,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:44,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:44,325 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:44,325 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:44,326 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:44,326 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:44,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:44,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:44,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:44,328 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:44,329 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:44,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:44,330 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:44,330 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([3.2032, 2.1858, 2.9466])
2025-07-18 14:41:44,330 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:44,330 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:44,330 - __main__ - INFO - Starting training for period 2023-08_to_2024-10...
2025-07-18 14:41:44,330 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:44,331 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-08-03 14:37:35.282119 to 2024-08-02 14:37:35.282119
2025-07-18 14:41:44,331 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([3.2032, 2.1858, 2.9466])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-08-03 14:37:35.282119 to 2024-08-02 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:46,609 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:46,613 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:46,613 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:46,613 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:46,613 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:46,613 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:46,613 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(330), np.int64(1): np.int64(339), np.int64(2): np.int64(331)}
2025-07-18 14:41:46,614 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:46,614 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:46,614 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:46,614 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:46,614 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-08_to_2024-10: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:46,614 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:46,615 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:46,616 - __main__ - ERROR - ✗ Period 2023-08_to_2024-10 failed
2025-07-18 14:41:46,616 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:46,616 - __main__ - INFO -   Completed: 38/47 periods
2025-07-18 14:41:46,616 - __main__ - INFO -   Successful: 0, Failed: 38
2025-07-18 14:41:46,616 - __main__ - INFO -   Elapsed time: 4.2 minutes
2025-07-18 14:41:46,616 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:46,616 - __main__ - INFO -   Estimated remaining time: 1.0 minutes
Processing periods:  81%|████████  | 38/47 [04:11<00:59,  6.63s/period]2025-07-18 14:41:46,617 - __main__ - INFO - 
============================================================
2025-07-18 14:41:46,617 - __main__ - INFO - Processing period 39/47: 2023-09_to_2024-10
2025-07-18 14:41:46,617 - __main__ - INFO - Progress: 39/47 (83.0%)
2025-07-18 14:41:46,617 - __main__ - INFO - ============================================================
2025-07-18 14:41:46,618 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:46,618 - __main__ - INFO - Using default hyperparameters for period 38
2025-07-18 14:41:46,618 - __main__ - INFO - Processing period: 2023-09_to_2024-10
2025-07-18 14:41:46,618 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:46,618 - __main__ - INFO - Preparing data for period: 2023-09-02 to 2024-09-01
2025-07-18 14:41:46,619 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:46,619 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:46,739 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:46,867 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-09-02 14:37:35.282119 to 2024-09-01 14:37:35.282119
2025-07-18 14:41:46,867 - __main__ - INFO - Loading data for ETH/USD from 2023-09-02 14:37:35.282119 to 2024-09-01 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(330), np.int64(1): np.int64(339), np.int64(2): np.int64(331)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:49,038 - __main__ - INFO - Enhanced data preparation completed in 2.30 seconds
2025-07-18 14:41:49,038 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:49,152 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:49,152 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:49,152 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(363), np.int64(1): np.int64(261), np.int64(2): np.int64(376)}
2025-07-18 14:41:49,152 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:49,152 - __main__ - INFO - Preparing data for period: 2024-09-01 to 2024-10-31
2025-07-18 14:41:49,153 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:49,153 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:49,266 - __main__ - INFO - Memory usage: 847.1 MB
2025-07-18 14:41:49,380 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-09-01 14:37:35.282119 to 2024-10-31 14:37:35.282119
2025-07-18 14:41:49,380 - __main__ - INFO - Loading data for ETH/USD from 2024-09-01 14:37:35.282119 to 2024-10-31 14:37:35.282119
2025-07-18 14:41:50,700 - __main__ - INFO - Enhanced data preparation completed in 1.43 seconds
2025-07-18 14:41:50,700 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:50,813 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:50,814 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:50,814 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(393), np.int64(1): np.int64(231), np.int64(2): np.int64(376)}
2025-07-18 14:41:50,814 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:50,814 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:50,814 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(363), np.int64(1): np.int64(261), np.int64(2): np.int64(376)}
2025-07-18 14:41:50,814 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:50,814 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:50,815 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.9385
2025-07-18 14:41:50,815 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.5543
2025-07-18 14:41:50,815 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.8369
2025-07-18 14:41:50,815 - __main__ - INFO - Class distribution: {np.int64(1): 261, np.int64(0): 363, np.int64(2): 376}
2025-07-18 14:41:50,815 - __main__ - INFO - Original class weights: [0.9182736455463728, 1.277139208173691, 0.8865248226950354]
2025-07-18 14:41:50,815 - __main__ - INFO - Adjusted class weights: tensor([2.9385, 2.5543, 2.8369])
2025-07-18 14:41:50,815 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:50,815 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:50,815 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:50,816 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:50,818 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:50,819 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:50,819 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:50,819 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:50,820 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.9385, 2.5543, 2.8369])
2025-07-18 14:41:50,820 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:50,820 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:50,820 - __main__ - INFO - Starting training for period 2023-09_to_2024-10...
2025-07-18 14:41:50,820 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:50,820 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-09-02 14:37:35.282119 to 2024-09-01 14:37:35.282119
2025-07-18 14:41:50,820 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.1 MB
Memory usage: 847.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.1 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.1 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 865.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.9385, 2.5543, 2.8369])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-09-02 14:37:35.282119 to 2024-09-01 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:53,123 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:53,126 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:53,126 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:53,126 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(319), np.int64(1): np.int64(294), np.int64(2): np.int64(387)}
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:53,127 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:53,127 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-09_to_2024-10: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:53,128 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:53,128 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:53,130 - __main__ - ERROR - ✗ Period 2023-09_to_2024-10 failed
2025-07-18 14:41:53,130 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:53,130 - __main__ - INFO -   Completed: 39/47 periods
2025-07-18 14:41:53,130 - __main__ - INFO -   Successful: 0, Failed: 39
2025-07-18 14:41:53,130 - __main__ - INFO -   Elapsed time: 4.3 minutes
2025-07-18 14:41:53,130 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:53,130 - __main__ - INFO -   Estimated remaining time: 0.9 minutes
Processing periods:  83%|████████▎ | 39/47 [04:17<00:52,  6.59s/period]2025-07-18 14:41:53,130 - __main__ - INFO - 
============================================================
2025-07-18 14:41:53,130 - __main__ - INFO - Processing period 40/47: 2023-10_to_2024-11
2025-07-18 14:41:53,130 - __main__ - INFO - Progress: 40/47 (85.1%)
2025-07-18 14:41:53,130 - __main__ - INFO - ============================================================
2025-07-18 14:41:53,131 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:53,131 - __main__ - INFO - Using default hyperparameters for period 39
2025-07-18 14:41:53,131 - __main__ - INFO - Processing period: 2023-10_to_2024-11
2025-07-18 14:41:53,131 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:53,131 - __main__ - INFO - Preparing data for period: 2023-10-02 to 2024-10-01
2025-07-18 14:41:53,132 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:53,132 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:53,254 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:53,369 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-10-02 14:37:35.282119 to 2024-10-01 14:37:35.282119
2025-07-18 14:41:53,369 - __main__ - INFO - Loading data for ETH/USD from 2023-10-02 14:37:35.282119 to 2024-10-01 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(319), np.int64(1): np.int64(294), np.int64(2): np.int64(387)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:55,541 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:41:55,542 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:55,655 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:41:55,655 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:55,656 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(374), np.int64(1): np.int64(236), np.int64(2): np.int64(390)}
2025-07-18 14:41:55,656 - __main__ - INFO - Preparing test data...
2025-07-18 14:41:55,656 - __main__ - INFO - Preparing data for period: 2024-10-01 to 2024-11-30
2025-07-18 14:41:55,657 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:55,657 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:55,770 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:41:55,884 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-10-01 14:37:35.282119 to 2024-11-30 14:37:35.282119
2025-07-18 14:41:55,884 - __main__ - INFO - Loading data for ETH/USD from 2024-10-01 14:37:35.282119 to 2024-11-30 14:37:35.282119
2025-07-18 14:41:57,210 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:41:57,210 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:57,324 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:41:57,324 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:41:57,324 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(405), np.int64(1): np.int64(167), np.int64(2): np.int64(428)}
2025-07-18 14:41:57,324 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:41:57,324 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:41:57,325 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(374), np.int64(1): np.int64(236), np.int64(2): np.int64(390)}
2025-07-18 14:41:57,325 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:41:57,325 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:41:57,325 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.8520
2025-07-18 14:41:57,325 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.8249
2025-07-18 14:41:57,325 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.7350
2025-07-18 14:41:57,325 - __main__ - INFO - Class distribution: {np.int64(1): 236, np.int64(2): 390, np.int64(0): 374}
2025-07-18 14:41:57,325 - __main__ - INFO - Original class weights: [0.8912655971479501, 1.4124293785310735, 0.8547008547008547]
2025-07-18 14:41:57,326 - __main__ - INFO - Adjusted class weights: tensor([2.8520, 2.8249, 2.7350])
2025-07-18 14:41:57,326 - __main__ - INFO - Creating trainer...
2025-07-18 14:41:57,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:41:57,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:41:57,326 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:41:57,326 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:41:57,326 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:41:57,327 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:41:57,327 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:41:57,327 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:41:57,327 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:41:57,329 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:41:57,330 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:41:57,330 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:41:57,330 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:41:57,330 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.8520, 2.8249, 2.7350])
2025-07-18 14:41:57,331 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:41:57,331 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:41:57,331 - __main__ - INFO - Starting training for period 2023-10_to_2024-11...
2025-07-18 14:41:57,331 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:41:57,331 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-10-02 14:37:35.282119 to 2024-10-01 14:37:35.282119
2025-07-18 14:41:57,331 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.8520, 2.8249, 2.7350])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-10-02 14:37:35.282119 to 2024-10-01 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:41:59,603 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:41:59,607 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:41:59,607 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:41:59,607 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:41:59,607 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:41:59,607 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:41:59,608 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(370), np.int64(1): np.int64(226), np.int64(2): np.int64(404)}
2025-07-18 14:41:59,608 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:41:59,608 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:41:59,608 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:41:59,608 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:41:59,608 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-10_to_2024-11: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:59,608 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:41:59,613 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:41:59,614 - __main__ - ERROR - ✗ Period 2023-10_to_2024-11 failed
2025-07-18 14:41:59,614 - __main__ - INFO - Progress Summary:
2025-07-18 14:41:59,614 - __main__ - INFO -   Completed: 40/47 periods
2025-07-18 14:41:59,614 - __main__ - INFO -   Successful: 0, Failed: 40
2025-07-18 14:41:59,614 - __main__ - INFO -   Elapsed time: 4.4 minutes
2025-07-18 14:41:59,614 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:41:59,614 - __main__ - INFO -   Estimated remaining time: 0.8 minutes
Processing periods:  85%|████████▌ | 40/47 [04:24<00:45,  6.56s/period]2025-07-18 14:41:59,614 - __main__ - INFO - 
============================================================
2025-07-18 14:41:59,614 - __main__ - INFO - Processing period 41/47: 2023-11_to_2024-12
2025-07-18 14:41:59,615 - __main__ - INFO - Progress: 41/47 (87.2%)
2025-07-18 14:41:59,615 - __main__ - INFO - ============================================================
2025-07-18 14:41:59,615 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:41:59,615 - __main__ - INFO - Using default hyperparameters for period 40
2025-07-18 14:41:59,615 - __main__ - INFO - Processing period: 2023-11_to_2024-12
2025-07-18 14:41:59,615 - __main__ - INFO - Preparing training data...
2025-07-18 14:41:59,615 - __main__ - INFO - Preparing data for period: 2023-11-01 to 2024-10-31
2025-07-18 14:41:59,616 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:41:59,616 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:41:59,734 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:41:59,847 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-11-01 14:37:35.282119 to 2024-10-31 14:37:35.282119
2025-07-18 14:41:59,848 - __main__ - INFO - Loading data for ETH/USD from 2023-11-01 14:37:35.282119 to 2024-10-31 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(370), np.int64(1): np.int64(226), np.int64(2): np.int64(404)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:02,002 - __main__ - INFO - Enhanced data preparation completed in 2.27 seconds
2025-07-18 14:42:02,003 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:02,116 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:42:02,116 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:02,116 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(386), np.int64(1): np.int64(237), np.int64(2): np.int64(377)}
2025-07-18 14:42:02,116 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:02,116 - __main__ - INFO - Preparing data for period: 2024-10-31 to 2024-12-30
2025-07-18 14:42:02,117 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:02,117 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:02,231 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:42:02,344 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-10-31 14:37:35.282119 to 2024-12-30 14:37:35.282119
2025-07-18 14:42:02,344 - __main__ - INFO - Loading data for ETH/USD from 2024-10-31 14:37:35.282119 to 2024-12-30 14:37:35.282119
2025-07-18 14:42:03,690 - __main__ - INFO - Enhanced data preparation completed in 1.46 seconds
2025-07-18 14:42:03,690 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:03,803 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:42:03,804 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:03,804 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(449), np.int64(1): np.int64(82), np.int64(2): np.int64(469)}
2025-07-18 14:42:03,804 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:03,804 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:03,804 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(386), np.int64(1): np.int64(237), np.int64(2): np.int64(377)}
2025-07-18 14:42:03,804 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:03,804 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:03,805 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.7634
2025-07-18 14:42:03,805 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 2.8129
2025-07-18 14:42:03,805 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.8294
2025-07-18 14:42:03,805 - __main__ - INFO - Class distribution: {np.int64(0): 386, np.int64(2): 377, np.int64(1): 237}
2025-07-18 14:42:03,805 - __main__ - INFO - Original class weights: [0.8635578583765112, 1.4064697609001406, 0.8841732979664014]
2025-07-18 14:42:03,805 - __main__ - INFO - Adjusted class weights: tensor([2.7634, 2.8129, 2.8294])
2025-07-18 14:42:03,805 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:03,805 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:03,805 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:03,806 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:03,808 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:03,809 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:03,809 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.7634, 2.8129, 2.8294])
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:03,810 - __main__ - INFO - Starting training for period 2023-11_to_2024-12...
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-11-01 14:37:35.282119 to 2024-10-31 14:37:35.282119
2025-07-18 14:42:03,810 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.9 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.7634, 2.8129, 2.8294])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-11-01 14:37:35.282119 to 2024-10-31 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:06,077 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:06,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:06,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:06,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:06,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:06,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:06,081 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(384), np.int64(1): np.int64(226), np.int64(2): np.int64(390)}
2025-07-18 14:42:06,082 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:06,082 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:06,082 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:06,082 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:06,082 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-11_to_2024-12: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:06,082 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:06,083 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:06,084 - __main__ - ERROR - ✗ Period 2023-11_to_2024-12 failed
2025-07-18 14:42:06,084 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:06,084 - __main__ - INFO -   Completed: 41/47 periods
2025-07-18 14:42:06,084 - __main__ - INFO -   Successful: 0, Failed: 41
2025-07-18 14:42:06,084 - __main__ - INFO -   Elapsed time: 4.5 minutes
2025-07-18 14:42:06,084 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:06,085 - __main__ - INFO -   Estimated remaining time: 0.7 minutes
Processing periods:  87%|████████▋ | 41/47 [04:30<00:39,  6.53s/period]2025-07-18 14:42:06,085 - __main__ - INFO - 
============================================================
2025-07-18 14:42:06,085 - __main__ - INFO - Processing period 42/47: 2023-12_to_2025-01
2025-07-18 14:42:06,085 - __main__ - INFO - Progress: 42/47 (89.4%)
2025-07-18 14:42:06,085 - __main__ - INFO - ============================================================
2025-07-18 14:42:06,086 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:42:06,086 - __main__ - INFO - Using default hyperparameters for period 41
2025-07-18 14:42:06,086 - __main__ - INFO - Processing period: 2023-12_to_2025-01
2025-07-18 14:42:06,086 - __main__ - INFO - Preparing training data...
2025-07-18 14:42:06,086 - __main__ - INFO - Preparing data for period: 2023-12-01 to 2024-11-30
2025-07-18 14:42:06,087 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:06,087 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:06,206 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:42:06,319 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-12-01 14:37:35.282119 to 2024-11-30 14:37:35.282119
2025-07-18 14:42:06,320 - __main__ - INFO - Loading data for ETH/USD from 2023-12-01 14:37:35.282119 to 2024-11-30 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(384), np.int64(1): np.int64(226), np.int64(2): np.int64(390)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:08,717 - __main__ - INFO - Enhanced data preparation completed in 2.51 seconds
2025-07-18 14:42:08,717 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:08,906 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:42:08,906 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:08,906 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(396), np.int64(1): np.int64(195), np.int64(2): np.int64(409)}
2025-07-18 14:42:08,906 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:08,907 - __main__ - INFO - Preparing data for period: 2024-11-30 to 2025-01-29
2025-07-18 14:42:08,907 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:08,907 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:09,096 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:42:09,283 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-11-30 14:37:35.282119 to 2025-01-29 14:37:35.282119
2025-07-18 14:42:09,283 - __main__ - INFO - Loading data for ETH/USD from 2024-11-30 14:37:35.282119 to 2025-01-29 14:37:35.282119
2025-07-18 14:42:10,706 - __main__ - INFO - Enhanced data preparation completed in 1.61 seconds
2025-07-18 14:42:10,706 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:10,821 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:42:10,821 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:10,821 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(461), np.int64(1): np.int64(130), np.int64(2): np.int64(409)}
2025-07-18 14:42:10,821 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:10,821 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:10,822 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(396), np.int64(1): np.int64(195), np.int64(2): np.int64(409)}
2025-07-18 14:42:10,822 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:10,822 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:10,822 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.6936
2025-07-18 14:42:10,822 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.4188
2025-07-18 14:42:10,822 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.6080
2025-07-18 14:42:10,822 - __main__ - INFO - Class distribution: {np.int64(1): 195, np.int64(0): 396, np.int64(2): 409}
2025-07-18 14:42:10,822 - __main__ - INFO - Original class weights: [0.8417508417508418, 1.7094017094017093, 0.8149959250203749]
2025-07-18 14:42:10,823 - __main__ - INFO - Adjusted class weights: tensor([2.6936, 3.4188, 2.6080])
2025-07-18 14:42:10,823 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:10,823 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:10,823 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:10,823 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:10,823 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:10,823 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:10,824 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:10,824 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:10,824 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:10,824 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:10,826 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:10,827 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:10,827 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.6936, 3.4188, 2.6080])
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:10,828 - __main__ - INFO - Starting training for period 2023-12_to_2025-01...
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-12-01 14:37:35.282119 to 2024-11-30 14:37:35.282119
2025-07-18 14:42:10,828 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 865.8 MB
Memory usage: 865.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.6936, 3.4188, 2.6080])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-12-01 14:37:35.282119 to 2024-11-30 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:13,149 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:13,157 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:13,157 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(381), np.int64(1): np.int64(220), np.int64(2): np.int64(399)}
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:13,158 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:13,159 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-12_to_2025-01: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:13,159 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:13,159 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:13,161 - __main__ - ERROR - ✗ Period 2023-12_to_2025-01 failed
2025-07-18 14:42:13,161 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:13,161 - __main__ - INFO -   Completed: 42/47 periods
2025-07-18 14:42:13,161 - __main__ - INFO -   Successful: 0, Failed: 42
2025-07-18 14:42:13,161 - __main__ - INFO -   Elapsed time: 4.6 minutes
2025-07-18 14:42:13,161 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:13,161 - __main__ - INFO -   Estimated remaining time: 0.6 minutes
Processing periods:  89%|████████▉ | 42/47 [04:37<00:33,  6.70s/period]2025-07-18 14:42:13,161 - __main__ - INFO - 
============================================================
2025-07-18 14:42:13,161 - __main__ - INFO - Processing period 43/47: 2023-12_to_2025-02
2025-07-18 14:42:13,161 - __main__ - INFO - Progress: 43/47 (91.5%)
2025-07-18 14:42:13,161 - __main__ - INFO - ============================================================
2025-07-18 14:42:13,162 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:42:13,162 - __main__ - INFO - Using default hyperparameters for period 42
2025-07-18 14:42:13,163 - __main__ - INFO - Processing period: 2023-12_to_2025-02
2025-07-18 14:42:13,163 - __main__ - INFO - Preparing training data...
2025-07-18 14:42:13,163 - __main__ - INFO - Preparing data for period: 2023-12-31 to 2024-12-30
2025-07-18 14:42:13,163 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:13,163 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:13,286 - __main__ - INFO - Memory usage: 827.0 MB
2025-07-18 14:42:13,398 - __main__ - INFO - Loading data for ['ETH/USD'] from 2023-12-31 14:37:35.282119 to 2024-12-30 14:37:35.282119
2025-07-18 14:42:13,398 - __main__ - INFO - Loading data for ETH/USD from 2023-12-31 14:37:35.282119 to 2024-12-30 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 875.2 MB
Memory usage: 875.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 875.2 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(381), np.int64(1): np.int64(220), np.int64(2): np.int64(399)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 827.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:15,571 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:42:15,572 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:15,684 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:42:15,684 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:15,684 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(398), np.int64(1): np.int64(202), np.int64(2): np.int64(400)}
2025-07-18 14:42:15,685 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:15,685 - __main__ - INFO - Preparing data for period: 2024-12-30 to 2025-02-28
2025-07-18 14:42:15,685 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:15,685 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:15,798 - __main__ - INFO - Memory usage: 847.0 MB
2025-07-18 14:42:15,934 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-12-30 14:37:35.282119 to 2025-02-28 14:37:35.282119
2025-07-18 14:42:15,934 - __main__ - INFO - Loading data for ETH/USD from 2024-12-30 14:37:35.282119 to 2025-02-28 14:37:35.282119
2025-07-18 14:42:17,255 - __main__ - INFO - Enhanced data preparation completed in 1.46 seconds
2025-07-18 14:42:17,255 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:17,368 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:42:17,368 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:17,368 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(456), np.int64(1): np.int64(130), np.int64(2): np.int64(414)}
2025-07-18 14:42:17,368 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:17,368 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:17,369 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(398), np.int64(1): np.int64(202), np.int64(2): np.int64(400)}
2025-07-18 14:42:17,369 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:17,369 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:17,369 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.6801
2025-07-18 14:42:17,369 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.3003
2025-07-18 14:42:17,369 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.6667
2025-07-18 14:42:17,369 - __main__ - INFO - Class distribution: {np.int64(2): 400, np.int64(0): 398, np.int64(1): 202}
2025-07-18 14:42:17,369 - __main__ - INFO - Original class weights: [0.8375209380234506, 1.6501650165016502, 0.8333333333333334]
2025-07-18 14:42:17,370 - __main__ - INFO - Adjusted class weights: tensor([2.6801, 3.3003, 2.6667])
2025-07-18 14:42:17,370 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:17,370 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:17,370 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:17,370 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:17,370 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:17,370 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:17,371 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:17,371 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:17,371 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:17,371 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:17,373 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:17,374 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:17,374 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:17,374 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:17,374 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.6801, 3.3003, 2.6667])
2025-07-18 14:42:17,375 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:17,375 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:17,375 - __main__ - INFO - Starting training for period 2023-12_to_2025-02...
2025-07-18 14:42:17,375 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:17,375 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2023-12-31 14:37:35.282119 to 2024-12-30 14:37:35.282119
2025-07-18 14:42:17,375 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 847.0 MB
Memory usage: 847.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 847.0 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 847.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 866.0 MB
Memory usage: 866.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.6801, 3.3003, 2.6667])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2023-12-31 14:37:35.282119 to 2024-12-30 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:19,669 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(399), np.int64(1): np.int64(216), np.int64(2): np.int64(385)}
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:19,674 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:19,675 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:19,675 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:19,675 - __main__ - ERROR - Error in train_and_evaluate_period for 2023-12_to_2025-02: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:19,675 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:19,675 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:19,676 - __main__ - ERROR - ✗ Period 2023-12_to_2025-02 failed
2025-07-18 14:42:19,676 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:19,676 - __main__ - INFO -   Completed: 43/47 periods
2025-07-18 14:42:19,676 - __main__ - INFO -   Successful: 0, Failed: 43
2025-07-18 14:42:19,676 - __main__ - INFO -   Elapsed time: 4.7 minutes
2025-07-18 14:42:19,676 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:19,676 - __main__ - INFO -   Estimated remaining time: 0.4 minutes
Processing periods:  91%|█████████▏| 43/47 [04:44<00:26,  6.64s/period]2025-07-18 14:42:19,676 - __main__ - INFO - 
============================================================
2025-07-18 14:42:19,676 - __main__ - INFO - Processing period 44/47: 2024-01_to_2025-03
2025-07-18 14:42:19,676 - __main__ - INFO - Progress: 44/47 (93.6%)
2025-07-18 14:42:19,676 - __main__ - INFO - ============================================================
2025-07-18 14:42:19,677 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:42:19,677 - __main__ - INFO - Using default hyperparameters for period 43
2025-07-18 14:42:19,677 - __main__ - INFO - Processing period: 2024-01_to_2025-03
2025-07-18 14:42:19,677 - __main__ - INFO - Preparing training data...
2025-07-18 14:42:19,677 - __main__ - INFO - Preparing data for period: 2024-01-30 to 2025-01-29
2025-07-18 14:42:19,679 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:19,679 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:19,802 - __main__ - INFO - Memory usage: 857.9 MB
2025-07-18 14:42:19,918 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-01-30 14:37:35.282119 to 2025-01-29 14:37:35.282119
2025-07-18 14:42:19,918 - __main__ - INFO - Loading data for ETH/USD from 2024-01-30 14:37:35.282119 to 2025-01-29 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 855.6 MB
Memory usage: 855.6 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 855.6 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(399), np.int64(1): np.int64(216), np.int64(2): np.int64(385)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:22,094 - __main__ - INFO - Enhanced data preparation completed in 2.29 seconds
2025-07-18 14:42:22,094 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:22,225 - __main__ - INFO - Memory usage: 857.9 MB
2025-07-18 14:42:22,225 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:22,225 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(397), np.int64(1): np.int64(168), np.int64(2): np.int64(435)}
2025-07-18 14:42:22,225 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:22,225 - __main__ - INFO - Preparing data for period: 2025-01-29 to 2025-03-30
2025-07-18 14:42:22,226 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:22,226 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:22,346 - __main__ - INFO - Memory usage: 857.9 MB
2025-07-18 14:42:22,461 - __main__ - INFO - Loading data for ['ETH/USD'] from 2025-01-29 14:37:35.282119 to 2025-03-30 14:37:35.282119
2025-07-18 14:42:22,461 - __main__ - INFO - Loading data for ETH/USD from 2025-01-29 14:37:35.282119 to 2025-03-30 14:37:35.282119
2025-07-18 14:42:23,791 - __main__ - INFO - Enhanced data preparation completed in 1.44 seconds
2025-07-18 14:42:23,791 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:23,906 - __main__ - INFO - Memory usage: 865.0 MB
2025-07-18 14:42:23,906 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:23,906 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(457), np.int64(1): np.int64(101), np.int64(2): np.int64(442)}
2025-07-18 14:42:23,906 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:23,906 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:23,906 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(397), np.int64(1): np.int64(168), np.int64(2): np.int64(435)}
2025-07-18 14:42:23,906 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:23,906 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:23,907 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.6868
2025-07-18 14:42:23,907 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.9683
2025-07-18 14:42:23,907 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.4521
2025-07-18 14:42:23,907 - __main__ - INFO - Class distribution: {np.int64(2): 435, np.int64(0): 397, np.int64(1): 168}
2025-07-18 14:42:23,907 - __main__ - INFO - Original class weights: [0.8396305625524769, 1.9841269841269842, 0.7662835249042146]
2025-07-18 14:42:23,907 - __main__ - INFO - Adjusted class weights: tensor([2.6868, 3.9683, 2.4521])
2025-07-18 14:42:23,907 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:23,907 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:23,908 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:23,910 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:23,911 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:23,911 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.6868, 3.9683, 2.4521])
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:23,912 - __main__ - INFO - Starting training for period 2024-01_to_2025-03...
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2024-01-30 14:37:35.282119 to 2025-01-29 14:37:35.282119
2025-07-18 14:42:23,912 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 857.9 MB
Memory usage: 857.9 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 857.9 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.9 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.8 MB
Memory usage: 864.8 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 865.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.6868, 3.9683, 2.4521])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2024-01-30 14:37:35.282119 to 2025-01-29 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 865.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:26,191 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:26,195 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:26,195 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:26,195 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:26,195 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:26,196 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:26,196 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(419), np.int64(1): np.int64(187), np.int64(2): np.int64(394)}
2025-07-18 14:42:26,196 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:26,196 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:26,196 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:26,196 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:26,196 - __main__ - ERROR - Error in train_and_evaluate_period for 2024-01_to_2025-03: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:26,196 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:26,197 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:26,197 - __main__ - ERROR - ✗ Period 2024-01_to_2025-03 failed
2025-07-18 14:42:26,197 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:26,197 - __main__ - INFO -   Completed: 44/47 periods
2025-07-18 14:42:26,198 - __main__ - INFO -   Successful: 0, Failed: 44
2025-07-18 14:42:26,198 - __main__ - INFO -   Elapsed time: 4.8 minutes
2025-07-18 14:42:26,198 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:26,198 - __main__ - INFO -   Estimated remaining time: 0.3 minutes
Processing periods:  94%|█████████▎| 44/47 [04:50<00:19,  6.61s/period]2025-07-18 14:42:26,198 - __main__ - INFO - 
============================================================
2025-07-18 14:42:26,198 - __main__ - INFO - Processing period 45/47: 2024-02_to_2025-04
2025-07-18 14:42:26,198 - __main__ - INFO - Progress: 45/47 (95.7%)
2025-07-18 14:42:26,198 - __main__ - INFO - ============================================================
2025-07-18 14:42:26,200 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:42:26,200 - __main__ - INFO - Using default hyperparameters for period 44
2025-07-18 14:42:26,200 - __main__ - INFO - Processing period: 2024-02_to_2025-04
2025-07-18 14:42:26,200 - __main__ - INFO - Preparing training data...
2025-07-18 14:42:26,200 - __main__ - INFO - Preparing data for period: 2024-02-29 to 2025-02-28
2025-07-18 14:42:26,201 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:26,201 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:26,324 - __main__ - INFO - Memory usage: 857.6 MB
2025-07-18 14:42:26,452 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-02-29 14:37:35.282119 to 2025-02-28 14:37:35.282119
2025-07-18 14:42:26,452 - __main__ - INFO - Loading data for ETH/USD from 2024-02-29 14:37:35.282119 to 2025-02-28 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 854.6 MB
Memory usage: 854.6 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 854.6 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(419), np.int64(1): np.int64(187), np.int64(2): np.int64(394)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.6 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:28,648 - __main__ - INFO - Enhanced data preparation completed in 2.32 seconds
2025-07-18 14:42:28,648 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:28,763 - __main__ - INFO - Memory usage: 857.6 MB
2025-07-18 14:42:28,763 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:28,763 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(420), np.int64(1): np.int64(172), np.int64(2): np.int64(408)}
2025-07-18 14:42:28,763 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:28,763 - __main__ - INFO - Preparing data for period: 2025-02-28 to 2025-04-29
2025-07-18 14:42:28,764 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:28,764 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:28,879 - __main__ - INFO - Memory usage: 857.6 MB
2025-07-18 14:42:28,994 - __main__ - INFO - Loading data for ['ETH/USD'] from 2025-02-28 14:37:35.282119 to 2025-04-29 14:37:35.282119
2025-07-18 14:42:28,994 - __main__ - INFO - Loading data for ETH/USD from 2025-02-28 14:37:35.282119 to 2025-04-29 14:37:35.282119
2025-07-18 14:42:30,331 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:42:30,331 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:30,446 - __main__ - INFO - Memory usage: 864.5 MB
2025-07-18 14:42:30,446 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:30,446 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(487), np.int64(1): np.int64(103), np.int64(2): np.int64(410)}
2025-07-18 14:42:30,446 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:30,446 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:30,447 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(420), np.int64(1): np.int64(172), np.int64(2): np.int64(408)}
2025-07-18 14:42:30,447 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:30,447 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:30,447 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.5397
2025-07-18 14:42:30,447 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.8760
2025-07-18 14:42:30,447 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.6144
2025-07-18 14:42:30,447 - __main__ - INFO - Class distribution: {np.int64(1): 172, np.int64(2): 408, np.int64(0): 420}
2025-07-18 14:42:30,447 - __main__ - INFO - Original class weights: [0.7936507936507936, 1.937984496124031, 0.8169934640522876]
2025-07-18 14:42:30,448 - __main__ - INFO - Adjusted class weights: tensor([2.5397, 3.8760, 2.6144])
2025-07-18 14:42:30,448 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:30,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:30,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:30,448 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:30,448 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:30,448 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:30,449 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:30,449 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:30,449 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:30,449 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:30,451 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:30,452 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:30,452 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:30,452 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:30,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.5397, 3.8760, 2.6144])
2025-07-18 14:42:30,453 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:30,453 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:30,453 - __main__ - INFO - Starting training for period 2024-02_to_2025-04...
2025-07-18 14:42:30,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:30,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2024-02-29 14:37:35.282119 to 2025-02-28 14:37:35.282119
2025-07-18 14:42:30,453 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 857.6 MB
Memory usage: 857.6 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 857.6 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.6 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5760 rows of real data for ETH/USD
Loaded 5760 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5596 sequences from 5760 data points
Sampling 1000 sequences from 5596 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.5 MB
Memory usage: 864.5 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 864.5 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.5397, 3.8760, 2.6144])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2024-02-29 14:37:35.282119 to 2025-02-28 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 864.5 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:32,727 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:32,731 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:32,731 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(440), np.int64(1): np.int64(176), np.int64(2): np.int64(384)}
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:32,732 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:32,732 - __main__ - ERROR - Error in train_and_evaluate_period for 2024-02_to_2025-04: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:32,733 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:32,733 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:32,733 - __main__ - ERROR - ✗ Period 2024-02_to_2025-04 failed
2025-07-18 14:42:32,734 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:32,734 - __main__ - INFO -   Completed: 45/47 periods
2025-07-18 14:42:32,734 - __main__ - INFO -   Successful: 0, Failed: 45
2025-07-18 14:42:32,734 - __main__ - INFO -   Elapsed time: 5.0 minutes
2025-07-18 14:42:32,734 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:32,734 - __main__ - INFO -   Estimated remaining time: 0.2 minutes
Processing periods:  96%|█████████▌| 45/47 [04:57<00:13,  6.58s/period]2025-07-18 14:42:32,734 - __main__ - INFO - 
============================================================
2025-07-18 14:42:32,734 - __main__ - INFO - Processing period 46/47: 2024-03_to_2025-05
2025-07-18 14:42:32,734 - __main__ - INFO - Progress: 46/47 (97.9%)
2025-07-18 14:42:32,734 - __main__ - INFO - ============================================================
2025-07-18 14:42:32,736 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:42:32,736 - __main__ - INFO - Using default hyperparameters for period 45
2025-07-18 14:42:32,736 - __main__ - INFO - Processing period: 2024-03_to_2025-05
2025-07-18 14:42:32,736 - __main__ - INFO - Preparing training data...
2025-07-18 14:42:32,736 - __main__ - INFO - Preparing data for period: 2024-03-30 to 2025-03-30
2025-07-18 14:42:32,737 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:32,737 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:32,858 - __main__ - INFO - Memory usage: 857.2 MB
2025-07-18 14:42:32,971 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-03-30 14:37:35.282119 to 2025-03-30 14:37:35.282119
2025-07-18 14:42:32,971 - __main__ - INFO - Loading data for ETH/USD from 2024-03-30 14:37:35.282119 to 2025-03-30 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 854.0 MB
Memory usage: 854.0 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 854.0 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(440), np.int64(1): np.int64(176), np.int64(2): np.int64(384)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.2 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:35,172 - __main__ - INFO - Enhanced data preparation completed in 2.31 seconds
2025-07-18 14:42:35,172 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:35,286 - __main__ - INFO - Memory usage: 857.2 MB
2025-07-18 14:42:35,286 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:35,287 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(397), np.int64(1): np.int64(163), np.int64(2): np.int64(440)}
2025-07-18 14:42:35,287 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:35,287 - __main__ - INFO - Preparing data for period: 2025-03-30 to 2025-05-29
2025-07-18 14:42:35,288 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:35,288 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:35,403 - __main__ - INFO - Memory usage: 857.2 MB
2025-07-18 14:42:35,518 - __main__ - INFO - Loading data for ['ETH/USD'] from 2025-03-30 14:37:35.282119 to 2025-05-29 14:37:35.282119
2025-07-18 14:42:35,518 - __main__ - INFO - Loading data for ETH/USD from 2025-03-30 14:37:35.282119 to 2025-05-29 14:37:35.282119
2025-07-18 14:42:36,853 - __main__ - INFO - Enhanced data preparation completed in 1.45 seconds
2025-07-18 14:42:36,853 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:36,968 - __main__ - INFO - Memory usage: 864.5 MB
2025-07-18 14:42:36,968 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:36,968 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(447), np.int64(1): np.int64(95), np.int64(2): np.int64(458)}
2025-07-18 14:42:36,968 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:36,968 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:36,968 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(397), np.int64(1): np.int64(163), np.int64(2): np.int64(440)}
2025-07-18 14:42:36,968 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:36,969 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:36,969 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.6868
2025-07-18 14:42:36,969 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 4.0900
2025-07-18 14:42:36,969 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.4242
2025-07-18 14:42:36,969 - __main__ - INFO - Class distribution: {np.int64(1): 163, np.int64(0): 397, np.int64(2): 440}
2025-07-18 14:42:36,969 - __main__ - INFO - Original class weights: [0.8396305625524769, 2.044989775051125, 0.7575757575757576]
2025-07-18 14:42:36,969 - __main__ - INFO - Adjusted class weights: tensor([2.6868, 4.0900, 2.4242])
2025-07-18 14:42:36,970 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:36,970 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:36,972 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:36,973 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:36,973 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.6868, 4.0900, 2.4242])
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:36,974 - __main__ - INFO - Starting training for period 2024-03_to_2025-05...
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2024-03-30 14:37:35.282119 to 2025-03-30 14:37:35.282119
2025-07-18 14:42:36,974 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 857.2 MB
Memory usage: 857.2 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 857.2 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.2 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 5726 rows of real data for ETH/USD
Loaded 5726 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 5562 sequences from 5726 data points
Sampling 1000 sequences from 5562 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.1 MB
Memory usage: 864.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 864.5 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.6868, 4.0900, 2.4242])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2024-03-30 14:37:35.282119 to 2025-03-30 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 864.5 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:39,266 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:39,270 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(405), np.int64(1): np.int64(174), np.int64(2): np.int64(421)}
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:39,271 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:39,272 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:39,272 - __main__ - ERROR - Error in train_and_evaluate_period for 2024-03_to_2025-05: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:39,272 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:39,273 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:39,273 - __main__ - ERROR - ✗ Period 2024-03_to_2025-05 failed
2025-07-18 14:42:39,273 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:39,273 - __main__ - INFO -   Completed: 46/47 periods
2025-07-18 14:42:39,273 - __main__ - INFO -   Successful: 0, Failed: 46
2025-07-18 14:42:39,273 - __main__ - INFO -   Elapsed time: 5.1 minutes
2025-07-18 14:42:39,273 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:39,273 - __main__ - INFO -   Estimated remaining time: 0.1 minutes
Processing periods:  98%|█████████▊| 46/47 [05:03<00:06,  6.57s/period]2025-07-18 14:42:39,273 - __main__ - INFO - 
============================================================
2025-07-18 14:42:39,274 - __main__ - INFO - Processing period 47/47: 2024-04_to_2025-06
2025-07-18 14:42:39,274 - __main__ - INFO - Progress: 47/47 (100.0%)
2025-07-18 14:42:39,274 - __main__ - INFO - ============================================================
2025-07-18 14:42:39,276 - __main__ - INFO - No optimized hyperparameter files found
2025-07-18 14:42:39,276 - __main__ - INFO - Using default hyperparameters for period 46
2025-07-18 14:42:39,276 - __main__ - INFO - Processing period: 2024-04_to_2025-06
2025-07-18 14:42:39,276 - __main__ - INFO - Preparing training data...
2025-07-18 14:42:39,276 - __main__ - INFO - Preparing data for period: 2024-04-29 to 2025-04-29
2025-07-18 14:42:39,276 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:39,276 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:39,400 - __main__ - INFO - Memory usage: 857.5 MB
2025-07-18 14:42:39,515 - __main__ - INFO - Loading data for ['ETH/USD'] from 2024-04-29 14:37:35.282119 to 2025-04-29 14:37:35.282119
2025-07-18 14:42:39,515 - __main__ - INFO - Loading data for ETH/USD from 2024-04-29 14:37:35.282119 to 2025-04-29 14:37:35.282119
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 854.1 MB
Memory usage: 854.1 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 854.1 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(405), np.int64(1): np.int64(174), np.int64(2): np.int64(421)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.5 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:41,703 - __main__ - INFO - Enhanced data preparation completed in 2.30 seconds
2025-07-18 14:42:41,703 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:41,818 - __main__ - INFO - Memory usage: 857.5 MB
2025-07-18 14:42:41,819 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:41,819 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(430), np.int64(1): np.int64(175), np.int64(2): np.int64(395)}
2025-07-18 14:42:41,819 - __main__ - INFO - Preparing test data...
2025-07-18 14:42:41,819 - __main__ - INFO - Preparing data for period: 2025-04-29 to 2025-06-28
2025-07-18 14:42:41,820 - __main__ - INFO - Enhanced data processor scaler set to: minmax
2025-07-18 14:42:41,820 - __main__ - INFO - Calling enhanced data_processor.prepare_data()...
2025-07-18 14:42:41,936 - __main__ - INFO - Memory usage: 857.5 MB
2025-07-18 14:42:42,051 - __main__ - INFO - Loading data for ['ETH/USD'] from 2025-04-29 14:37:35.282119 to 2025-06-28 14:37:35.282119
2025-07-18 14:42:42,051 - __main__ - INFO - Loading data for ETH/USD from 2025-04-29 14:37:35.282119 to 2025-06-28 14:37:35.282119
2025-07-18 14:42:43,360 - __main__ - INFO - Enhanced data preparation completed in 1.42 seconds
2025-07-18 14:42:43,360 - __main__ - INFO - Data shapes - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:43,476 - __main__ - INFO - Memory usage: 866.0 MB
2025-07-18 14:42:43,476 - __main__ - INFO - Converting to classification targets...
2025-07-18 14:42:43,476 - __main__ - INFO - Class distribution: {np.int64(0): np.int64(414), np.int64(1): np.int64(87), np.int64(2): np.int64(499)}
2025-07-18 14:42:43,476 - __main__ - INFO - Data validation passed - Training: 1000 samples, Test: 1000 samples
2025-07-18 14:42:43,476 - __main__ - INFO - Calculating class weights from training data with optimized adjustments...
2025-07-18 14:42:43,476 - __main__ - INFO - DEBUG: Class distribution from y_train: {np.int64(0): np.int64(430), np.int64(1): np.int64(175), np.int64(2): np.int64(395)}
2025-07-18 14:42:43,476 - __main__ - INFO - DEBUG: Unique classes found: [0 1 2]
2025-07-18 14:42:43,476 - __main__ - INFO - DEBUG: Total samples: 1000
2025-07-18 14:42:43,477 - __main__ - INFO -   Applied 3.20x multiplier to Class 0 (Down) weight: 2.4806
2025-07-18 14:42:43,477 - __main__ - INFO -   Applied 2.00x multiplier to Class 1 (No Direction) weight: 3.8095
2025-07-18 14:42:43,477 - __main__ - INFO -   Applied 3.20x multiplier to Class 2 (Up) weight: 2.7004
2025-07-18 14:42:43,477 - __main__ - INFO - Class distribution: {np.int64(0): 430, np.int64(1): 175, np.int64(2): 395}
2025-07-18 14:42:43,477 - __main__ - INFO - Original class weights: [0.7751937984496124, 1.9047619047619047, 0.8438818565400844]
2025-07-18 14:42:43,477 - __main__ - INFO - Adjusted class weights: tensor([2.4806, 3.8095, 2.7004])
2025-07-18 14:42:43,478 - __main__ - INFO - Creating trainer...
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing ClassificationSTGNNTrainer...
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up device...
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] CUDA available with 2 device(s)
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] GPU cache cleared
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] Final device: cuda:0
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing STGNN classification model...
2025-07-18 14:42:43,478 - scripts.train_stgnn_improved - INFO - [TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
2025-07-18 14:42:43,480 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving model to device...
2025-07-18 14:42:43,482 - scripts.train_stgnn_improved - INFO - Model device: cuda:0
2025-07-18 14:42:43,482 - scripts.train_stgnn_improved - INFO - [TRAINER] Initializing optimizer with learning rate: 0.0005
2025-07-18 14:42:43,482 - scripts.train_stgnn_improved - INFO - [TRAINER] Setting up loss function...
2025-07-18 14:42:43,482 - scripts.train_stgnn_improved - INFO - [TRAINER] Using pre-calculated class weights: tensor([2.4806, 3.8095, 2.7004])
2025-07-18 14:42:43,482 - scripts.train_stgnn_improved - INFO - [TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
2025-07-18 14:42:43,482 - scripts.train_stgnn_improved - INFO - [TRAINER] ClassificationSTGNNTrainer initialization completed successfully
2025-07-18 14:42:43,482 - __main__ - INFO - Starting training for period 2024-04_to_2025-06...
2025-07-18 14:42:43,483 - scripts.train_stgnn_improved - INFO - [TRAINER] Preparing classification data...
2025-07-18 14:42:43,483 - scripts.train_stgnn_improved - INFO - [TRAINER] Data time range: 2024-04-29 14:37:35.282119 to 2025-04-29 14:37:35.282119
2025-07-18 14:42:43,483 - scripts.train_stgnn_improved - INFO - [TRAINER] Calling data processor prepare_data...
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 857.5 MB
Memory usage: 857.5 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 857.5 MB
Scaler set to: minmax
Starting full feature generator data preparation...
Memory usage: 857.5 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 2846 rows of real data for ETH/USD
Loaded 2846 data points for ETH/USD
Creating sequences with lazy generation (max: 1000)...
Creating 2682 sequences from 2846 data points
Sampling 1000 sequences from 2682 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 864.4 MB
Memory usage: 864.4 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 866.0 MB
[TRAINER] Initializing ClassificationSTGNNTrainer...
[TRAINER] Setting up device...
[TRAINER] CUDA available with 2 device(s)
[TRAINER] Using CUDA device 0: Tesla V100-PCIE-32GB
[TRAINER] GPU Memory - Total: 31.7GB, Allocated: 0.0GB, Cached: 0.0GB
[TRAINER] GPU cache cleared
[TRAINER] Final device: cuda:0
[TRAINER] Initializing STGNN classification model...
[TRAINER] Model parameters - Nodes: 1, Input dim: 25, Hidden dim: 96
[TRAINER] Moving model to device...
[TRAINER] Model device: cuda:0
[TRAINER] Initializing optimizer with learning rate: 0.0005
[TRAINER] Setting up loss function...
[TRAINER] Using pre-calculated class weights: tensor([2.4806, 3.8095, 2.7004])
[TRAINER] WeightedFocalLoss created with alpha=1.0, gamma=2.0
[TRAINER] ClassificationSTGNNTrainer initialization completed successfully
[TRAINER] Preparing classification data...
[TRAINER] Data time range: 2024-04-29 14:37:35.282119 to 2025-04-29 14:37:35.282119
[TRAINER] Calling data processor prepare_data...
Starting full feature generator data preparation...
Memory usage: 866.0 MB
Using single asset processing with full feature generator...
Processing single asset: ETH/USD
Attempting to load from local: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loading real data from: data/historical/ETH-USDT-SWAP_ohlcv_15m.csv
Loaded 35040 rows of real data for ETH/USD
Loaded 35040 data points for ETH/USD
2025-07-18 14:42:45,791 - scripts.train_stgnn_improved - INFO - [TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Data validation passed
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Moving adjacency matrix to device: cuda:0
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Adjacency matrix device: cuda:0
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting returns to classification targets...
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting 1000 returns to classes with threshold: 0.005
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Class distribution: {np.int64(0): np.int64(397), np.int64(1): np.int64(173), np.int64(2): np.int64(430)}
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Classification targets shape: (1000, 1)
2025-07-18 14:42:45,796 - scripts.train_stgnn_improved - INFO - [TRAINER] Converting to tensors and moving to device...
2025-07-18 14:42:45,797 - scripts.train_stgnn_improved - INFO - [TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
2025-07-18 14:42:45,797 - scripts.train_stgnn_improved - INFO - Applying SMOTE to training data for class balance...
2025-07-18 14:42:45,797 - __main__ - ERROR - Error in train_and_evaluate_period for 2024-04_to_2025-06: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:45,797 - __main__ - ERROR - Exception details: TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.
2025-07-18 14:42:45,797 - __main__ - ERROR - Traceback: Traceback (most recent call last):
  File "/home/obondo/stgnn_model/LootCapital/scripts/walk_forward_optimization.py", line 388, in train_and_evaluate_period
    training_history = trainer.train()
                       ^^^^^^^^^^^^^^^
  File "/home/obondo/stgnn_model/LootCapital/scripts/train_stgnn_improved.py", line 960, in train
    unique_before, counts_before = np.unique(y_train_flat.numpy(), return_counts=True)
                                             ^^^^^^^^^^^^^^^^^^^^
TypeError: can't convert cuda:0 device type tensor to numpy. Use Tensor.cpu() to copy the tensor to host memory first.

2025-07-18 14:42:45,798 - __main__ - ERROR - ✗ Period 2024-04_to_2025-06 failed
2025-07-18 14:42:45,798 - __main__ - INFO - Progress Summary:
2025-07-18 14:42:45,798 - __main__ - INFO -   Completed: 47/47 periods
2025-07-18 14:42:45,798 - __main__ - INFO -   Successful: 0, Failed: 47
2025-07-18 14:42:45,798 - __main__ - INFO -   Elapsed time: 5.2 minutes
2025-07-18 14:42:45,798 - __main__ - INFO -   Avg time per period: 0.1 minutes
2025-07-18 14:42:45,798 - __main__ - INFO -   Estimated remaining time: 0.0 minutes
Processing periods: 100%|██████████| 47/47 [05:10<00:00,  6.56s/period]Processing periods: 100%|██████████| 47/47 [05:10<00:00,  6.60s/period]
2025-07-18 14:42:45,798 - __main__ - INFO - 
============================================================
2025-07-18 14:42:45,798 - __main__ - INFO - WALK-FORWARD OPTIMIZATION COMPLETED
2025-07-18 14:42:45,799 - __main__ - INFO - ============================================================
2025-07-18 14:42:45,799 - __main__ - INFO - Total periods: 47
2025-07-18 14:42:45,799 - __main__ - INFO - Successful periods: 0
2025-07-18 14:42:45,799 - __main__ - INFO - Failed periods: 47
2025-07-18 14:42:45,799 - __main__ - INFO - Success rate: 0.0%
2025-07-18 14:42:45,799 - __main__ - INFO - Total time: 5.2 minutes
2025-07-18 14:42:45,799 - __main__ - INFO - Average time per period: 0.1 minutes
2025-07-18 14:42:45,799 - __main__ - ERROR - No successful periods to generate report
2025-07-18 14:42:45,799 - __main__ - INFO - 
================================================================================
2025-07-18 14:42:45,799 - __main__ - INFO - WALK-FORWARD OPTIMIZATION COMPLETED SUCCESSFULLY
2025-07-18 14:42:45,799 - __main__ - INFO - ================================================================================
2025-07-18 14:42:45,799 - __main__ - INFO - Total execution time: 5.2 minutes (0.1 hours)
2025-07-18 14:42:45,799 - __main__ - INFO - Results saved to:
2025-07-18 14:42:45,799 - __main__ - INFO -   Models: models
2025-07-18 14:42:45,799 - __main__ - INFO -   Reports: reports
2025-07-18 14:42:45,799 - __main__ - INFO -   Plots: plots
2025-07-18 14:42:45,799 - __main__ - INFO -   Logs: logs
Creating sequences with lazy generation (max: 1000)...
Creating 34876 sequences from 35040 data points
Sampling 1000 sequences from 34876 possible sequences
Created 1000 sequences with shapes X: (1000, 150, 25), y: (1000,)
Memory usage: 855.5 MB
Memory usage: 855.5 MB
Single asset data prepared - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
Memory usage: 855.5 MB
[TRAINER] Data processor returned - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y: torch.Size([1000, 1])
[TRAINER] Data validation passed
[TRAINER] Moving adjacency matrix to device: cuda:0
[TRAINER] Adjacency matrix device: cuda:0
[TRAINER] Converting returns to classification targets...
[TRAINER] Converting 1000 returns to classes with threshold: 0.005
[TRAINER] Class distribution: {np.int64(0): np.int64(397), np.int64(1): np.int64(173), np.int64(2): np.int64(430)}
[TRAINER] Classification targets shape: (1000, 1)
[TRAINER] Converting to tensors and moving to device...
[TRAINER] Final tensors - X: torch.Size([1000, 1, 150, 25]), adj: torch.Size([1, 1]), y_classes: torch.Size([1000, 1])
JOB FINISHED AT: Fri Jul 18 14:42:47 EDT 2025
